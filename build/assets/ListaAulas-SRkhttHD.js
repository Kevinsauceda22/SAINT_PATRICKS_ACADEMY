import{r as c,j as e}from"./index-SVRFFNc9.js";import{C as v}from"./index.esm-DWwMdKxH.js";import{S as i}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as be}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as _e}from"./logo_saint_patrick-xw7Wl8f3.js";import"./FileSaver.min-DN8zk8MP.js";import{C as ve}from"./CContainer-BdNP0s3v.js";import{C as X,a as P}from"./CRow-Bf67u6lu.js";import{a as l}from"./CButton-D9GPTbB6.js";import{c as Se}from"./cil-plus-D8mtC-W5.js";import{C as ye,a as Ne,b as we,c as Ee}from"./CDropdownToggle-DlfIUTmX.js";import{c as De}from"./cil-description-MUzg6O3n.js";import{C as d}from"./CInputGroup-D-McUFva.js";import{C as u}from"./CInputGroupText-Cfu0fzaY.js";import{c as ke}from"./cil-search-CDkY_4k-.js";import{C as m}from"./CFormInput-B_gylY64.js";import{c as Ae}from"./cil-brush-alt-CV61lKqC.js";import{C as R}from"./CFormSelect-CzT7g5tb.js";import{C as Te,a as Pe,b as Z,c as f,d as Le,e as g}from"./CTable-98qqrSRH.js";import{c as Fe}from"./cil-pen-53d2I-C-.js";import{c as ee}from"./cil-trash-CBbKHhHb.js";import{C as Me}from"./CPagination-UopCEeNZ.js";import{C as O,a as B,b as I,c as U}from"./CModalHeader-Bhtr3bZe.js";import{C as $}from"./CModalTitle-M2mBvD_5.js";import{C as oe}from"./CForm-CYRkMwLo.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const ho=()=>{const[se,ae]=c.useState([]),[E,ie]=c.useState([]),[r,C]=c.useState({Numero_aula:"",Capacidad:"",Cupos_aula:"",Cod_edificio:"",Division:"",Secciones_disponibles:"",Secciones_ocupadas:""}),[ne,L]=c.useState(!1);c.useState({Numero_aula:"",Capacidad:"",Cupos_aula:"",Cod_edificio:"",Division:"",Secciones_disponibles:"",Secciones_ocupadas:""});const[te,F]=c.useState(!1),[re,M]=c.useState(!1),[n,b]=c.useState({}),[H,V]=c.useState({});c.useState("");const[G,W]=c.useState(""),[S,D]=c.useState(1),[y,ce]=c.useState(10);c.useState(!1);const q=()=>C("");c.useEffect(()=>{k(),(async()=>{try{const a=await(await fetch("http://localhost:4000/api/aula/edificio")).json();console.log("Datos de edificios cargados:",a),ie(a)}catch(s){console.error("Error al obtener edificios:",s)}})()},[]);const k=async()=>{try{const s=await(await fetch("http://localhost:4000/api/aula/aulas")).json();ae(s)}catch(o){console.error("Error al obtener las aulas:",o)}},h=o=>/^\d*$/.test(o),t=o=>{o.preventDefault(),i.fire({icon:"warning",title:"Acción bloqueada",text:"Copiar y pegar no está permitido."})},le=()=>{const o=new be({orientation:"landscape",unit:"mm",format:"a4"});if(!_||_.length===0){alert("No hay datos para exportar.");return}const s=new Image;s.src=_e,s.onload=()=>{const a=o.internal.pageSize.width,p=o.internal.pageSize.height;o.addImage(s,"PNG",10,10,45,45),o.setFontSize(18),o.setTextColor(0,102,51),o.text("SAINT PATRICK'S ACADEMY",a/2,24,{align:"center"}),o.setFontSize(10),o.setTextColor(100),o.text("Casa Club del periodista, Colonia del Periodista",a/2,32,{align:"center"}),o.text("Teléfono: (504) 2234-8871",a/2,37,{align:"center"}),o.text("Correo: info@saintpatrickacademy.edu",a/2,42,{align:"center"}),o.setFontSize(14),o.setTextColor(0,102,51),o.text("Reporte General de Aulas",a/2,50,{align:"center"}),o.setLineWidth(.5),o.setDrawColor(0,102,51),o.line(10,55,a-10,55),o.setFontSize(12),o.setTextColor(0),o.text("Listado de Aulas",a/2,65,{align:"center"});const x=["#","Número de Aula","Capacidad","Cupos","División","Edificio","Secciones Disponibles","Secciones Ocupadas"],w=_.map((j,z)=>{const A=E.find(T=>T.Nombre_edificios===j.Nombre_edificios);return[{content:(z+1).toString(),styles:{halign:"center"}},{content:j.Numero_aula.toString(),styles:{halign:"center"}},{content:j.Capacidad.toString(),styles:{halign:"center"}},{content:j.Cupos_aula,styles:{halign:"center"}},{content:j.Division,styles:{halign:"center"}},{content:(A?A.Nombre_edificios:"Sin edificio").toUpperCase(),styles:{halign:"left"}},{content:j.Secciones_disponibles,styles:{halign:"center"}},{content:j.Secciones_ocupadas,styles:{halign:"center"}}]});o.autoTable({startY:75,head:[x],body:w,headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10,halign:"center"},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]},columnStyles:{7:{halign:"left"}},margin:{top:10,bottom:30},didDrawPage:function(j){const z=o.internal.getNumberOfPages(),A=o.internal.getCurrentPageInfo().pageNumber;o.setFontSize(10),o.setTextColor(0,102,51),o.text(`Página ${A} de ${z}`,a-10,p-10,{align:"right"});const T=new Date,ge=T.toLocaleDateString("es-HN",{year:"numeric",month:"long",day:"numeric"}),je=T.toLocaleTimeString("es-HN",{hour:"2-digit",minute:"2-digit",second:"2-digit"});o.text(`Fecha de generación: ${ge} Hora: ${je}`,10,p-10)}});const fe=o.output("blob"),Q=URL.createObjectURL(fe);window.open("","_blank").document.write(`
          <html>
            <head><title>Reporte de Aulas</title></head>
            <body style="margin:0;">
              <iframe width="100%" height="100%" src="${Q}" frameborder="0"></iframe>
              <div style="position:fixed;top:10px;right:200px;">
                <button style="background-color: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;" 
                  onclick="const a = document.createElement('a'); a.href='${Q}'; a.download='Reporte_de_Aulas.pdf'; a.click();">
                  Descargar PDF
                </button>
              </div>
            </body>
          </html>`)},s.onerror=()=>{i.fire("Error","No se pudo cargar el logo.","error")}},de=async()=>{const o={p_Numero_aula:r.Numero_aula,p_Capacidad:r.Capacidad,p_Cupos_aula:r.Cupos_aula,p_Division:r.Division,p_Secciones_disponibles:r.Secciones_disponibles,p_Secciones_ocupadas:r.Secciones_ocupadas,p_Cod_edificio:r.Cod_edificio},s={p_Numero_aula:"Número de Aula",p_Capacidad:"Capacidad",p_Cupos_aula:"Cupos Aula",p_Secciones_disponibles:"Secciones Disponibles",p_Secciones_ocupadas:"Secciones Ocupadas",p_Cod_edificio:"Edificio"};for(const[a,p]of Object.entries(o))if(p==null||p===""||/^\s*$/.test(p)){const x=s[a]||a;console.error(`El campo ${x} no puede estar vacío.`),i.fire({icon:"warning",title:"Error de validación",text:`El campo "${x}" no puede estar vacío.`});return}if(o.p_Cupos_aula>o.p_Capacidad){i.fire({icon:"warning",title:"Error de validación",text:"El número de cupos del aula no puede ser mayor que la capacidad."});return}if(o.p_Secciones_ocupadas>o.p_Secciones_disponibles){i.fire({icon:"warning",title:"Error de validación",text:"El número de secciones ocupadas no puede ser mayor que el número de secciones disponibles."});return}try{const a=await fetch("http://localhost:4000/api/aula/crear_aula",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),p=await a.json();a.ok?(k(),L(!1),C(""),q(),i.fire({icon:"success",title:"Creación exitosa",text:"El aula ha sido creada correctamente."})):(i.fire({icon:"error",title:"Error",text:`${p.mensaje||"Error desconocido"}`}),console.error("Hubo un error al crear el aula",a.statusText,p))}catch(a){console.error("Error al crear el aula:",a),i.fire({icon:"error",title:"Error de conexión",text:"Ocurrió un problema al conectarse con el servidor."})}},ue=async()=>{let o=n.Secciones_disponibles;const s=n.Secciones_ocupadas,a=parseInt(n.Secciones_ocupadas,10);if(a!==s){if(o=n.Secciones_disponibles-(a-s),a>n.Secciones_disponibles){i.fire({icon:"warning",title:"Error de validación",text:"El número de secciones ocupadas no puede exceder el total de secciones disponibles."});return}if(o<0){i.fire({icon:"warning",title:"Error de validación",text:"No se pueden actualizar secciones ocupadas si se exceden las secciones disponibles."});return}if(n.Secciones_disponibles===0&&a>s){i.fire({icon:"warning",title:"Error de validación",text:"No se puede aumentar las secciones ocupadas si no hay secciones disponibles."});return}}else n.Secciones_ocupadas=s;const p={p_Cod_aula:n.Cod_aula,p_Numero_aula:n.Numero_aula,p_Capacidad:n.Capacidad,p_Cupos_aula:n.Cupos_aula,p_Cod_edificio:n.Cod_edificio,p_Division:n.Division,p_Secciones_disponibles:o};a!==s?p.p_Secciones_ocupadas=a:p.p_Secciones_ocupadas=s;try{const x=await fetch(`http://localhost:4000/api/aula/actualizar_aula/${n.Cod_aula}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});console.log("Estado de la respuesta:",x.status);const w=await x.json();x.ok?(i.fire({icon:"success",title:"Actualización exitosa",text:"El aula ha sido actualizada correctamente."}),k(),F(!1),b({})):i.fire({icon:"error",title:"Error",text:(w==null?void 0:w.mensaje)||"No se pudo actualizar el aula."})}catch(x){console.error("Error al actualizar el aula:",x),i.fire({icon:"error",title:"Error",text:"Ocurrió un error al intentar actualizar el aula."})}},pe=async()=>{try{(await fetch(`http://localhost:4000/api/aula/${H.Cod_aula}`,{method:"DELETE"})).ok?(k(),M(!1),V({}),i.fire({icon:"success",title:"Eliminación exitosa",text:"El aula ha sido eliminada correctamente."})):i.fire({icon:"error",title:"Error",text:"No se pudo eliminar el aula."})}catch(o){console.error("Error al eliminar el aula:",o)}},me=o=>{b(o),F(!0)},he=o=>{V(o),M(!0)},N=()=>{i.fire({title:"¿Estás seguro?",text:"Tienes cambios sin guardar. ¿Deseas cerrar el modal?",icon:"warning",showCancelButton:!0,confirmButtonText:"Cerrar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&(L(!1),q(),F(!1),M(!1))})},xe=o=>{W(o.target.value),D(1)},_=se.filter(o=>{var s;return(s=o.Numero_aula)==null?void 0:s.toString().includes(G)}),Y=S*y,J=Y-y,Ce=_.slice(J,Y),K=o=>{o>0&&o<=Math.ceil(_.length/y)&&D(o)};return e.jsxs(ve,{children:[e.jsxs(X,{className:"align-items-center mb-5",children:[e.jsx(P,{xs:"8",md:"9",children:e.jsx("h1",{className:"mb-0",children:"Mantenimiento Aulas"})}),e.jsxs(P,{xs:"4",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[e.jsxs(l,{style:{backgroundColor:"#4B6251",color:"white"},className:"mb-3 mb-md-0 me-md-3",onClick:()=>{L(!0)},children:[e.jsx(v,{icon:Se})," Nuevo"]}),e.jsxs(ye,{children:[e.jsxs(Ne,{style:{backgroundColor:"#6C8E58",color:"white"},children:[e.jsx(v,{icon:De})," Reporte"]}),e.jsx(we,{children:e.jsx(Ee,{onClick:()=>le(),style:{color:"#6C8E58",fontWeight:"bold"},children:"Ver Reporte en PDF"})})]})]})]}),e.jsxs(X,{className:"align-items-center mt-4 mb-2",children:[e.jsx(P,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:e.jsxs(d,{className:"me-3",style:{width:"400px"},children:[e.jsx(u,{children:e.jsx(v,{icon:ke})}),e.jsx(m,{placeholder:"Buscar número de aula..",onChange:xe,value:G}),e.jsxs(l,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{W(""),D(1)},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#E0E0E0",o.currentTarget.style.color="black"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="#F3F4F7",o.currentTarget.style.color="#343a40"},children:[e.jsx(v,{icon:Ae})," Limpiar"]})]})}),e.jsx(P,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:e.jsx(d,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:e.jsxs("div",{className:"d-inline-flex align-items-center",children:[e.jsx("span",{children:"Mostrar "}),e.jsxs(R,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:o=>{const s=Number(o.target.value);ce(s),D(1)},value:y,children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"})]}),e.jsx("span",{children:" registros"})]})})})]}),e.jsx("div",{className:"table-container",style:{maxHeight:"400px",overflowY:"scroll",marginBottom:"20px"},children:e.jsxs(Te,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Pe,{style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff"},children:e.jsxs(Z,{children:[e.jsx(f,{children:"#"}),e.jsx(f,{children:"Número de Aula"}),e.jsx(f,{children:"Capacidad"}),e.jsx(f,{children:"Cupos"}),e.jsx(f,{children:"División"}),e.jsx(f,{children:"Edificio"}),e.jsx(f,{children:"Secciones disponibles"}),e.jsx(f,{children:"Secciones ocupadas"}),e.jsx(f,{children:"Acciones"})]})}),e.jsx(Le,{children:Ce.map((o,s)=>e.jsxs(Z,{children:[e.jsx(g,{children:J+s+1}),e.jsx(g,{children:o.Numero_aula}),e.jsx(g,{children:o.Capacidad}),e.jsx(g,{children:o.Cupos_aula}),e.jsx(g,{children:o.Division}),e.jsx(g,{style:{textTransform:"uppercase"},children:o.Nombre_edificios}),e.jsx(g,{children:o.Secciones_disponibles}),e.jsx(g,{children:o.Secciones_ocupadas}),e.jsxs(g,{children:[e.jsx(l,{color:"warning",onClick:()=>me(o),className:"mr-2",children:e.jsx(v,{icon:Fe})}),e.jsx(l,{color:"danger",onClick:()=>he(o),children:e.jsx(v,{icon:ee})})]})]},o.Cod_aula))})]})}),e.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsxs(Me,{"aria-label":"Page navigation",children:[e.jsx(l,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:S===1,onClick:()=>K(S-1),children:"Anterior"}),e.jsx(l,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:S===Math.ceil(_.length/y),onClick:()=>K(S+1),children:"Siguiente"})]}),e.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",S," de ",Math.ceil(_.length/y)]})]}),e.jsxs(O,{visible:ne,backdrop:"static",children:[e.jsxs(B,{closeButton:!1,children:[e.jsx($,{children:"Ingresar Nueva Aula"}),e.jsx(l,{className:"btn-close","aria-label":"Close",onClick:N})]}),e.jsx(I,{children:e.jsxs(oe,{children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Numero del aula"}),e.jsx(m,{value:r.Numero_aula,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Numero_aula:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Capacidad del aula"}),e.jsx(m,{value:r.Capacidad,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Capacidad:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Cupos del aula"}),e.jsx(m,{value:r.Cupos_aula,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Cupos_aula:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Edificio"}),e.jsxs(R,{className:"form-select",value:r.Cod_edificio,maxLength:11,onPaste:t,onCopy:t,onChange:o=>C({...r,Cod_edificio:o.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione un Edificio"}),E.length>0?E.map(o=>e.jsx("option",{value:o.Cod_edificio,children:o.Nombre_edificios.toUpperCase()},o.Cod_edificio)):e.jsx("option",{disabled:!0,children:"No hay edificios disponibles"})]},r.Cod_edificio)]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"División"}),e.jsx(m,{value:r.Division,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Division:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Secciones Disponibles"}),e.jsx(m,{value:r.Secciones_disponibles,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Secciones_disponibles:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Secciones Ocupadas"}),e.jsx(m,{value:r.Secciones_ocupadas,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}C({...r,Secciones_ocupadas:s})}})]})]})}),e.jsxs(U,{children:[e.jsx(l,{color:"secondary",onClick:N,children:"Cerrar"}),e.jsx(l,{color:"success",onClick:de,children:"Guardar"})]})]}),e.jsxs(O,{visible:te,backdrop:"static",children:[e.jsxs(B,{closeButton:!1,children:[e.jsx($,{children:"Actualizar Aula"}),e.jsx(l,{className:"btn-close","aria-label":"Close",onClick:N})]}),e.jsx(I,{children:e.jsxs(oe,{children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Numero de Aula"}),e.jsx(m,{value:n.Numero_aula||"",readOnly:!0})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Capacidad"}),e.jsx(m,{value:n.Capacidad,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}b({...n,Capacidad:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Cupos Aula"}),e.jsx(m,{value:n.Cupos_aula,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}b({...n,Cupos_aula:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Edificio"}),e.jsxs(R,{"aria-label":"Seleccionar edificio",value:n.Cod_edificio,maxLength:11,onPaste:t,onCopy:t,onChange:o=>b({...n,Cod_edificio:o.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione Edificio"}),E.map(o=>e.jsx("option",{value:o.Cod_edificio,children:o.Nombre_edificios.toUpperCase()},o.Cod_edificio))]})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Division"}),e.jsx(m,{value:n.Division,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}b({...n,Division:s})}})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(u,{children:"Secciones Ocupadas"}),e.jsx(m,{value:n.Secciones_ocupadas,maxLength:11,onPaste:t,onCopy:t,onChange:o=>{const s=o.target.value;if(!h(s)){i.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten números positivos"});return}b({...n,Secciones_ocupadas:s})}})]})]})}),e.jsxs(U,{children:[e.jsx(l,{color:"secondary",onClick:N,children:"Cancelar"}),e.jsx(l,{color:"success",onClick:ue,children:"Guardar Cambios"})]})]}),e.jsxs(O,{visible:re,backdrop:"static",children:[e.jsxs(B,{closeButton:!1,children:[e.jsx($,{children:"Confirmar Eliminación"}),e.jsx(l,{className:"btn-close","aria-label":"Close",onClick:N})]}),e.jsx(I,{children:e.jsxs("p",{children:["¿Estás seguro de que deseas eliminar el aula: ",e.jsx("strong",{children:H.Numero_aula}),"?"]})}),e.jsxs(U,{children:[e.jsx(l,{color:"secondary",onClick:N,children:"Cancelar"}),e.jsxs(l,{style:{backgroundColor:"#E57368",color:"white"},onClick:pe,children:[e.jsx(v,{icon:ee,style:{marginRight:"5px"}})," Eliminar"]})]})]})]})};export{ho as default};
