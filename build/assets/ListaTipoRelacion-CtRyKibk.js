import{r as i,j as o}from"./index-SVRFFNc9.js";import{C as f}from"./index.esm-DWwMdKxH.js";import{S as a}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as Fe}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as U,a as Me}from"./xlsx-lwdk4T0U.js";import{F as Ie}from"./FileSaver.min-DN8zk8MP.js";import{l as ze}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as Ue}from"./usePermission-BCWksQX7.js";import Ae from"./AccessDenied-yaDW3Jao.js";import{C as Be}from"./CContainer-BdNP0s3v.js";import{C as ae,a as k}from"./CRow-Bf67u6lu.js";import{a as s}from"./CButton-D9GPTbB6.js";import{c as $e}from"./cil-plus-D8mtC-W5.js";import{C as We,a as He,b as Oe,c as ne}from"./CDropdownToggle-DlfIUTmX.js";import{C as se}from"./CInputGroup-D-McUFva.js";import{C as Ve}from"./CInputGroupText-Cfu0fzaY.js";import{c as Ye}from"./cil-search-CDkY_4k-.js";import{C as N}from"./CFormInput-B_gylY64.js";import{c as Ge}from"./cil-brush-alt-CV61lKqC.js";import{C as qe}from"./CFormSelect-CzT7g5tb.js";import{C as Ke,a as Je,b as le,c as A,d as Ze,e as B}from"./CTable-98qqrSRH.js";import{c as Qe}from"./cil-pen-53d2I-C-.js";import{c as Xe}from"./cil-trash-CBbKHhHb.js";import{C as eo}from"./CPagination-UopCEeNZ.js";import{C as $,a as W,b as H,c as O}from"./CModalHeader-Bhtr3bZe.js";import{C as V}from"./CModalTitle-M2mBvD_5.js";import{C as ce}from"./CForm-CYRkMwLo.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const zo=()=>{const{canSelect:de,canUpdate:pe,canDelete:me,canInsert:xe}=Ue("ListaRelacion"),[E,he]=i.useState([]),[D,oo]=i.useState({tipo_relacion:""}),[P,g]=i.useState(""),[ue,C]=i.useState(!1),[fe,b]=i.useState(!1),[ge,j]=i.useState(!1),[y,Y]=i.useState({tipo_relacion:""}),[u,L]=i.useState({}),[G,q]=i.useState({}),[K,J]=i.useState(""),[x,w]=i.useState(1),[Ce,R]=i.useState(!1),[h,be]=i.useState(10),[to,je]=i.useState("");i.useEffect(()=>{T()},[]);const T=async()=>{try{const t=await(await fetch("http://localhost:4000/api/tipoRelacion/verTodoTipoRelacion")).json();console.log("Datos obtenidos:",t);const r=t.map((l,c)=>({...l,originalIndex:c+1}));he(r)}catch(e){console.error("Error al obtener tipo relacion:",e)}},Z=e=>{const t=/^[a-zA-Z\s]*$/,r=!/\s{2,}/.test(e),l=e.trim().replace(/\s+/g," ");if(!t.test(l))return a.fire({icon:"warning",title:"Relación inválida",text:"La relación solo puede contener letras y espacios."}),!1;if(!r)return a.fire({icon:"warning",title:"Espacios múltiples",text:"No se permite más de un espacio entre palabras."}),!1;const c=l.split(" ");for(let n of c){const p={};for(let m of n)if(p[m]=(p[m]||0)+1,p[m]>4)return a.fire({icon:"warning",title:"Repetición de letras",text:`La letra "${m}" se repite más de 4 veces en la palabra "${n}".`}),!1}return!0},Q=e=>e.replace(/\b\w/g,t=>t.toUpperCase()),ye=()=>{const{tipo_relacion:e}=y;return e?!0:(a.fire({icon:"warning",title:"Campos vacíos",text:"Todos los campos deben estar llenos para poder crear una relación."}),!1)},F=()=>{const{tipo_relacion:e}=y,t=E.find(r=>r.tipo_relacion.toLowerCase()===e.toLowerCase());return t?(a.fire({icon:"warning",title:"Relacion duplicada",text:"Ya existe una relación con el mismo nombre."}),g(t?"Ya existe una relación con el mismo nombre":""),!0):!1},X=(e,t)=>{let r=e.target.value;if(r=r.replace(/\s{2,}/g," "),!r.split(" ").every(n=>!/(.)\1{3,}/.test(n))){a.fire({icon:"warning",title:"Repetición de letras",text:"No se permite que la misma letra se repita más de 4 veces consecutivas."});return}r.length<=2?g("La relacion debe tener más de 2 letras."):g(""),t(n=>({...n,tipo_relacion:r})),R(!0)},_=e=>{e.preventDefault(),a.fire({icon:"warning",title:"Acción bloqueada",text:"Copiar y pegar no está permitido."})},S=(e,t)=>{Ce?a.fire({title:"¿Estás seguro?",text:"Si cierras este formulario, perderás todos los datos ingresados.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&(e(!1),t(),R(!1))}):(e(!1),t())},M=()=>{Y({tipo_relacion:""})},I=()=>{L({tipo_relacion:""})},we=async()=>{if(F())return;const e=Q(y.tipo_relacion.trim().replace(/\s+/g," "));if(Z(e)&&ye()&&!F())try{(await fetch("http://localhost:4000/api/tipoRelacion/crearTipoRelacion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tipo_relacion:e})})).ok?(T(),C(!1),M(),R(!1),a.fire({icon:"success",title:"Creación exitosa",text:"La relacion ha sido creado correctamente."})):a.fire({icon:"error",title:"Error",text:"No se pudo crear la relacion."})}catch(t){console.error("Error al crear la relación:",t)}},Re=async()=>{const e=Q(u.tipo_relacion.trim().replace(/\s+/g," "));if(Z(e))try{(await fetch(`http://localhost:4000/api/tipoRelacion/actualizarTipoRelacion/${u.Cod_tipo_relacion}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Cod_tipo_relacion:u.Cod_tipo_relacion,tipo_relacion:e})})).ok?(T(),b(!1),I(),R(!1),a.fire({icon:"success",title:"Actualización exitosa",text:"La relacion ha sido actualizado correctamente."})):a.fire({icon:"error",title:"Error",text:"No se pudo actualizar la relación."})}catch(t){console.error("Error al actualizar la relacion:",t)}},Te=async()=>{try{(await fetch(`http://localhost:4000/api/tipoRelacion/eliminarTipoRelacion/${encodeURIComponent(G.Cod_tipo_relacion)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok?(T(),j(!1),q({}),a.fire({icon:"success",title:"Eliminación exitosa",text:"La relación ha sido eliminado correctamente."})):a.fire({icon:"error",title:"Error",text:"No se pudo eliminar la relación."})}catch(e){console.error("Error al eliminar la relación:",e)}},_e=e=>{L(e),je(e.tipo_relacion),b(!0)},Se=e=>{q(e),j(!0)},ve=e=>{J(e.target.value),w(1)},d=E.filter(e=>e.tipo_relacion&&e.tipo_relacion.toLowerCase().includes(K.toLowerCase())),ee=x*h,ke=ee-h,Ne=d.slice(ke,ee),oe=e=>{e>0&&e<=Math.ceil(d.length/h)&&w(e)},Ee=()=>{const e=new Fe("p","mm","letter");if(!d||d.length===0){alert("No hay datos para exportar.");return}const t=new Image;t.src=ze,t.onload=()=>{const r=e.internal.pageSize.width;e.addImage(t,"PNG",10,10,45,45),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",r/2,24,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",r/2,32,{align:"center"}),e.text("Teléfono: (504) 2234-8871",r/2,37,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",r/2,42,{align:"center"}),e.setFontSize(14),e.setTextColor(0,102,51),e.text("Reporte de Relaciones",r/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,60,r-10,60);const l=d.map((te,z)=>{var v;return{index:(z+1).toString(),tipo_relacion:((v=te.tipo_relacion)==null?void 0:v.toUpperCase())||"N/D"}}),c={index:20,tipo_relacion:100},n=c.index+c.tipo_relacion;e.autoTable({startY:65,margin:{left:(r-n)/2},columns:[{header:"#",dataKey:"index"},{header:"Tipo de Relación",dataKey:"tipo_relacion"}],body:l,headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:9,halign:"center"},styles:{fontSize:7,cellPadding:4},columnStyles:{index:{cellWidth:10},tipo_relacion:{cellWidth:90}},alternateRowStyles:{fillColor:[240,248,255]},didDrawPage:te=>{const z=e.internal.getNumberOfPages(),v=e.internal.getCurrentPageInfo().pageNumber,re=e.internal.pageSize.height-10;e.setFontSize(10),e.setTextColor(0,102,51),e.text(`Página ${v} de ${z}`,r-10,re,{align:"right"});const ie=new Date,Pe=ie.toLocaleDateString("es-HN",{year:"numeric",month:"long",day:"numeric"}),Le=ie.toLocaleTimeString("es-HN",{hour:"2-digit",minute:"2-digit",second:"2-digit"});e.text(`Fecha de generación: ${Pe} Hora: ${Le}`,10,re)}});const p=e.output("blob"),m=URL.createObjectURL(p);window.open("","_blank").document.write(`
      <html>
        <head><title>Reporte de Relaciones</title></head>
        <body style="margin:0;">
          <iframe width="100%" height="100%" src="${m}" frameborder="0"></iframe>
          <div style="position:fixed;top:10px;right:20px;">
            <button style="background-color: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;" 
              onclick="const a = document.createElement('a'); a.href='${m}'; a.download='Reporte_Relaciones.pdf'; a.click();">
              Descargar PDF
            </button>
            <button style="background-color: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;" 
              onclick="window.print();">
              Imprimir PDF
            </button>
          </div>
        </body>
      </html>`)},t.onerror=()=>{alert("No se pudo cargar el logo.")}},De=()=>{const e=E.map((n,p)=>({"#":p+1,"Tipo Relación":typeof n.tipo_relacion=="string"?n.tipo_relacion.toUpperCase():n.tipo_relacion})),t=U.json_to_sheet(e),r=U.book_new();U.book_append_sheet(r,t,"Tipo Relación");const l=Me(r,{bookType:"xlsx",type:"array"}),c=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ie.saveAs(c,"reporte_relacion.xlsx")};return de?o.jsxs(Be,{children:[o.jsxs(ae,{className:"align-items-center mb-5",children:[o.jsx(k,{xs:"8",md:"9",children:o.jsx("h1",{className:"mb-0",children:"Mantenimiento de Tipo Relaciones"})}),o.jsxs(k,{xs:"4",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[xe&&o.jsxs(s,{style:{backgroundColor:"#4B6251",color:"white"},className:"mb-3 mb-md-0 me-md-3",onClick:()=>C(!0),children:[o.jsx(f,{icon:$e})," Nuevo"]}),o.jsxs(We,{children:[o.jsx(He,{style:{backgroundColor:"#6C8E58",color:"white"},children:"Reportes"}),o.jsxs(Oe,{children:[o.jsx(ne,{onClick:De,children:"Descargar en Excel"}),o.jsx(ne,{onClick:Ee,children:"Descargar en PDF"})]})]})]})]}),o.jsxs(ae,{className:"align-items-center mt-4 mb-2",children:[o.jsx(k,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:o.jsxs(se,{className:"me-3",style:{width:"400px"},children:[o.jsx(Ve,{children:o.jsx(f,{icon:Ye})}),o.jsx(N,{placeholder:"Buscar tipo género...",onChange:ve,value:K}),o.jsxs(s,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{J(""),w(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[o.jsx(f,{icon:Ge})," Limpiar"]})]})}),o.jsx(k,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:o.jsx(se,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:o.jsxs("div",{className:"d-inline-flex align-items-center",children:[o.jsx("span",{children:"Mostrar "}),o.jsxs(qe,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const t=Number(e.target.value);be(t),w(1)},value:h,children:[o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"10",children:"10"}),o.jsx("option",{value:"20",children:"20"})]}),o.jsx("span",{children:" registros"})]})})})]}),o.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #ccc",padding:"10px",marginBottom:"30px"},children:o.jsxs(Ke,{striped:!0,children:[o.jsx(Je,{children:o.jsxs(le,{children:[o.jsx(A,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:" #"}),o.jsx(A,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:"Descripción"}),o.jsx(A,{className:"text-center",children:"Acciones"})]})}),o.jsx(Ze,{children:Ne.map(e=>o.jsxs(le,{children:[o.jsx(B,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:e.originalIndex}),o.jsxs(B,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:[e.tipo_relacion.toUpperCase(),"  "]}),o.jsx(B,{className:"text-center",children:o.jsxs("div",{className:"d-flex justify-content-center",children:[pe&&o.jsx(s,{color:"warning",onClick:()=>_e(e),style:{marginRight:"10px"},children:o.jsx(f,{icon:Qe})}),me&&o.jsx(s,{color:"danger",onClick:()=>Se(e),children:o.jsx(f,{icon:Xe})})]})})]},e.Cod_tipo_relacion))})]})}),o.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[o.jsxs(eo,{"aria-label":"Page navigation",children:[o.jsx(s,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:x===1,onClick:()=>oe(x-1),children:"Anterior"}),o.jsx(s,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:x===Math.ceil(d.length/h),onClick:()=>oe(x+1),children:"Siguiente"})]}),o.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",x," de ",Math.ceil(d.length/h)]})]}),o.jsxs($,{visible:ue,onClose:()=>S(C,M),backdrop:"static",children:[o.jsx(W,{children:o.jsx(V,{children:"Ingresar Nueva Relación"})}),o.jsx(H,{children:o.jsxs(ce,{children:[o.jsx(N,{label:"Tipo Relación",value:y.tipo_relacion,maxLength:50,onPaste:_,onCopy:_,onChange:e=>X(e,Y),onBlur:F,style:{textTransform:"uppercase"}}),P&&o.jsx("p",{style:{color:"red",fontSize:"0.9em"},children:P})]})}),o.jsxs(O,{children:[o.jsx(s,{color:"secondary",onClick:()=>S(C,M),children:"Cerrar"}),o.jsx(s,{color:"primary",onClick:we,disabled:!!P.tipo_relacion,children:"Guardar"})]})]}),o.jsxs($,{visible:fe,onClose:()=>S(b,I),backdrop:"static",children:[o.jsx(W,{children:o.jsx(V,{children:"Actualizar Relación"})}),o.jsxs(ce,{children:[o.jsxs(H,{children:[o.jsx(N,{label:"Identificador",value:u.Cod_tipo_relacion,readOnly:!0}),o.jsx(N,{label:"Tipo Relación",value:u.tipo_relacion,maxLength:50,onPaste:_,onCopy:_,onChange:e=>X(e,L),style:{textTransform:"uppercase"}}),D.tipo_relacion&&o.jsx("p",{style:{color:"red"},children:D.tipo_relacion})]}),o.jsxs(O,{children:[o.jsx(s,{color:"secondary",onClick:()=>S(b,I),children:"Cerrar"}),o.jsx(s,{color:"primary",onClick:Re,disabled:D.tipo_relacion,children:"Guardar"})]})]})]}),o.jsxs($,{visible:ge,onClose:()=>j(!1),backdrop:"static",children:[o.jsx(W,{children:o.jsx(V,{children:"Eliminar edificio"})}),o.jsxs(H,{children:['¿Estás seguro de que deseas eliminar el edificio "',G.tipo_relacion,'"?']}),o.jsxs(O,{children:[o.jsx(s,{color:"secondary",onClick:()=>j(!1),children:"Cancelar"}),o.jsx(s,{color:"danger",onClick:Te,children:"Eliminar"})]})]})]}):o.jsx(Ae,{})};export{zo as default};
