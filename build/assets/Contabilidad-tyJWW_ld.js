import{r as u,i as v,j as t}from"./index-SVRFFNc9.js";import{E as M}from"./jspdf.plugin.autotable-gke1D7B3.js";import{S as h}from"./sweetalert2.esm.all-D3pEHXw3.js";import{u as V}from"./usePermission-BCWksQX7.js";import W from"./AccessDenied-yaDW3Jao.js";import{l as q}from"./logo_saint_patrick-xw7Wl8f3.js";const Z=()=>{const{canSelect:z,canUpdate:f,canDelete:E,canInsert:D}=V("Contabilidad"),[F,y]=u.useState([]),[S,T]=u.useState([]),[g,O]=u.useState(""),[p,I]=u.useState(null),[w,N]=u.useState(!1),[a,s]=u.useState(null),L={Cod_cuenta:"",Nombre_cuenta:"",Descripcion:"",Tipo_Cuenta:"ACTIVO",Naturaleza_cuenta:"DEUDORA",Estado_Situacion_Financiera:"BALANCE GENERAL",Nivel:"1"};u.useEffect(()=>{_()},[]),u.useEffect(()=>{T(F.filter(e=>{var o,n;return((o=e.Nombre_cuenta)==null?void 0:o.toLowerCase().includes(g.toLowerCase()))||((n=e.Cod_cuenta)==null?void 0:n.toString().includes(g.toLowerCase()))}))},[g,F]);const _=async()=>{try{const e=await v.get("http://74.50.68.87:4000/api/catalogoCuentas",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});y(e.data),T(e.data)}catch(e){I("Error al cargar el catálogo de cuentas: "+e.message)}},R=()=>{s({Cod_cuenta:"",Nombre_cuenta:"",Descripcion:"",Tipo_Cuenta:"ACTIVO",Naturaleza_cuenta:"DEUDORA",Estado_Situacion_Financiera:"BALANCE GENERAL",Nivel:"1"}),N(!0)},B=e=>{s({...e,Tipo_Cuenta:e.Tipo_Cuenta||"ACTIVO",Naturaleza_cuenta:e.Naturaleza_cuenta||"DEUDORA",Estado_Situacion_Financiera:e.Estado_Situacion_Financiera||"BALANCE GENERAL",Nivel:e.Nivel||"1"}),N(!0)},P=async e=>{h.fire({title:"¿Está seguro?",text:"No podrá revertir esta acción!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar!",cancelButtonText:"Cancelar"}).then(async o=>{if(o.isConfirmed)try{await v.delete(`http://74.50.68.87:4000/api/catalogoCuentas/${e.Cod_cuenta}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),h.fire("Eliminado!","La cuenta ha sido eliminada.","success"),_()}catch(n){h.fire("Error!","Error al eliminar la cuenta: "+n.message,"error")}})},k=async e=>{var n,c;e.preventDefault();const o={nombre_cuenta:a.Nombre_cuenta,descripcion:a.Descripcion,tipo:a.Tipo_Cuenta,naturaleza_cuenta:a.Naturaleza_cuenta,estado_sf:a.Estado_Situacion_Financiera,nivel:a.Nivel};try{const r=localStorage.getItem("token");if(!r){h.fire({icon:"error",title:"Error de autenticación",text:"No estás autenticado. Inicia sesión para continuar."});return}const d={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};let i;a.Cod_cuenta?i=await v.put(`http://74.50.68.87:4000/api/catalogoCuentas/${a.Cod_cuenta}`,o,{headers:d}):i=await v.post("http://74.50.68.87:4000/api/catalogoCuentas",o,{headers:d}),(i.status===200||i.status===201)&&(N(!1),_(),s(L),h.fire({icon:"success",title:"¡Éxito!",text:a.Cod_cuenta?"Cuenta actualizada exitosamente":"Cuenta creada exitosamente",showConfirmButton:!1,timer:1500}))}catch(r){console.error("Error:",r),h.fire({icon:"error",title:"Error",text:((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Error al procesar la solicitud"})}},G=e=>{const o=e.reduce((r,d)=>{const i=d.Nivel;return r[i]=(r[i]||0)+1,r},{}),n=Object.keys(o).sort((r,d)=>r-d),c=n.map(r=>o[r]);return{labels:n,data:c}},U=()=>{const e=new M({orientation:"portrait",unit:"mm",format:"a4"}),o=new Image;o.src=q,o.onload=()=>{const n=e.internal.pageSize.width,c=e.internal.pageSize.height,r=()=>{const m="CONFIDENCIAL";e.saveGraphicsState(),e.setGState(new e.GState({opacity:.15})),e.setTextColor(220,53,69),e.setFontSize(50),e.setFont("helvetica","bold"),e.text(m,n/2,c/2,{angle:-45,align:"center",renderingMode:"fill"}),e.restoreGraphicsState()};e.addImage(o,"PNG",10,10,25,25),e.setTextColor(22,160,133),e.setFontSize(18),e.text("SAINT PATRICK'S ACADEMY",n/2,20,{align:"center"}),e.setFontSize(14),e.text("Catálogo de Cuentas Contables",n/2,30,{align:"center"}),e.setFontSize(8),e.setTextColor(68,68,68),e.text("Casa Club del periodista, Colonia del Periodista",n/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",n/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",n/2,50,{align:"center"});const d=localStorage.getItem("nombreUsuario")||"Usuario del Sistema";e.setFontSize(8),e.text(`Generado por: ${d}`,15,60),e.text(`Fecha: ${new Date().toLocaleDateString("es-HN")}`,n-15,60,{align:"right"}),r(),e.autoTable({startY:70,head:[["Código","Nombre","Naturaleza","Nivel"]],body:S.map(l=>[l.Cod_cuenta,l.Nombre_cuenta,l.Naturaleza_cuenta,l.Nivel]),styles:{fontSize:8,textColor:[68,68,68],cellPadding:4},headStyles:{fillColor:[22,160,133],textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",cellPadding:{top:4,bottom:4,left:3,right:3}},columnStyles:{0:{halign:"center",cellWidth:25},1:{cellWidth:85},2:{halign:"center",cellWidth:35},3:{halign:"center",cellWidth:20}},alternateRowStyles:{fillColor:[240,248,255]},margin:{top:10,right:10,bottom:30,left:10},didDrawPage:function(l){r(),e.addImage(o,"PNG",10,10,25,25),e.setFontSize(8),e.setTextColor(100);const m=new Date().toLocaleDateString("es-HN",{year:"numeric",month:"long",day:"numeric"});e.text(`Fecha de generación: ${m}`,10,c-10),e.text(`Página ${l.pageNumber}/${e.getNumberOfPages()}`,n-10,c-10,{align:"right"})}});const i=e.lastAutoTable.finalY+15;e.setFillColor(22,160,133),e.rect(10,i,n-20,8,"F"),e.setTextColor(255,255,255),e.setFontSize(10),e.text("Distribución de Cuentas por Nivel",n/2,i+5.5,{align:"center"});const x=G(S),$=Math.max(...x.data),C=20,j=40;let b=(n-x.labels.length*(C+10))/2;x.labels.forEach((l,m)=>{const A=x.data[m]/$*j;e.setFillColor(22,160,133),e.rect(b,i+15+(j-A),C,A,"F"),e.setFontSize(8),e.setTextColor(68,68,68),e.text(`Nivel ${l}`,b+C/2,i+j+20,{align:"center"}),e.text(x.data[m].toString(),b+C/2,i+12+(j-A),{align:"center"}),b+=C+10}),e.save("Catalogo_Cuentas.pdf")},o.onerror=()=>{h.fire("Error","No se pudo cargar el logo.","error")}};return z?t.jsx("div",{className:"catalogo-container",children:t.jsxs("div",{className:"catalogo-card",children:[t.jsx("div",{className:"button-container-top"}),t.jsxs("div",{className:"catalogo-header",children:[t.jsx("h1",{className:"catalogo-title",children:"Catálogo de Cuentas"}),t.jsxs("div",{className:"button-container",children:[D&&t.jsx("button",{onClick:R,className:"btn btn-primary",children:"Crear Cuenta Contable"}),t.jsx("button",{onClick:U,className:"btn btn-secondary",children:"Exportar PDF"})]})]}),t.jsxs("div",{className:"catalogo-content",children:[p&&t.jsx("div",{className:"error-message",children:p}),t.jsx("div",{className:"search-container",children:t.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar por código o nombre de cuenta...",value:g,onChange:e=>O(e.target.value)})}),t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"catalogo-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Código"}),t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Descripción"}),t.jsx("th",{children:"Naturaleza"}),t.jsx("th",{children:"Nivel"}),t.jsx("th",{children:"Fecha"}),(f||E)&&t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:S.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.Cod_cuenta}),t.jsx("td",{children:e.Nombre_cuenta}),t.jsx("td",{children:e.Descripcion}),t.jsx("td",{children:e.Naturaleza_cuenta}),t.jsx("td",{children:e.Nivel}),t.jsx("td",{children:new Date(e.Fecha_creacion).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}),(f||E)&&t.jsx("td",{children:t.jsxs("div",{className:"table-actions",children:[f&&t.jsx("button",{onClick:()=>B(e),className:"btn btn-warning",children:"Editar"}),E&&t.jsx("button",{onClick:()=>P(e),className:"btn btn-danger",children:"Eliminar"})]})})]},e.Cod_cuenta))})]})})]}),w&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h2",{className:"modal-title",children:a.Cod_cuenta?"Editar Cuenta Contable":"Crear Nueva Cuenta Contable"}),t.jsxs("form",{onSubmit:k,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Nombre_cuenta",children:"Nombre Cuenta *"}),t.jsx("input",{type:"text",id:"Nombre_cuenta",value:a.Nombre_cuenta,onChange:e=>s({...a,Nombre_cuenta:e.target.value}),required:!0,className:"form-input"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Descripcion",children:"Descripción *"}),t.jsx("input",{type:"text",id:"Descripcion",value:a.Descripcion,onChange:e=>s({...a,Descripcion:e.target.value}),required:!0,className:"form-input"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Tipo_Cuenta",children:"Tipo Cuenta *"}),t.jsxs("select",{id:"Tipo_Cuenta",value:a.Tipo_Cuenta,onChange:e=>s({...a,Tipo_Cuenta:e.target.value}),required:!0,className:"form-select",children:[t.jsx("option",{value:"ACTIVO",children:"ACTIVO"}),t.jsx("option",{value:"PASIVO",children:"PASIVO"}),t.jsx("option",{value:"PATRIMONIO",children:"PATRIMONIO"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Estado_Situacion_Financiera",children:"Estado de Situación Financiera *"}),t.jsxs("select",{id:"Estado_Situacion_Financiera",value:a.Estado_Situacion_Financiera,onChange:e=>s({...a,Estado_Situacion_Financiera:e.target.value}),required:!0,className:"form-select",children:[t.jsx("option",{value:"BALANCE GENERAL",children:"BALANCE GENERAL"}),t.jsx("option",{value:"ESTADO DE RESULTADO",children:"ESTADO DE RESULTADOS"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Naturaleza_cuenta",children:"Naturaleza de la Cuenta *"}),t.jsxs("select",{id:"Naturaleza_cuenta",value:a.Naturaleza_cuenta,onChange:e=>s({...a,Naturaleza_cuenta:e.target.value}),required:!0,className:"form-select",children:[t.jsx("option",{value:"ACREEDORA",children:"ACREEDORA"}),t.jsx("option",{value:"DEUDORA",children:"DEUDORA"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"Nivel",children:"Nivel *"}),t.jsxs("select",{id:"Nivel",value:a.Nivel,onChange:e=>s({...a,Nivel:e.target.value}),required:!0,className:"form-select",children:[t.jsx("option",{value:"1",children:"1"}),t.jsx("option",{value:"2",children:"2"}),t.jsx("option",{value:"3",children:"3"}),t.jsx("option",{value:"4",children:"4"})]})]}),p&&t.jsx("div",{className:"error-message",children:p}),t.jsxs("div",{className:"form-actions",children:[D,t.jsx("button",{type:"submit",className:"btn btn-primary",children:a.Cod_cuenta?"Actualizar Cuenta":"Crear Cuenta"}),t.jsx("button",{type:"button",onClick:()=>N(!1),className:"btn btn-secondary",children:"Cancelar"})]})]})]})})]})}):t.jsx(W,{})};export{Z as default};
