import{r as d,x as Se,j as o,h as $}from"./index-SVRFFNc9.js";import{C as u}from"./index.esm-DWwMdKxH.js";import{S as a}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as Ae}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as w,w as De}from"./xlsx-lwdk4T0U.js";import{l as Ee}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as ve}from"./usePermission-BCWksQX7.js";import Ne from"./AccessDenied-yaDW3Jao.js";import{C as _e}from"./CContainer-BdNP0s3v.js";import{C as oe,a as G}from"./CRow-Bf67u6lu.js";import{a as l}from"./CButton-D9GPTbB6.js";import{c as ze}from"./cil-plus-D8mtC-W5.js";import{C as Be,a as Ge,b as Re,c as re}from"./CDropdownToggle-DlfIUTmX.js";import{c as Pe}from"./cil-description-MUzg6O3n.js";import{c as Fe}from"./cil-file-CeQgYs_D.js";import{c as $e}from"./cil-spreadsheet-CJUvf_vM.js";import{C as R}from"./CInputGroup-D-McUFva.js";import{C as M}from"./CInputGroupText-Cfu0fzaY.js";import{c as Me}from"./cil-search-CDkY_4k-.js";import{C as I}from"./CFormInput-B_gylY64.js";import{c as Ie}from"./cil-brush-alt-CV61lKqC.js";import{C as Le}from"./CFormSelect-CzT7g5tb.js";import{C as Oe,a as He,b as te,c as L,d as Ue,e as O}from"./CTable-98qqrSRH.js";import{c as ae}from"./cil-pen-53d2I-C-.js";import{c as ie}from"./cil-trash-CBbKHhHb.js";import{C as Je}from"./CPagination-UopCEeNZ.js";import{C as H,a as U,b as J,c as V}from"./CModalHeader-Bhtr3bZe.js";import{C as W}from"./CModalTitle-M2mBvD_5.js";import{C as se}from"./CForm-CYRkMwLo.js";import{c as Ve}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const _o=()=>{const{canSelect:ne,loading:We,error:qe,canDelete:ce,canInsert:le,canUpdate:de}=ve("ListaGradoAcademico"),[P,pe]=d.useState([]),[me,T]=d.useState(!1),[ue,k]=d.useState(!1),[ge,S]=d.useState(!1),[h,F]=d.useState({Descripcion:""}),[x,y]=d.useState({}),[A,q]=d.useState({}),[Y,Z]=d.useState(""),[C,D]=d.useState(1),[j,xe]=d.useState(5),E=d.useRef(null),[he,f]=d.useState(!1);d.useEffect(()=>{z();const e=localStorage.getItem("token");if(e)try{const r=Se(e);console.log("Token decodificado:",r)}catch(r){console.error("Error al decodificar el token:",r)}},[]);const K=(e,r)=>{const t=e.target,i=t.selectionStart;let s=t.value.toUpperCase().trimStart();const g=/^[A-Z-Ñ\s]*$/;if(/\s{2,}/.test(s)&&(a.fire({icon:"warning",title:"Espacios múltiples",text:"No se permite más de un espacio entre palabras.",confirmButtonText:"Aceptar"}),s=s.replace(/\s+/g," ")),!g.test(s)){a.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten letras y espacios.",confirmButtonText:"Aceptar"});return}const n=s.split(" ");for(let c of n){const m={};for(let p of c)if(m[p]=(m[p]||0)+1,m[p]>4){a.fire({icon:"warning",title:"Repetición de letras",text:`La letra "${p}" se repite más de 4 veces en la palabra "${c}".`,confirmButtonText:"Aceptar"});return}}t.value=s,r(s),f(!0),requestAnimationFrame(()=>{E.current&&E.current.setSelectionRange(i,i)})},v=e=>{e.preventDefault(),a.fire({icon:"warning",title:"Accion bloquear",text:"Copiar y pegar no esta permitido",confirmButtonText:"Aceptar"})},N=(e,r)=>{he?a.fire({title:"¿Estás seguro?",text:"Si cierras este formulario, perderás todos los datos ingresados.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(e(!1),r(),f(!1))}):(e(!1),r(),f(!1))},_=()=>F({Descripcion:""}),fe=()=>y({}),z=async()=>{try{const t=(await(await fetch("http://localhost:4000/api/gradosAcademicos/verGradosAcademicos")).json()).map((i,s)=>({...i,originalIndex:s+1}));pe(t)}catch(e){console.error("Error al obtener los grados académicos:",e)}},be=async()=>{if(!h.Descripcion.trim()){a.fire({icon:"error",title:"Error",text:'El campo "Grado académico" no puede estar vacío',confirmButtonText:"Aceptar"});return}if(P.some(r=>r.Descripcion.trim().toLowerCase()===h.Descripcion.trim().toLowerCase())){a.fire({icon:"error",title:"Error",text:`El grado academico "${h.Descripcion}" ya existe`,confirmButtonText:"Aceptar"});return}try{const r=localStorage.getItem("token");if(!r){a.fire("Error","No tienes permiso para realizar esta acción","error");return}const t=$(r);if(!t.cod_usuario||!t.nombre_usuario)throw console.error("No se pudo obtener el código o el nombre de usuario del token"),new Error("No se pudo obtener el código o el nombre de usuario del token");const i=await fetch("http://localhost:4000/api/gradosAcademicos/crearGradoAcademico",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(h)});if(i.ok){const s=`El usuario: ${t.nombre_usuario} ha creado nuevo grado académico: ${h.Descripcion} `;(await fetch("http://localhost:4000/api/bitacora/registro",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({cod_usuario:t.cod_usuario,cod_objeto:56,accion:"INSERT",descripcion:s})})).ok?console.log("Registro en bitácora exitoso"):a.fire("Error","No se pudo registrar la acción en la bitácora","error"),z(),T(!1),_(),f(!1),F({Descripcion:""}),a.fire({icon:"success",title:"¡Éxito!",text:"El grado académico se ha creado correctamente",confirmButtonText:"Aceptar"})}else console.error("Hubo un problema al crear el grado académico:",i.statusText)}catch(r){console.error("Hubo un problema al crear el grado académico:",r)}},Ce=async()=>{if(!x.Descripcion.trim()){a.fire({icon:"error",title:"Error",text:'El campo "Grado académico" no puede estar vacío',confirmButtonText:"Aceptar"});return}if(P.some(r=>r.Descripcion.trim().toLowerCase()===x.Descripcion.trim().toLowerCase()&&r.Cod_grado_academico!==x.Cod_grado_academico)){a.fire({icon:"error",title:"Error",text:`El grado academico "${x.Descripcion}" ya existe`,confirmButtonText:"Aceptar"});return}try{const r=localStorage.getItem("token");if(!r){a.fire("Error","No tienes permiso para realizar esta acción","error");return}const t=$(r);if(!t.cod_usuario||!t.nombre_usuario)throw console.error("No se pudo obtener el código o el nombre de usuario del token"),new Error("No se pudo obtener el código o el nombre de usuario del token");const i=await fetch("http://localhost:4000/api/gradosAcademicos/actualizarGradoAcademico",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(x)});if(i.ok){const s=`El usuario: ${t.nombre_usuario} ha actualizado el grado académico a: ${x.Descripcion} con código ${x.Cod_grado_academico} `;(await fetch("http://localhost:4000/api/bitacora/registro",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({cod_usuario:t.cod_usuario,cod_objeto:56,accion:"UPDATE",descripcion:s})})).ok?console.log("Registro en bitácora exitoso"):a.fire("Error","No se pudo registrar la acción en la bitácora","error"),z(),k(!1),y(),f(!1),y({}),a.fire({icon:"success",title:"¡Éxito!",text:"El grado académico se ha actualizado correctamente",confirmButtonText:"Aceptar"})}else console.error("Hubo un problema al actualizar el grado académico:",i.statusText)}catch(r){console.error("Hubo un problema al actualizar el grado académico:",r)}},je=async()=>{try{const e=localStorage.getItem("token");if(!e){a.fire("Error","No tienes permiso para realizar esta acción","error");return}const r=$(e);if(!r.cod_usuario||!r.nombre_usuario)throw console.error("No se pudo obtener el código o el nombre de usuario del token"),new Error("No se pudo obtener el código o el nombre de usuario del token");const t=await fetch("http://localhost:4000/api/gradosAcademicos/eliminarGradoAcademico",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({Cod_grado_academico:A.Cod_grado_academico})});if(t.ok){const i=`El usuario: ${r.nombre_usuario} ha eliminado el grado académico: ${A.Descripcion} con código ${A.Cod_grado_academico} `;(await fetch("http://localhost:4000/api/bitacora/registro",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({cod_usuario:r.cod_usuario,cod_objeto:56,accion:"DELETE",descripcion:i,confirmButtonText:"Aceptar"})})).ok?console.log("Registro en bitácora exitoso"):a.fire("Error","No se pudo registrar la acción en la bitácora","error"),z(),S(!1),q({}),a.fire({icon:"success",title:"¡Éxito!",text:"El grado académico se ha eliminado correctamente",confirmButtonText:"Aceptar"})}else console.error("Hubo un problema al eliminar el grado académico",t.statusText)}catch(e){console.error("Hubo un problema al eliminar el grado académico",e)}},B=P.filter(e=>e.Descripcion.toLowerCase().includes(Y.toLowerCase())),Q=C*j,ye=Q-j,b=B.slice(ye,Q),X=e=>{e>0&&e<=Math.ceil(B.length/j)&&D(e)},we=e=>{let t=e.target.value.toUpperCase().trimStart();const i=/^[A-Z-Ñ\s]*$/;if(/\s{2,}/.test(t)&&(a.fire({icon:"warning",title:"Espacios múltiples",text:"No se permite más de un espacio entre palabras.",confirmButtonText:"Aceptar"}),t=t.replace(/\s+/g," ")),!i.test(t)){a.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten letras, números y espacios.",confirmButtonText:"Aceptar"});return}const s=t.split(" ");for(let g of s){const n={};for(let c of g)if(n[c]=(n[c]||0)+1,n[c]>4){a.fire({icon:"warning",title:"Repetición de letras",text:`La letra "${c}" se repite más de 4 veces en la palabra "${g}".`,confirmButtonText:"Aceptar"});return}}Z(t),D(1)};if(!ne)return o.jsx(Ne,{});const Te=()=>{if(!b||b.length===0){a.fire({icon:"info",title:"Tabla vacía",text:"No hay datos disponibles para generar el reporte.",confirmButtonText:"Aceptar"});return}const e=new Ae,r=new Image;r.src=Ee,r.onload=()=>{e.addImage(r,"PNG",10,10,30,30);let t=20;e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,t,{align:"center"}),t+=12,e.setFontSize(16),e.text("Reporte de Grados Académicos",e.internal.pageSize.width/2,t,{align:"center"}),t+=10,e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,t,{align:"center"}),t+=4,e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,t,{align:"center"}),t+=4,e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,t,{align:"center"}),t+=6,e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,t,e.internal.pageSize.width-10,t);const i=e.internal.pageSize.height;e.autoTable({startY:t+4,head:[["#","Grado Académico"]],body:b.map((n,c)=>[n.originalIndex,`${n.Descripcion||""}`.trim()]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3,halign:"center"},columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:"auto"}},alternateRowStyles:{fillColor:[240,248,255]},didDrawPage:n=>{const c=new Date,m=`${c.toLocaleDateString()} ${c.toLocaleTimeString()}`,p=e.internal.pageSize.height;e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y hora de generación: ${m}`,10,p-10)}});const s=e.internal.getNumberOfPages(),g=e.internal.pageSize.width;for(let n=1;n<=s;n++){e.setPage(n),e.setTextColor(100);const c=`Página ${n} de ${s}`;e.text(c,g-30,i-10)}window.open(e.output("bloburl"),"_blank")},r.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo."),window.open(e.output("bloburl"),"_blank")}},ke=()=>{if(!b||b.length===0){a.fire({icon:"info",title:"Tabla vacía",text:"No hay datos disponibles para generar el reporte Excel.",confirmButtonText:"Aceptar"});return}const e=[["Saint Patrick Academy"],["Reporte de Grados Académicos"],[],["#","Descripción del Grado Académico"]],r=b.map((m,p)=>[p+1,m.Descripcion||""]),t=[...e,...r],i=w.aoa_to_sheet(t),s=w.decode_range(i["!ref"]);for(let m=0;m<=3;m++)for(let p=s.s.c;p<=s.e.c;p++){const ee=w.encode_cell({r:m,c:p});i[ee]&&(i[ee].s={font:{bold:!0,sz:14,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"15401D"}},alignment:{horizontal:"center"}})}const g=[{wpx:50},{wpx:200}];i["!cols"]=g;const n=w.book_new();w.book_append_sheet(n,i,"Reporte de Grados Académicos"),De(n,"Reporte_Grados_Academicos.xlsx")};return o.jsxs(_e,{children:[o.jsxs(oe,{className:"align-items-center mb-5",children:[o.jsx(G,{xs:"12",md:"9",children:o.jsx("h1",{className:"mb-0",children:"Mantenimiento Grados Académicos"})}),o.jsxs(G,{xs:"12",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[le&&o.jsxs(l,{className:"mb-3 mb-md-0 me-md-3",style:{backgroundColor:"#4B6251",color:"white",transition:"all 0.3s ease",height:"40px",width:"auto",minWidth:"100px",padding:"0 16px",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#3C4B43",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#4B6251",e.currentTarget.style.boxShadow="none"},onClick:()=>{T(!0),f(!1)},children:[o.jsx(u,{icon:ze})," ","Nuevo"]}),o.jsxs(Be,{className:"btn-sm d-flex align-items-center gap-1 rounded shadow",children:[o.jsxs(Ge,{style:{backgroundColor:"#6C8E58",color:"white",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#5A784C",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#6C8E58",e.currentTarget.style.boxShadow="none"},children:[o.jsx(u,{icon:Pe})," Reporte"]}),o.jsxs(Re,{style:{position:"absolute",zIndex:1050,backgroundColor:"#fff",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.2)",borderRadius:"4px",overflow:"hidden"},children:[o.jsxs(re,{onClick:Te,style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",borderBottom:"1px solid #eaeaea",transition:"background-color 0.1s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[o.jsx(u,{icon:Fe,size:"sm"})," Abrir en PDF"]}),o.jsxs(re,{onClick:ke,style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[o.jsx(u,{icon:$e,size:"sm"})," Descargar Excel"]})]})]})]})]}),o.jsxs(oe,{className:"align-items-center mt-4 mb-2",children:[o.jsx(G,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:o.jsxs(R,{className:"me-3",style:{width:"400px"},children:[o.jsx(M,{children:o.jsx(u,{icon:Me})}),o.jsx(I,{placeholder:"Buscar grado academico...",onChange:we,value:Y}),o.jsxs(l,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{Z(""),D(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[o.jsx(u,{icon:Ie})," Limpiar"]})]})}),o.jsx(G,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:o.jsx(R,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:o.jsxs("div",{className:"d-inline-flex align-items-center",children:[o.jsx("span",{children:"Mostrar "}),o.jsxs(Le,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const r=Number(e.target.value);xe(r),D(1)},value:j,children:[o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"10",children:"10"}),o.jsx("option",{value:"20",children:"20"})]}),o.jsx("span",{children:" registros"})]})})})]}),o.jsx("div",{className:"table-container",style:{maxHeight:"400px",overflowY:"scroll",marginBottom:"20px"},children:o.jsxs(Oe,{striped:!0,bordered:!0,hover:!0,children:[o.jsx(He,{children:o.jsxs(te,{children:[o.jsx(L,{children:"#"}),o.jsx(L,{children:"Grado academico"}),o.jsx(L,{children:"Acciones"})]})}),o.jsx(Ue,{children:b.map((e,r)=>o.jsxs(te,{children:[o.jsx(O,{children:e.originalIndex}),o.jsx(O,{children:e.Descripcion}),o.jsxs(O,{children:[o.jsx(l,{style:{backgroundColor:"#F9B64E",marginRight:"10px"},onClick:()=>{y(e),k(!0),f(!1)},children:o.jsx(u,{icon:ae})}),o.jsx(l,{style:{backgroundColor:"#E57368",marginRight:"10px"},onClick:()=>{q(e),S(!0)},children:o.jsx(u,{icon:ie})})]})]},e.Cod_grado_academico))})]})}),o.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[o.jsxs(Je,{"aria-label":"Page navigation",children:[o.jsx(l,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:C===1,onClick:()=>X(C-1),children:"Anterior"}),o.jsx(l,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:C===Math.ceil(B.length/j),onClick:()=>X(C+1),children:"Siguiente"})]}),o.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",C," de ",Math.ceil(B.length/j)]})]}),o.jsxs(H,{visible:me,backdrop:"static",children:[o.jsxs(U,{closeButton:!1,children:[o.jsx(W,{children:"Nuevo Grado Académico"}),o.jsx(l,{className:"btn-close","aria-label":"Close",onClick:()=>N(T,_)})]}),o.jsx(J,{children:o.jsx(se,{children:o.jsxs(R,{className:"mb-3",children:[o.jsx(M,{children:"Grado académico"}),o.jsx(I,{ref:E,type:"text",placeholder:"Ingrese el grado académico",value:h.Descripcion,maxLength:50,onPaste:v,onCopy:v,onChange:e=>K(e,r=>F({...h,Descripcion:r}))})]})})}),o.jsxs(V,{children:[o.jsx(l,{color:"secondary",onClick:()=>N(T,_),children:"Cancelar"}),o.jsxs(l,{style:{backgroundColor:"#4B6251",color:"white"},onClick:be,children:[o.jsx(u,{icon:Ve,style:{marginRight:"5px"}}),"Guardar"]})]})]}),o.jsxs(H,{visible:ue,backdrop:"static",children:[o.jsxs(U,{closeButton:!1,children:[o.jsx(W,{children:"Actualizar Grado Académico"}),o.jsx(l,{className:"btn-close","aria-label":"Close",onClick:()=>N(k,_)})]}),o.jsx(J,{children:o.jsx(se,{children:o.jsxs(R,{className:"mb-3",children:[o.jsx(M,{children:"Grado académico"}),o.jsx(I,{ref:E,value:x.Descripcion||"",maxLength:50,onPaste:v,onCopy:v,onChange:e=>K(e,r=>y({...x,Descripcion:r}))})]})})}),o.jsxs(V,{children:[o.jsx(l,{color:"secondary",onClick:()=>N(k,fe),children:"Cancelar"}),de&&o.jsxs(l,{style:{backgroundColor:"#F9B64E",color:"white"},onClick:Ce,children:[o.jsx(u,{icon:ae,style:{marginRight:"5px"}}),"Actualizar"]})]})]}),o.jsxs(H,{visible:ge,onClose:()=>S(!1),backdrop:"static",children:[o.jsx(U,{children:o.jsx(W,{children:"Eliminar Grado Académico"})}),o.jsxs(J,{children:["¿Estás seguro de que deseas eliminar el grado académico: ",o.jsx("strong",{children:A.Descripcion}),"?"]}),o.jsxs(V,{children:[o.jsx(l,{color:"secondary",onClick:()=>S(!1),children:"Cancelar"}),ce&&o.jsxs(l,{style:{backgroundColor:"#E57368",color:"white"},onClick:je,children:[o.jsx(u,{icon:ie,style:{marginRight:"5px"}})," Eliminar"]})]})]})]})};export{_o as default};
