import{r as c,o as z,j as o,C as A,i as M}from"./index-SVRFFNc9.js";import{E as P}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as h,w as v}from"./xlsx-lwdk4T0U.js";import{l as R}from"./logo_saint_patrick-xw7Wl8f3.js";import{C as k}from"./CContainer-BdNP0s3v.js";import{C as L,a as B}from"./CRow-Bf67u6lu.js";import{a as G}from"./CButton-D9GPTbB6.js";import{C as I,a as U}from"./CCardBody-BwCgYaTs.js";import{C as H}from"./CCardTitle-BpfOpSSz.js";import{C as O}from"./CFormSelect-CzT7g5tb.js";import{C as W,a as X,b as Y,c as C}from"./CDropdownToggle-DlfIUTmX.js";import{C as K,a as V,b as S,c as n,d as q,e as l}from"./CTable-98qqrSRH.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CConditionalPortal-DwBsYzTA.js";const he=()=>{const[f,N]=c.useState([]),[x,w]=c.useState([]),[s,j]=c.useState(""),[_,g]=c.useState(!1),y=z(),T=async()=>{g(!0);try{const r=(await M.get("http://localhost:4000/api/matricula/matriculas-con-periodo")).data.data||[],t=[...new Set(r.map(i=>i.Anio_academico))].sort((i,d)=>d-i);N(t),w(r)}catch(e){console.error("Error al obtener las matrículas con el período académico:",e)}finally{g(!1)}},m=()=>s?x.filter(e=>String(e.Anio_academico)===String(s)):x,D=()=>{const e=new P,r=m();if(r.length===0){Swal.fire("Advertencia","No hay datos de matrículas para exportar.","warning");return}const t=new Image;t.src=R,t.onload=()=>{e.addImage(t,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14);const i=`Reporte de Matrículas ${s?` - ${s}`:""}`;e.text(i,e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55),e.setFontSize(12),e.setTextColor(0),e.text(`Año Académico: ${s||"N/A"}`,10,65),e.autoTable({startY:75,head:[["#","Código de Matrícula","Nombre del Estudiante","Fecha de Nacimiento","Grado","Sección"]],body:r.map((a,p)=>[p+1,a.codificacion_matricula,`${a.Nombre} ${a.Segundo_nombre||""} ${a.Primer_apellido||""} ${a.Segundo_apellido||""}`.trim(),a.fecha_nacimiento?new Date(a.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible",a.Nombre_grado||"No disponible",a.Nombre_seccion||"No disponible"]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]}});const d=e.internal.getNumberOfPages();for(let a=1;a<=d;a++){e.setPage(a);const p=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y Hora de Generación: ${p}`,10,e.internal.pageSize.height-10),e.text(`Página ${a} de ${d}`,e.internal.pageSize.width-30,e.internal.pageSize.height-10,{align:"right"})}const E=e.output("blob"),F=URL.createObjectURL(E),u=window.open(F,"_blank");u?u.document.title=`${i} (PDF)`:Swal.fire("Error","No se pudo abrir el reporte en una nueva pestaña.","error")},t.onerror=()=>{Swal.fire("Error","No se pudo cargar el logo.","error")}},$=()=>{const e=h.json_to_sheet(m().map((t,i)=>({"#":i+1,"Código de Matrícula":t.codificacion_matricula,"Nombre del Estudiante":`${t.Nombre} ${t.Segundo_nombre||""} ${t.Primer_apellido||""} ${t.Segundo_apellido||""}`.trim(),"Fecha de Nacimiento":t.fecha_nacimiento?new Date(t.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible",Grado:t.Nombre_grado||"No disponible",Sección:t.Nombre_seccion||"No disponible"}))),r=h.book_new();h.book_append_sheet(r,e,"Matrículas"),v(r,"Reporte_Matriculas.xlsx")};c.useEffect(()=>{T()},[]);const b=m();return o.jsx(k,{children:o.jsx(L,{className:"mb-4",children:o.jsxs(B,{xs:12,children:[o.jsxs(G,{style:{backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"5px",padding:"10px 20px",fontSize:"16px"},className:"mb-4",onClick:()=>y("/matricula"),children:[o.jsx("i",{className:"bi bi-arrow-left"})," Volver a Matrículas"]}),o.jsx(I,{className:"shadow-sm",children:o.jsxs(U,{children:[o.jsx(H,{className:"text-center mb-4",children:o.jsx("h4",{className:"fw-bold",children:"Matrículas por Año Académico"})}),o.jsx("div",{className:"d-flex justify-content-around mb-4",children:o.jsxs(O,{className:"form-select-lg border-primary shadow-sm",style:{width:"250px",borderRadius:"5px"},value:s,onChange:e=>j(e.target.value),children:[o.jsx("option",{value:"",children:"Selecciona un año"}),f.map(e=>o.jsx("option",{value:e,children:e},e))]})}),o.jsx("div",{className:"d-flex justify-content-end",children:o.jsxs(W,{children:[o.jsx(X,{color:"success",className:"shadow-sm",children:"Reporte"}),o.jsxs(Y,{children:[o.jsx(C,{onClick:D,children:"Exportar a PDF"}),o.jsx(C,{onClick:$,children:"Exportar a Excel"})]})]})}),_?o.jsx(A,{color:"primary",className:"d-block mx-auto mt-4"}):b.length>0?o.jsxs(K,{striped:!0,hover:!0,responsive:!0,className:"mt-4 shadow-sm",children:[o.jsx(V,{className:"bg-success text-white",children:o.jsxs(S,{children:[o.jsx(n,{children:"#"}),o.jsx(n,{children:"Código de Matrícula"}),o.jsx(n,{children:"Nombre del Estudiante"}),o.jsx(n,{children:"Fecha de Nacimiento"}),o.jsx(n,{children:"Grado"}),o.jsx(n,{children:"Sección"})]})}),o.jsx(q,{children:b.map((e,r)=>o.jsxs(S,{style:{borderBottom:"1px solid #dee2e6"},children:[o.jsx(l,{children:r+1}),o.jsx(l,{children:e.codificacion_matricula}),o.jsx(l,{children:`${e.Nombre} ${e.Segundo_nombre||""} ${e.Primer_apellido||""} ${e.Segundo_apellido||""}`.trim()}),o.jsx(l,{children:e.fecha_nacimiento?new Date(e.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible"}),o.jsx(l,{children:e.Nombre_grado||"No disponible"}),o.jsx(l,{children:e.Nombre_seccion||"No disponible"})]},r))})]}):o.jsx("p",{className:"text-center mt-4",children:"No hay matrículas registradas para el año académico seleccionado."})]})})]})})})};export{he as default};
