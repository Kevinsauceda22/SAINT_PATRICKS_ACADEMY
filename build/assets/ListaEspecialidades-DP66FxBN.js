import{r as n,j as a}from"./index-SVRFFNc9.js";import{C as p}from"./index.esm-DWwMdKxH.js";import{S as s}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as Se}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as y,w as Ne}from"./xlsx-lwdk4T0U.js";import{l as ke}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as Te}from"./usePermission-BCWksQX7.js";import ve from"./AccessDenied-yaDW3Jao.js";import{C as _e}from"./CContainer-BdNP0s3v.js";import{C as X,a as F}from"./CRow-Bf67u6lu.js";import{a as i}from"./CButton-D9GPTbB6.js";import{c as De}from"./cil-plus-D8mtC-W5.js";import{C as Pe,a as ze,b as Fe,c as ee}from"./CDropdownToggle-DlfIUTmX.js";import{c as Le}from"./cil-file-CeQgYs_D.js";import{c as Re}from"./cil-spreadsheet-CJUvf_vM.js";import{C as L}from"./CInputGroup-D-McUFva.js";import{C as A}from"./CInputGroupText-Cfu0fzaY.js";import{c as Ae}from"./cil-search-CDkY_4k-.js";import{C as M}from"./CFormInput-B_gylY64.js";import{c as Me}from"./cil-brush-alt-CV61lKqC.js";import{C as Be}from"./CFormSelect-CzT7g5tb.js";import{C as Ie,a as He,b as ae,c as B,d as Ue,e as I}from"./CTable-98qqrSRH.js";import{c as oe}from"./cil-pen-53d2I-C-.js";import{c as te}from"./cil-trash-CBbKHhHb.js";import{C as $e}from"./CPagination-UopCEeNZ.js";import{C as H,a as U,b as $,c as O}from"./CModalHeader-Bhtr3bZe.js";import{C as V}from"./CModalTitle-M2mBvD_5.js";import{C as re}from"./CForm-CYRkMwLo.js";import{c as Oe}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const ka=()=>{const{canSelect:se,loading:Ve,error:Ge,canDelete:ie,canInsert:le,canUpdate:ne}=Te("ListaEspecialidades"),[R,ce]=n.useState([]),[de,E]=n.useState(!1),[pe,w]=n.useState(!1),[me,S]=n.useState(!1),[f,N]=n.useState({Cod_Especialidad:"",Nombre_especialidad:""}),[x,k]=n.useState({}),[G,W]=n.useState({}),[q,J]=n.useState(""),[b,T]=n.useState(1),[C,xe]=n.useState(5),v=n.useRef(null),[ue,u]=n.useState(!1);n.useEffect(()=>{_()},[]);const _=async()=>{try{const t=(await(await fetch("http://localhost:4000/api/especialidades/verespecialidades")).json()).map((l,r)=>({...l,originalIndex:r+1}));ce(t)}catch(e){console.error("Error al obtener las especialidades:",e)}},Y=(e,o)=>{const t=e.target,l=t.selectionStart;let r=t.value.toUpperCase().trimStart();const g=/^[A-Z-Ñ\s]*$/;if(/\s{2,}/.test(r)&&(s.fire({icon:"warning",title:"Espacios múltiples",text:"No se permite más de un espacio entre palabras."}),r=r.replace(/\s+/g," ")),!g.test(r)){s.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten letras y espacios."});return}const m=r.split(" ");for(let j of m){const c={};for(let d of j)if(c[d]=(c[d]||0)+1,c[d]>4){s.fire({icon:"warning",title:"Repetición de letras",text:`La letra "${d}" se repite más de 4 veces en la palabra "${j}".`});return}}t.value=r,o(r),u(!0),requestAnimationFrame(()=>{v.current&&v.current.setSelectionRange(l,l)})},D=e=>{e.preventDefault(),s.fire({icon:"warning",title:"Accion bloquear",text:"Copiar y pegar no esta permitido"})},P=(e,o)=>{ue?s.fire({title:"¿Estás seguro?",text:"Si cierras este formulario, perderás todos los datos ingresados.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(e(!1),N({Cod_Especialidad:"",Nombre_especialidad:""}),u(!1))}):(e(!1),N({Cod_Especialidad:"",Nombre_especialidad:""}),u(!1))},he=()=>N(""),ge=()=>k(""),fe=async()=>{if(!f.Nombre_especialidad.trim()){s.fire({icon:"error",title:"Error",text:'El campo "Nombre especialidad" no puede estar vacío'});return}if(R.some(o=>o.Nombre_especialidad.trim().toLowerCase()===f.Nombre_especialidad.trim().toLowerCase())){s.fire({icon:"error",title:"Error",text:`La especialidad "${f.Nombre_especialidad}" ya existe`});return}try{const o=await fetch("http://localhost:4000/api/especialidades/crearespecialidad",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});o.ok?(_(),E(!1),he(),u(!1),s.fire({icon:"success",title:"¡Éxito!",text:"La especialidad se ha creado correctamente"})):console.error("Hubo un problema al crear la especialidad:",o.statusText)}catch(o){console.error("Hubo un problema al crear la especialidad:",o)}},be=async()=>{if(!x.Nombre_especialidad.trim()){s.fire({icon:"error",title:"Error",text:'El campo "Nombre especialidad" no puede estar vacío.'});return}if(R.some(o=>o.Nombre_especialidad.trim().toLowerCase()===x.Nombre_especialidad.trim().toLowerCase()&&o.Cod_Especialidad!==x.Cod_Especialidad)){s.fire({icon:"error",title:"Error",text:`La especialidad "${x.Nombre_especialidad}" ya existe`});return}try{const o=await fetch("http://localhost:4000/api/especialidades/actualizarespecialidad",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});o.ok?(_(),w(!1),ge(),u(!1),k({}),s.fire({icon:"success",title:"¡Éxito!",text:"La especialidad se ha actualizado correctamente"})):console.error("Hubo un problema al actualizar la especialidad:",o.statusText)}catch(o){console.error("Hubo un problema al actualizar la especialidad:",o)}},Ce=async()=>{try{const e=await fetch("http://localhost:4000/api/especialidades/eliminarespecialidad",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({Cod_Especialidad:G.Cod_Especialidad})});e.ok?(_(),S(!1),W({}),s.fire({icon:"success",title:"¡Éxito!",text:"La especialidad se ha eliminado correctamente"})):console.error("Hubo un problema al eliminar la especialidad:",e.statusText)}catch(e){console.error("Hubo un problema al eliminar la especialidad:",e)}},z=R.filter(e=>e.Nombre_especialidad.toLowerCase().includes(q.toLowerCase())),Z=b*C,je=Z-C,h=z.slice(je,Z),K=e=>{e>0&&e<=Math.ceil(z.length/C)&&T(e)},ye=e=>{const o=e.target.value.toUpperCase();if(!/^[A-ZÑ\s]*$/.test(o)){s.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten letras y espacios."});return}J(o),T(1)};if(!se)return a.jsx(ve,{});const Ee=()=>{if(!h||h.length===0){s.fire({icon:"info",title:"Tabla vacía",text:"No hay datos disponibles para generar el reporte.",confirmButtonText:"Aceptar"});return}const e=new Se,o=new Image;o.src=ke,o.onload=()=>{e.addImage(o,"PNG",10,10,30,30);let t=20;e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,t,{align:"center"}),t+=12,e.setFontSize(16),e.text("Reporte de Especialidades",e.internal.pageSize.width/2,t,{align:"center"}),t+=10,e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,t,{align:"center"}),t+=4,e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,t,{align:"center"}),t+=4,e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,t,{align:"center"}),t+=6,e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,t,e.internal.pageSize.width-10,t);const l=e.internal.pageSize.height;let r=1;e.autoTable({startY:t+4,head:[["#","Nombre de la Especialidad"]],body:h.map((g,m)=>[g.originalIndex,`${g.Nombre_especialidad||""}`.trim()]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3,halign:"center"},columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:"auto"}},alternateRowStyles:{fillColor:[240,248,255]},didDrawPage:g=>{const m=new Date,j=`${m.toLocaleDateString()} ${m.toLocaleTimeString()}`;e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y hora de generación: ${j}`,10,l-10);const c=e.internal.getNumberOfPages();e.text(`Página ${r} de ${c}`,e.internal.pageSize.width-30,l-10),r+=1}}),window.open(e.output("bloburl"),"_blank")},o.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo."),window.open(e.output("bloburl"),"_blank")}},we=()=>{if(!h||h.length===0){s.fire({icon:"info",title:"Tabla vacía",text:"No hay datos disponibles para generar el reporte Excel.",confirmButtonText:"Aceptar"});return}const e=[["Saint Patrick Academy"],["Reporte de Especialidades"],[],["#","Nombre Especialidad"]],o=h.map((c,d)=>[d+1,c.Nombre_especialidad||""]),t=[...e,...o],l=y.aoa_to_sheet(t),r=y.decode_range(l["!ref"]);for(let c=0;c<=3;c++)for(let d=r.s.c;d<=r.e.c;d++){const Q=y.encode_cell({r:c,c:d});l[Q]&&(l[Q].s={font:{bold:!0,sz:14,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"15401D"}},alignment:{horizontal:"center"}})}const g=[{wpx:50},{wpx:200}];l["!cols"]=g;const m=y.book_new();y.book_append_sheet(m,l,"Reporte de Especialidades"),Ne(m,"Reporte_Especialidades.xlsx")};return a.jsxs(_e,{children:[a.jsxs(X,{className:"align-items-center mb-5",children:[a.jsx(F,{xs:"8",md:"9",children:a.jsx("h1",{className:"mb-0",children:"Mantenimiento Especialidades"})}),a.jsxs(F,{xs:"4",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[le&&a.jsxs(i,{style:{backgroundColor:"#4B6251",color:"white"},className:"mb-3 mb-md-0 me-md-3",onClick:()=>{E(!0),u(!1)},children:[a.jsx(p,{icon:De})," ","Nuevo"]}),a.jsxs(Pe,{className:"btn-sm d-flex align-items-center gap-1 rounded shadow",children:[a.jsx(ze,{style:{backgroundColor:"#6C8E58",color:"white",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#5A784C",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#6C8E58",e.currentTarget.style.boxShadow="none"},children:"Reporte"}),a.jsxs(Fe,{style:{position:"absolute",zIndex:1050,backgroundColor:"#fff",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.2)",borderRadius:"4px",overflow:"hidden"},children:[a.jsxs(ee,{onClick:()=>Ee(),style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",borderBottom:"1px solid #eaeaea",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[a.jsx(p,{icon:Le,size:"sm"})," Abrir en PDF"]}),a.jsxs(ee,{onClick:we,style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[a.jsx(p,{icon:Re,size:"sm"})," Descargar Excel"]})]})]})]})]}),a.jsxs(X,{className:"align-items-center mt-4 mb-2",children:[a.jsx(F,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:a.jsxs(L,{className:"me-3",style:{width:"400px"},children:[a.jsx(A,{children:a.jsx(p,{icon:Ae})}),a.jsx(M,{placeholder:"Buscar especialidad...",onChange:ye,value:q}),a.jsxs(i,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{J(""),T(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[a.jsx(p,{icon:Me})," Limpiar"]})]})}),a.jsx(F,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:a.jsx(L,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:a.jsxs("div",{className:"d-inline-flex align-items-center",children:[a.jsx("span",{children:"Mostrar "}),a.jsxs(Be,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const o=Number(e.target.value);xe(o),T(1)},value:C,children:[a.jsx("option",{value:"5",children:"5"}),a.jsx("option",{value:"10",children:"10"}),a.jsx("option",{value:"20",children:"20"})]}),a.jsx("span",{children:" registros"})]})})})]}),a.jsx("div",{className:"table-container",style:{maxHeight:"400px",overflowY:"scroll",marginBottom:"20px"},children:a.jsxs(Ie,{striped:!0,bordered:!0,hover:!0,children:[a.jsx(He,{children:a.jsxs(ae,{children:[a.jsx(B,{children:"#"}),a.jsx(B,{children:"Nombre Especialidad"}),a.jsx(B,{children:"Acciones"})]})}),a.jsx(Ue,{children:h.map((e,o)=>a.jsxs(ae,{children:[a.jsx(I,{children:e.originalIndex}),a.jsx(I,{children:e.Nombre_especialidad}),a.jsxs(I,{children:[ne&&a.jsx(i,{style:{backgroundColor:"#F9B64E",marginRight:"10px"},onClick:()=>{k(e),w(!0),u(!1)},children:a.jsx(p,{icon:oe})}),ie&&a.jsx(i,{style:{backgroundColor:"#E57368",marginRight:"10px"},onClick:()=>{W(e),S(!0)},children:a.jsx(p,{icon:te})})]})]},e.Cod_Especialidad))})]})}),a.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[a.jsxs($e,{"aria-label":"Page navigation",children:[a.jsx(i,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:b===1,onClick:()=>K(b-1),children:"Anterior"}),a.jsx(i,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:b===Math.ceil(z.length/C),onClick:()=>K(b+1),children:"Siguiente"})]}),a.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",b," de ",Math.ceil(z.length/C)]})]}),a.jsxs(H,{visible:de,backdrop:"static",children:[a.jsxs(U,{closeButton:!1,children:[a.jsx(V,{children:"Nueva Especialidad"}),a.jsx(i,{className:"btn-close","aria-label":"Close",onClick:()=>P(E)})]}),a.jsx($,{children:a.jsx(re,{children:a.jsxs(L,{className:"mb-3",children:[a.jsx(A,{children:"Nombre especialidad"}),a.jsx(M,{ref:v,type:"text",placeholder:"Ingrese el tipo de especialidad",value:f.Nombre_especialidad,maxLength:50,onPaste:D,onCopy:D,onChange:e=>Y(e,o=>N({...f,Nombre_especialidad:o}))})]})})}),a.jsxs(O,{children:[a.jsx(i,{color:"secondary",onClick:()=>P(E),children:"Cancelar"}),a.jsxs(i,{style:{backgroundColor:"#4B6251",color:"white"},onClick:fe,children:[a.jsx(p,{icon:Oe,style:{marginRight:"5px"}}),"Guardar"]})]})]}),a.jsxs(H,{visible:pe,backdrop:"static",children:[a.jsxs(U,{closeButton:!1,children:[a.jsx(V,{children:"Actualizar Especialidad"}),a.jsx(i,{className:"btn-close","aria-label":"Close",onClick:()=>P(w)})]}),a.jsx($,{children:a.jsx(re,{children:a.jsxs(L,{className:"mb-3",children:[a.jsx(A,{children:"Nombre especialidad"}),a.jsx(M,{ref:v,value:x.Nombre_especialidad||"",maxLength:50,onPaste:D,onCopy:D,onChange:e=>Y(e,o=>k({...x,Nombre_especialidad:o}))})]})})}),a.jsxs(O,{children:[a.jsx(i,{color:"secondary",onClick:()=>P(w),children:"Cancelar"}),a.jsxs(i,{style:{backgroundColor:"#F9B64E",color:"white"},onClick:be,children:[a.jsx(p,{icon:oe,style:{marginRight:"5px"}}),"Actualizar"]})]})]}),a.jsxs(H,{visible:me,onClose:()=>S(!1),backdrop:"static",children:[a.jsx(U,{children:a.jsx(V,{children:"Eliminar Especialidad"})}),a.jsxs($,{children:["¿Está seguro de que desea eliminar la especialidad: ",a.jsx("strong",{children:G.Nombre_especialidad}),"?"]}),a.jsxs(O,{children:[a.jsx(i,{color:"secondary",onClick:()=>S(!1),children:"Cancelar"}),a.jsxs(i,{style:{backgroundColor:"#E57368",color:"white"},onClick:Ce,children:[a.jsx(p,{icon:te,style:{marginRight:"5px"}})," Eliminar"]})]})]})]})};export{ka as default};
