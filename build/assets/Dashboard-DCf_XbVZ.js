import{r as i,j as s,C as B,i as p,h as G}from"./index-SVRFFNc9.js";import{C as c}from"./index.esm-DWwMdKxH.js";import{u as I}from"./usePermission-BCWksQX7.js";import K from"./AccessDenied-yaDW3Jao.js";import{C as d,a as r}from"./CRow-Bf67u6lu.js";import{C as x}from"./CWidgetStatsA-DbuEXliJ.js";import{c as H}from"./cil-people-DQU-yEHN.js";import{c as $}from"./cil-user-follow-9sfVD_63.js";import{c as F}from"./cil-school-Bvyx_Ms4.js";import{c as z}from"./cil-money-Dk3vHnQB.js";import{C as h,a as m}from"./CCardBody-BwCgYaTs.js";import{C as j}from"./CCardHeader-C_B6DycW.js";import{R as f,L as v,C,X as b,Y as y,T as M,a as E,b as u}from"./LineChart-BTobNssh.js";import{C as N}from"./CProgress-CsL9dmPn.js";import{C as U,a as X,b as S,c as n,d as Y,e as l}from"./CTable-98qqrSRH.js";import"./clsx-B-dksMZM.js";import"./throttle-avksix55.js";const hs=()=>{const[w,g]=i.useState(!0),[e,P]=i.useState({totalEstudiantes:0,nuevasMatriculas:0,totalProfesores:0,matriculasActivas:0,matriculasPendientes:0,ingresosMensuales:0}),[T,W]=i.useState([]),[A,q]=i.useState([]),{canSelect:D,error:k}=I("Dashboard"),L=async(a,t)=>{try{const o=localStorage.getItem("token");if(!o)return;const _=G(o);await p.post("http://74.50.68.87:4000/api/bitacora/registro",{cod_usuario:_.cod_usuario,cod_objeto:78,accion:a,descripcion:t},{headers:{Authorization:`Bearer ${o}`}})}catch(o){console.error("Error al registrar en bitácora:",o)}};if(i.useEffect(()=>{(async()=>{try{g(!0);const t=localStorage.getItem("token");await L("SELECT","Acceso al Dashboard");const o=await p.get("http://74.50.68.87:4000/api/dashboard/stats",{headers:{Authorization:`Bearer ${t}`}});P(o.data)}catch(t){console.error("Error al cargar datos del dashboard:",t)}finally{g(!1)}})()},[]),w)return s.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:s.jsx(B,{color:"primary"})});if(k)return s.jsx("div",{className:"alert alert-danger",role:"alert",children:"Error al cargar los permisos. Por favor, intente nuevamente."});if(!D)return s.jsx(K,{});const R=[{name:"Total Estudiantes",value:e.totalEstudiantes},{name:"Nuevas Matrículas",value:e.nuevasMatriculas},{name:"Total Profesores",value:e.totalProfesores},{name:"Ingresos Mensuales",value:e.ingresosMensuales}];return s.jsxs(s.Fragment,{children:[s.jsxs(d,{children:[s.jsx(r,{sm:6,lg:3,children:s.jsx(x,{className:"mb-4",color:"primary",value:e.totalEstudiantes.toString(),title:"Total Estudiantes",icon:s.jsx(c,{icon:H,height:24})})}),s.jsx(r,{sm:6,lg:3,children:s.jsx(x,{className:"mb-4",color:"info",value:e.nuevasMatriculas.toString(),title:"Nuevas Matrículas",icon:s.jsx(c,{icon:$,height:24})})}),s.jsx(r,{sm:6,lg:3,children:s.jsx(x,{className:"mb-4",color:"success",value:e.totalProfesores.toString(),title:"Total Profesores",icon:s.jsx(c,{icon:F,height:24})})}),s.jsx(r,{sm:6,lg:3,children:s.jsx(x,{className:"mb-4",color:"warning",value:`L. ${e.ingresosMensuales.toLocaleString()}`,title:"Ingresos Mensuales",icon:s.jsx(c,{icon:z,height:24})})})]}),s.jsx(d,{children:s.jsx(r,{xs:12,children:s.jsxs(h,{className:"mb-4",children:[s.jsx(j,{children:"Métricas Clave"}),s.jsx(m,{children:s.jsx("div",{style:{width:"100%",height:"300px"},children:s.jsx(f,{children:s.jsxs(v,{data:R,children:[s.jsx(C,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"name"}),s.jsx(y,{}),s.jsx(M,{}),s.jsx(E,{}),s.jsx(u,{type:"monotone",dataKey:"value",stroke:"#8884d8"})]})})})})]})})}),s.jsxs(d,{children:[s.jsx(r,{xs:12,lg:8,children:s.jsxs(h,{className:"mb-4",children:[s.jsx(j,{children:"Matrículas por Grado"}),s.jsx(m,{children:s.jsx("div",{style:{width:"100%",height:"300px"},children:s.jsx(f,{children:s.jsxs(v,{data:T,children:[s.jsx(C,{strokeDasharray:"3 3"}),s.jsx(b,{dataKey:"grado"}),s.jsx(y,{}),s.jsx(M,{}),s.jsx(E,{}),s.jsx(u,{type:"monotone",dataKey:"matriculas",stroke:"#8884d8",name:"Estudiantes"}),s.jsx(u,{type:"monotone",dataKey:"capacidad",stroke:"#82ca9d",name:"Capacidad"})]})})})})]})}),s.jsx(r,{xs:12,lg:4,children:s.jsxs(h,{className:"mb-4",children:[s.jsx(j,{children:"Estado de Matrículas"}),s.jsxs(m,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[s.jsx("div",{children:"Matrículas Activas"}),s.jsxs("div",{children:[e.matriculasActivas,"%"]})]}),s.jsx(N,{value:e.matriculasActivas,color:"success"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[s.jsx("div",{children:"Matrículas Pendientes"}),s.jsxs("div",{children:[e.matriculasPendientes,"%"]})]}),s.jsx(N,{value:e.matriculasPendientes,color:"warning"})]})]})]})})]}),s.jsx(d,{children:s.jsx(r,{xs:12,children:s.jsxs(h,{className:"mb-4",children:[s.jsx(j,{children:s.jsx("strong",{children:"Últimas Matrículas Registradas"})}),s.jsx(m,{children:s.jsxs(U,{hover:!0,responsive:!0,children:[s.jsx(X,{children:s.jsxs(S,{children:[s.jsx(n,{children:"Código"}),s.jsx(n,{children:"Estudiante"}),s.jsx(n,{children:"Grado"}),s.jsx(n,{children:"Fecha"}),s.jsx(n,{children:"Estado"})]})}),s.jsx(Y,{children:A.map((a,t)=>s.jsxs(S,{children:[s.jsx(l,{children:a.codificacion_matricula}),s.jsx(l,{children:a.nombre_estudiante}),s.jsx(l,{children:a.grado}),s.jsx(l,{children:new Date(a.fecha_matricula).toLocaleDateString()}),s.jsx(l,{children:s.jsx("span",{className:`badge ${a.estado==="Activa"?"bg-success":"bg-warning"}`,children:a.estado})})]},t))})]})})]})})})]})};export{hs as default};
