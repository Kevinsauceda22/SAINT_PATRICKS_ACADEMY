import{o as A,r as t,j as e,h as S,i as j}from"./index-SVRFFNc9.js";/* empty css                 */import{S as U}from"./sweetalert2.esm.all-D3pEHXw3.js";const G=()=>{const I=A(),[r,p]=t.useState({dni_persona:"",Nombre:"",Segundo_nombre:"",Primer_apellido:"",Segundo_apellido:"",Nacionalidad:"",direccion_persona:"",fecha_nacimiento:"",cod_tipo_persona:"P",cod_departamento:"",cod_genero:"",cod_municipio:""}),[C,l]=t.useState(""),[v,u]=t.useState(!0),[F,D]=t.useState([]),[P,h]=t.useState([]),[y,f]=t.useState(!0),E=(a,o)=>["fecha_nacimiento","cod_departamento","cod_municipio","cod_genero"].includes(o)?a:a.toUpperCase(),c=a=>{const{name:o,value:n}=a.target;if(o==="dni_persona"){/^\d*$/.test(n)&&p(d=>({...d,[o]:n}));return}const s=E(n,o);p(d=>({...d,[o]:s}))},q=a=>{const o=a.target.value;p(n=>({...n,cod_departamento:o,cod_municipio:""}))},M=a=>{p(o=>({...o,cod_municipio:a.target.value}))};t.useEffect(()=>{(async()=>{var o,n;try{const s=localStorage.getItem("token");if(!s){l("No se encontró token de autenticación"),u(!1);return}const g=S(s).cod_usuario,i={headers:{Authorization:`Bearer ${s}`}},_=await j.get(`http://localhost:4000/api/usuarios/padre/datos-preregistro/${g}`,i);if(_.data.success){const x={Nombre:_.data.datos.nombre,Primer_apellido:_.data.datos.primer_apellido};p(m=>({...m,...x}))}const N=await j.get("http://localhost:4000/api/departamento/departamentos",i);if(N.data){const x=N.data.reduce((m,b)=>m.find(w=>w.cod_departamento===b.cod_departamento)?m:m.concat([b]),[]);D(x.sort((m,b)=>m.nombre_departamento.localeCompare(b.nombre_departamento)))}}catch(s){console.error("Error al cargar datos iniciales:",s),l(((n=(o=s.response)==null?void 0:o.data)==null?void 0:n.mensaje)||"Error al cargar los datos iniciales")}finally{u(!1)}})()},[]),t.useEffect(()=>{(async()=>{if(!r.cod_departamento){h([]),f(!0);return}try{const o=localStorage.getItem("token"),n=await j.get(`http://localhost:4000/api/departamento/municipios/${r.cod_departamento}`,{headers:{Authorization:`Bearer ${o}`}});n.data?(h(n.data),f(!1)):(h([]),f(!0))}catch(o){console.error("Error al cargar municipios:",o),h([]),f(!0),l("Error al cargar los municipios: "+o.message)}})()},[r.cod_departamento]);const $=a=>{if(!/^\d{13}$/.test(a))return"El DNI debe tener exactamente 13 dígitos";const o=parseInt(a.substring(0,4));if(o<101||o>909)return"Los primeros cuatro dígitos deben estar entre 0101 y 0909";const n=parseInt(a.substring(4,8));return n<1920||n>2020?"El año en el DNI debe estar entre 1920 y 2020":null},k=async a=>{var d,g;if(a.preventDefault(),l(""),["dni_persona","Nacionalidad","direccion_persona","fecha_nacimiento","cod_departamento","cod_genero","cod_municipio"].filter(i=>!r[i]).length>0){l("Por favor, complete todos los campos requeridos.");return}const s=$(r.dni_persona);if(s){l(s);return}u(!0);try{const i=localStorage.getItem("token"),N=S(i).cod_usuario,x=await j.put(`http://localhost:4000/api/usuarios/padre/completar-perfil/${N}`,r,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});U.fire({title:"Perfil completado exitosamente",icon:"success",showConfirmButton:!1,timer:2e3}).then(()=>{I("/dashboard")})}catch(i){console.error("Error al enviar datos:",i),l(((g=(d=i.response)==null?void 0:d.data)==null?void 0:g.mensaje)||"Error al actualizar el perfil. Por favor, intente nuevamente.")}finally{u(!1)}};return v?e.jsx("div",{className:"loading-spinner",children:"Cargando..."}):e.jsxs("div",{className:"profile-container",children:[e.jsxs("div",{className:"profile-header",children:[e.jsx("h1",{className:"profile-title",children:"Completar Perfil de Padre de Familia"}),e.jsx("p",{className:"profile-subtitle",children:"Complete la información faltante de su perfil"})]}),C&&e.jsx("div",{className:"error-message",children:C}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Información Personal"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"dni_persona",children:"DNI"}),e.jsx("input",{className:"form-input",id:"dni_persona",name:"dni_persona",value:r.dni_persona,onChange:c,placeholder:"Ingrese su DNI",maxLength:"13"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"nombre",children:"Primer Nombre"}),e.jsx("input",{className:"form-input",id:"nombre",name:"Nombre",value:r.Nombre,disabled:!0,placeholder:"Nombre pre-registrado"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"segundo_nombre",children:"Segundo Nombre"}),e.jsx("input",{className:"form-input",id:"segundo_nombre",name:"Segundo_nombre",value:r.Segundo_nombre,onChange:c,placeholder:"Ingrese su segundo nombre"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"primer_apellido",children:"Primer Apellido"}),e.jsx("input",{className:"form-input",id:"primer_apellido",name:"primer_apellido",value:r.Primer_apellido,disabled:!0,placeholder:"Apellido pre-registrado"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"segundo_apellido",children:"Segundo Apellido"}),e.jsx("input",{className:"form-input",id:"segundo_apellido",name:"Segundo_apellido",value:r.Segundo_apellido,onChange:c,placeholder:"Ingrese su segundo apellido"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"nacionalidad",children:"Nacionalidad"}),e.jsx("input",{className:"form-input",id:"nacionalidad",name:"Nacionalidad",value:r.Nacionalidad,onChange:c,placeholder:"Ingrese su nacionalidad"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"form-section-title",children:"Información de Contacto y Ubicación"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"direccion_persona",children:"Dirección"}),e.jsx("input",{className:"form-input",id:"direccion_persona",name:"direccion_persona",value:r.direccion_persona,onChange:c,placeholder:"Ingrese su dirección"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"fecha_nacimiento",children:"Fecha de Nacimiento"}),e.jsx("input",{className:"form-input",id:"fecha_nacimiento",name:"fecha_nacimiento",type:"date",value:r.fecha_nacimiento,onChange:c})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"cod_departamento",children:"Departamento"}),e.jsxs("select",{className:"form-input",id:"cod_departamento",name:"cod_departamento",value:r.cod_departamento,onChange:q,children:[e.jsx("option",{value:"",children:"Seleccione un departamento"}),F.map(a=>e.jsx("option",{value:a.cod_departamento,children:a.nombre_departamento.toUpperCase()},`dep-${a.cod_departamento}`))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"cod_municipio",children:"Municipio"}),e.jsxs("select",{className:"form-input",id:"cod_municipio",name:"cod_municipio",value:r.cod_municipio,onChange:M,disabled:y,children:[e.jsx("option",{value:"",children:"Seleccione un municipio"}),P.map(a=>e.jsx("option",{value:a.cod_municipio,children:a.nombre_municipio.toUpperCase()},`mun-${a.cod_municipio}`))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label required-field",htmlFor:"cod_genero",children:"Género"}),e.jsxs("select",{className:"form-input",id:"cod_genero",name:"cod_genero",value:r.cod_genero,onChange:c,children:[e.jsx("option",{value:"",children:"Seleccione un género"}),e.jsx("option",{value:"1",children:"Masculino"}),e.jsx("option",{value:"2",children:"Femenino"}),e.jsx("option",{value:"2",children:"No Binario"})]})]})]})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:v,children:v?"Guardando...":"Completar Perfil"})]})]})};export{G as default};
