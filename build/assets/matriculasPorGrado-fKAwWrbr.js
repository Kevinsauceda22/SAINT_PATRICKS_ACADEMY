import{o as k,r as s,j as o,C as F,i as N}from"./index-SVRFFNc9.js";import{E as L}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as x,w as M}from"./xlsx-lwdk4T0U.js";import{l as B}from"./logo_saint_patrick-xw7Wl8f3.js";import{C as I}from"./CContainer-BdNP0s3v.js";import{C as Y,a as H}from"./CRow-Bf67u6lu.js";import{a as U}from"./CButton-D9GPTbB6.js";import{C as O,a as W}from"./CCardBody-BwCgYaTs.js";import{C as X}from"./CCardTitle-BpfOpSSz.js";import{C as K,a as V,b as q,c as S}from"./CDropdownToggle-DlfIUTmX.js";import{C as J,a as Q,b as w,c as d,d as Z,e as m}from"./CTable-98qqrSRH.js";import"./CConditionalPortal-DwBsYzTA.js";const pe=()=>{const j=k(),[g,_]=s.useState([]),[l,u]=s.useState([]),[c,y]=s.useState(""),[i,b]=s.useState(null),[A,C]=s.useState(!1),[T,D]=s.useState([]),R=async()=>{try{const e=await N.get("http://localhost:4000/api/matricula/opciones"),t=e.data.periodos_matricula||[],a=[...new Set(t.map(n=>n.Anio_academico))].sort((n,p)=>p-n);D(a),b(a[0]),_(e.data.grados||[])}catch(e){console.error("Error al obtener los grados y los años académicos:",e)}},$=async(e,t)=>{if(!(!e||!t)){u([]),C(!0);try{const a=await N.get(`http://localhost:4000/api/matricula/alumnos/${e}`,{params:{anio_academico:t}});u(a.data.data||[])}catch(a){console.error("Error al obtener los alumnos matriculados por grado y año académico:",a)}finally{C(!1)}}};s.useEffect(()=>{R()},[]),s.useEffect(()=>{c&&i&&$(c,i)},[c,i]);const z=()=>{const e=new L;if(l.length===0){console.warn("No hay datos de alumnos para exportar.");return}const t=new Image;t.src=B,t.onload=()=>{e.addImage(t,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14),e.text("Reporte de Alumnos Matriculados",e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55);const a=g.find(r=>String(r.Cod_grado)===String(c)),n=a?a.Nombre_grado:"N/A";e.setFontSize(12),e.setTextColor(0),e.text(`Grado: ${n}`,10,65),e.text(`Año Académico: ${i||"N/A"}`,10,70),e.autoTable({startY:80,head:[["#","Nombre del Alumno","Fecha de Nacimiento","Grado","Sección"]],body:l.map((r,h)=>[h+1,`${r.Nombre||""} ${r.Segundo_nombre||""} ${r.Primer_apellido||""} ${r.Segundo_apellido||""}`.trim(),r.fecha_nacimiento?new Date(r.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible",r.Nombre_grado||"No disponible",r.Nombre_seccion||"No disponible"]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]}});const p=e.internal.getNumberOfPages();for(let r=1;r<=p;r++){e.setPage(r);const h=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y Hora de Generación: ${h}`,10,e.internal.pageSize.height-10),e.text(`Página ${r} de ${p}`,e.internal.pageSize.width-30,e.internal.pageSize.height-10,{align:"right"})}const v=e.output("blob"),P=URL.createObjectURL(v),G="Reporte de Alumnos Matriculados",f=window.open(P,"_blank");f?f.document.title=G:console.warn("No se pudo abrir el reporte en una nueva pestaña.")},t.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo.")}},E=()=>{const e=x.json_to_sheet(l.map((a,n)=>({"#":n+1,"Nombre del Alumno":`${a.Nombre||""} ${a.Segundo_nombre||""} ${a.Primer_apellido||""} ${a.Segundo_apellido||""}`.trim(),"Fecha de Nacimiento":a.fecha_nacimiento?new Date(a.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible",Grado:a.Nombre_grado||"No disponible",Sección:a.Nombre_seccion||"No disponible"}))),t=x.book_new();x.book_append_sheet(t,e,"Alumnos"),M(t,"Reporte_Alumnos_Matriculados.xlsx")};return o.jsx(I,{children:o.jsx(Y,{className:"mb-4",children:o.jsxs(H,{xs:12,children:[o.jsxs(U,{style:{backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"5px",padding:"10px 20px",fontSize:"16px"},className:"mb-4",onClick:()=>j("/matricula"),children:[o.jsx("i",{className:"bi bi-arrow-left"})," Volver a Matrículas"]}),o.jsx(O,{className:"shadow-sm",children:o.jsxs(W,{children:[o.jsxs(X,{className:"text-center mb-4",children:[o.jsx("h4",{className:"fw-bold",children:"Alumnos Matriculados por Grado"}),o.jsxs("p",{className:"text-muted",children:["Año Académico: ",i||"Cargando..."]})]}),o.jsxs("div",{className:"d-flex justify-content-around mb-4",children:[o.jsxs("select",{className:"form-select form-select-lg border-primary shadow-sm",style:{width:"250px",borderRadius:"5px"},value:c,onChange:e=>y(e.target.value),children:[o.jsx("option",{value:"",children:"Selecciona un grado"}),g.map(e=>o.jsx("option",{value:e.Cod_grado,children:e.Nombre_grado},e.Cod_grado))]}),o.jsx("select",{className:"form-select form-select-lg border-secondary shadow-sm",style:{width:"200px",borderRadius:"5px"},value:i,onChange:e=>b(e.target.value),children:T.map(e=>o.jsx("option",{value:e,children:e},e))})]}),o.jsx("div",{className:"d-flex justify-content-end",children:o.jsxs(K,{children:[o.jsx(V,{color:"success",className:"shadow-sm",children:"Reporte"}),o.jsxs(q,{children:[o.jsx(S,{onClick:z,children:"Exportar a PDF"}),o.jsx(S,{onClick:E,children:"Exportar a Excel"})]})]})}),A?o.jsx(F,{color:"primary",className:"d-block mx-auto mt-4"}):l.length>0?o.jsxs(J,{striped:!0,hover:!0,responsive:!0,className:"mt-4",style:{backgroundColor:"#f8f9fa",borderRadius:"10px"},children:[o.jsx(Q,{className:"bg-success text-white",children:o.jsxs(w,{children:[o.jsx(d,{children:"#"}),o.jsx(d,{children:"Nombre del Alumno"}),o.jsx(d,{children:"Fecha de Nacimiento"}),o.jsx(d,{children:"Grado"}),o.jsx(d,{children:"Sección"})]})}),o.jsx(Z,{children:l.map((e,t)=>o.jsxs(w,{style:{borderBottom:"1px solid #dee2e6"},children:[o.jsx(m,{children:t+1}),o.jsx(m,{children:`${e.Nombre||""} ${e.Segundo_nombre||""} ${e.Primer_apellido||""} ${e.Segundo_apellido||""}`.trim()}),o.jsx(m,{children:e.fecha_nacimiento?new Date(e.fecha_nacimiento).toLocaleDateString("es-ES"):"No disponible"}),o.jsx(m,{children:e.Nombre_grado||"No disponible"}),o.jsx(m,{children:e.Nombre_seccion||"No disponible"})]},t))})]}):o.jsxs("p",{className:"text-center mt-4",children:["No hay alumnos matriculados para el grado seleccionado en el año académico ",i,"."]})]})})]})})})};export{pe as default};
