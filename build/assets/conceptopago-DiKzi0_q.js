import{R as b,r as m,j as t,C as Pe}from"./index-SVRFFNc9.js";import{S as G}from"./sweetalert2.esm.all-D3pEHXw3.js";import{C as j}from"./index.esm-DWwMdKxH.js";import{E as Oe}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as De}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as H,w as ze}from"./xlsx-lwdk4T0U.js";import{u as Ae}from"./usePermission-BCWksQX7.js";import Te from"./AccessDenied-yaDW3Jao.js";import{C as W}from"./CContainer-BdNP0s3v.js";import{C as L,a as w}from"./CRow-Bf67u6lu.js";import{a as x}from"./CButton-D9GPTbB6.js";import{c as ke}from"./cil-plus-D8mtC-W5.js";import{C as Le,a as Fe,b as Ie,c as ee}from"./CDropdownToggle-DlfIUTmX.js";import{c as _e}from"./cil-file-CeQgYs_D.js";import{C as P}from"./CInputGroup-D-McUFva.js";import{C as F}from"./CInputGroupText-Cfu0fzaY.js";import{c as Ue}from"./cil-search-CDkY_4k-.js";import{C as q}from"./CFormInput-B_gylY64.js";import{c as Be}from"./cil-brush-alt-CV61lKqC.js";import{C as te}from"./CFormSelect-CzT7g5tb.js";import{C as Me,a as Re,b as oe,c as O,d as Ve,e as D}from"./CTable-98qqrSRH.js";import{c as $e}from"./cil-pen-53d2I-C-.js";import{c as Ge}from"./cil-trash-CBbKHhHb.js";import{C as He}from"./CPagination-UopCEeNZ.js";import{C as We,a as qe,b as Ye,c as Je}from"./CModalHeader-Bhtr3bZe.js";import{C as Ke}from"./CModalTitle-M2mBvD_5.js";import{C as Ze}from"./CForm-CYRkMwLo.js";import{c as Qe}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";var ce={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},re=b.createContext&&b.createContext(ce),Xe=["attr","size","title"];function et(o,n){if(o==null)return{};var c=tt(o,n),a,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(o);for(d=0;d<f.length;d++)a=f[d],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(o,a)&&(c[a]=o[a])}return c}function tt(o,n){if(o==null)return{};var c={};for(var a in o)if(Object.prototype.hasOwnProperty.call(o,a)){if(n.indexOf(a)>=0)continue;c[a]=o[a]}return c}function I(){return I=Object.assign?Object.assign.bind():function(o){for(var n=1;n<arguments.length;n++){var c=arguments[n];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(o[a]=c[a])}return o},I.apply(this,arguments)}function ne(o,n){var c=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(o,d).enumerable})),c.push.apply(c,a)}return c}function _(o){for(var n=1;n<arguments.length;n++){var c=arguments[n]!=null?arguments[n]:{};n%2?ne(Object(c),!0).forEach(function(a){ot(o,a,c[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(c)):ne(Object(c)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(c,a))})}return o}function ot(o,n,c){return n=rt(n),n in o?Object.defineProperty(o,n,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[n]=c,o}function rt(o){var n=nt(o,"string");return typeof n=="symbol"?n:n+""}function nt(o,n){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var a=c.call(o,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(o)}function ie(o){return o&&o.map((n,c)=>b.createElement(n.tag,_({key:c},n.attr),ie(n.child)))}function ae(o){return n=>b.createElement(ct,I({attr:_({},o.attr)},n),ie(o.child))}function ct(o){var n=c=>{var{attr:a,size:d,title:f}=o,U=et(o,Xe),z=d||c.size||"1em",h;return c.className&&(h=c.className),o.className&&(h=(h?h+" ":"")+o.className),b.createElement("svg",I({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},c.attr,a,U,{className:h,style:_(_({color:o.color||c.color},c.style),o.style),height:z,width:z,xmlns:"http://www.w3.org/2000/svg"}),f&&b.createElement("title",null,f),o.children)};return re!==void 0?b.createElement(re.Consumer,null,c=>n(c)):n(ce)}function it(o){return ae({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(o)}function at(o){return ae({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(o)}const Rt=()=>{const{canSelect:o,canDelete:n,canInsert:c,canUpdate:a}=Ae("conceptopago"),[d,f]=m.useState([]),[U,z]=m.useState(!0),[h,se]=m.useState(""),[le,Y]=m.useState(""),[B,J]=m.useState([]),[C,A]=m.useState(0),[S,de]=m.useState(5),[pe,v]=m.useState(!1),[T,K]=m.useState(!1),[s,E]=m.useState({codConcepto:null,concepto:"",descripcion:"",activo:"Si"}),[y,p]=m.useState({concepto:"",descripcion:"",activo:""}),me=e=>/^[A-Za-z\s]+$/.test(e),ue=e=>/^[A-Za-z0-9\s]+$/.test(e),Z=(e,r,i)=>e.length>=r&&e.length<=i,he=e=>{const r=d.find(i=>i.Concepto.toLowerCase()===e.toLowerCase());return r&&(!T||r.Cod_concepto!==s.codConcepto)?(p(i=>({...i,concepto:"El concepto ya existe en la tabla."})),!1):!0},M=e=>{const r=e.trim().toUpperCase();return me(r)?Z(r,3,30)?he(r)?(p(i=>({...i,concepto:""})),!0):!1:(p(i=>({...i,concepto:"El concepto debe tener entre 3 y 30 caracteres."})),!1):(p(i=>({...i,concepto:"El concepto solo debe contener letras y espacios."})),!1)},R=e=>{const r=e.trim().toUpperCase();return ue(r)?Z(r,5,100)?isNaN(r)?(p(i=>({...i,descripcion:""})),!0):(p(i=>({...i,descripcion:"La descripción no puede ser solo números."})),!1):(p(i=>({...i,descripcion:"La descripción debe tener entre 5 y 100 caracteres."})),!1):(p(i=>({...i,descripcion:"La descripción solo debe contener letras, números y espacios."})),!1)},V=e=>e!=="Si"&&e!=="No"?(p(r=>({...r,activo:'El campo "Activo" solo puede ser "Sí" o "No".'})),!1):(p(r=>({...r,activo:""})),!0),k=async()=>{try{const e=await fetch("http://74.50.68.87:4000/api/conceptopago/concepto-pago"),r=await e.json();if(e.ok)f(r),J(r);else throw new Error(r.message||"Error al obtener los conceptos de pago")}catch(e){se(e.message),u("Error al obtener datos",e.message,"error")}finally{z(!1)}},ge=async()=>{const e=M(s.concepto),r=R(s.descripcion),i=V(s.activo);if(!(!e||!r||!i))try{const l=await fetch(`http://74.50.68.87:4000/api/conceptopago/concepto-pago/${s.codConcepto}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Concepto:s.concepto.trim().toUpperCase(),Descripcion:s.descripcion.trim().toUpperCase(),Activo:s.activo})});if(l.ok)u("Actualización exitosa","Concepto de pago actualizado con éxito.","success"),await k();else{const N=await l.json();throw new Error(N.Mensaje||"Error al actualizar el concepto de pago")}}catch(l){u("Error al actualizar",l.message,"error")}finally{v(!1)}},xe=async()=>{const e=M(s.concepto),r=R(s.descripcion),i=V(s.activo);if(!(!e||!r||!i))try{const l=await fetch("http://74.50.68.87:4000/api/conceptopago/concepto-pago",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({concepto:s.concepto.trim().toUpperCase(),descripcion:s.descripcion.trim().toUpperCase(),activo:s.activo})}),N=await l.json();if(l.ok)u("Èxito","Concepto de pago guardado con éxito.","success"),k();else throw new Error(N.Mensaje||"Error al crear el concepto de pago")}catch(l){u("Error al crear",l.message,"error")}finally{v(!1)}},fe=async e=>{try{if((await fetch(`http://74.50.68.87:4000/api/conceptopago/concepto-pago/${e}`,{method:"DELETE"})).ok)u("Eliminación exitosa","Concepto de pago eliminado correctamente.","success"),k();else throw new Error("Error al eliminar el concepto de pago")}catch(r){u("Error al eliminar",r.message,"error")}},Ce=e=>{G.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&fe(e)})},je=e=>{const r=e.target.value.toLowerCase();Y(r);const i=d.filter(l=>l.Concepto.toLowerCase().includes(r));J(i),A(0)},be=()=>{E({codConcepto:null,concepto:"",descripcion:"",activo:"Si"}),K(!1),v(!0),p({concepto:"",descripcion:"",activo:""})},ve=e=>{E({codConcepto:e.Cod_concepto,concepto:e.Concepto,descripcion:e.Descripcion,activo:e.Activo}),K(!0),v(!0),p({concepto:"",descripcion:"",activo:""})},ye=e=>{if(e.preventDefault(),!s.concepto.trim()){u("Error","El nombre del concepto no puede estar vacío.","error");return}if(!s.descripcion.trim()){u("Error","La descripción no puede estar vacía.","error");return}T?ge():xe()},u=(e,r,i)=>{G.fire({title:e,text:r,icon:i,confirmButtonText:"Aceptar"})},we=()=>{const e=new Oe,r=new Image;r.src=De,r.onload=()=>{e.addImage(r,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14),e.text("Reporte de Conceptos de Pago",e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55),e.setFontSize(12),e.setTextColor(0,51,102),e.text("Detalles de los Conceptos de Pago",e.internal.pageSize.width/2,65,{align:"center"}),e.autoTable({startY:75,head:[["#","Concepto","Descripción","Activo"]],body:d.map((g,$)=>[$+1,g.Concepto||"N/A",g.Descripcion||"N/A",g.Activo==="SI"?"Sí":"No"]),styles:{fontSize:10,textColor:[34,34,34],cellPadding:4,valign:"middle",overflow:"linebreak"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:10,right:10}});const i=e.internal.getNumberOfPages();for(let g=1;g<=i;g++){e.setPage(g);const $=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y Hora de Generación: ${$}`,10,e.internal.pageSize.height-10),e.text(`Página ${g} de ${i}`,e.internal.pageSize.width-30,e.internal.pageSize.height-10,{align:"right"})}const l=e.output("blob"),N=URL.createObjectURL(l);window.open(N)},r.onerror=()=>{G.fire("Error","No se pudo cargar el logo.","error")}},Se=()=>{const e=H.json_to_sheet(d.map((i,l)=>({"#":l+1,Concepto:i.Concepto,Descripción:i.Descripcion,Activo:i.Activo==="SI"?"Sí":"No"}))),r=H.book_new();H.book_append_sheet(r,e,"Conceptos de Pago"),ze(r,"Reporte_Conceptos_Pago.xlsx")};m.useEffect(()=>{k()},[]);const Q=(C+1)*S,Ee=Q-S,Ne=B.slice(Ee,Q);if(U)return t.jsx(W,{children:t.jsx(L,{className:"justify-content-center",children:t.jsxs(w,{xs:12,md:6,children:[t.jsx(Pe,{color:"primary"}),t.jsx("p",{children:"Cargando conceptos de pago..."})]})})});if(h)return t.jsx(W,{children:t.jsx(L,{className:"justify-content-center",children:t.jsx(w,{xs:12,md:6,children:t.jsxs("p",{children:["Error: ",h]})})})});const X=Math.ceil(B.length/S);return o?t.jsxs(W,{children:[t.jsxs(L,{className:"justify-content-between align-items-center mb-3",children:[t.jsx(w,{xs:12,md:8,children:t.jsx("h3",{children:"Mantenimiento de Conceptos de Pago"})}),t.jsxs(w,{xs:"4",md:"3",className:"text-end",children:[c&&t.jsxs(x,{color:"dark",onClick:()=>be(),className:"me-2",style:{backgroundColor:"#4B6251",borderColor:"#0F463A"},children:[t.jsx(j,{icon:ke})," Nuevo"]}),t.jsxs(Le,{children:[t.jsxs(Fe,{style:{backgroundColor:"#6C8E58",borderColor:"#617341"},children:[t.jsx(j,{icon:_e})," Reporte"]}),t.jsxs(Ie,{children:[t.jsx(ee,{onClick:we,children:"Exportar a PDF"}),t.jsx(ee,{onClick:Se,children:"Exportar a Excel"})]})]})]})]}),t.jsxs(L,{className:"align-items-center my-3",children:[t.jsx(w,{md:5,children:t.jsxs(P,{size:"sm",children:[t.jsx(F,{children:t.jsx(j,{icon:Ue})}),t.jsx(q,{placeholder:"Buscar concepto de pago",value:le,onChange:je}),t.jsxs(x,{style:{border:"1px solid #ccc",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>Y(""),children:[t.jsx(j,{icon:Be})," Limpiar"]})]})}),t.jsx(w,{xs:"12",md:"7",className:"text-md-end mt-2 mt-md-0",children:t.jsx(P,{style:{width:"auto",display:"inline-block"},children:t.jsxs("div",{className:"d-inline-flex align-items-center",children:[t.jsx("span",{children:"Mostrar "}),t.jsxs(te,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{de(Number(e.target.value)),A(0)},value:S,children:[t.jsx("option",{value:"5",children:"5"}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"20",children:"20"})]}),t.jsx("span",{children:" registros"})]})})})]}),t.jsx("div",{className:"table-container",children:t.jsxs(Me,{striped:!0,bordered:!0,hover:!0,children:[t.jsx(Re,{children:t.jsxs(oe,{children:[t.jsx(O,{children:"#"}),t.jsx(O,{children:"Nombre del Concepto"}),t.jsx(O,{children:"Descripción"}),t.jsx(O,{children:"Activo"}),t.jsx(O,{className:"text-end",children:"Acciones"})]})}),t.jsx(Ve,{children:Ne.map((e,r)=>t.jsxs(oe,{children:[t.jsx(D,{children:r+1+C*S}),t.jsx(D,{children:e.Concepto.toUpperCase()}),t.jsx(D,{children:e.Descripcion.toUpperCase()}),t.jsx(D,{className:"text-center",children:e.Activo.toUpperCase()==="SI"?t.jsx(it,{color:"green"}):t.jsx(at,{color:"red"})}),t.jsxs(D,{className:"text-end",children:[a&&t.jsx(x,{color:"warning",size:"sm",style:{opacity:.8},onClick:()=>ve(e),children:t.jsx(j,{icon:$e})})," ",n&&t.jsx(x,{color:"danger",size:"sm",style:{opacity:.8},onClick:()=>Ce(e.Cod_concepto),children:t.jsx(j,{icon:Ge})})]})]},e.Cod_concepto))})]})}),t.jsxs("nav",{className:"d-flex justify-content-center align-items-center mt-4",children:[t.jsxs(He,{className:"mb-0",style:{gap:"0.3cm"},children:[t.jsx(x,{style:{backgroundColor:"gray",color:"white",marginRight:"0.3cm"},disabled:C===0,onClick:()=>A(C-1),children:"Anterior"}),t.jsx(x,{style:{backgroundColor:"gray",color:"white"},disabled:C===X-1,onClick:()=>A(C+1),children:"Siguiente"})]}),t.jsxs("span",{className:"mx-2",children:["Página ",C+1," de ",X]})]}),t.jsxs(We,{visible:pe,onClose:()=>v(!1),backdrop:"static",children:[t.jsx(qe,{closeButton:!0,children:t.jsx(Ke,{children:T?"Editar Concepto de Pago":"Agregar Concepto de Pago"})}),t.jsx(Ye,{children:t.jsxs(Ze,{onSubmit:ye,children:[t.jsxs(P,{className:"mb-3",children:[t.jsx(F,{children:"Nombre del Concepto"}),t.jsx(q,{type:"text",placeholder:"Nombre del concepto",value:s.concepto.toUpperCase(),onChange:e=>{E({...s,concepto:e.target.value.toUpperCase()}),M(e.target.value)},required:!0}),y.concepto&&t.jsx("p",{className:"text-danger",children:y.concepto})]}),t.jsxs(P,{className:"mb-3",children:[t.jsx(F,{children:"Descripción"}),t.jsx(q,{as:"textarea",rows:3,placeholder:"Descripción",value:s.descripcion.toUpperCase(),onChange:e=>{E({...s,descripcion:e.target.value.toUpperCase()}),R(e.target.value)},required:!0}),y.descripcion&&t.jsx("p",{className:"text-danger",children:y.descripcion})]}),t.jsxs(P,{className:"mb-3",children:[t.jsx(F,{children:"Selecionar Activo"}),t.jsxs(te,{value:s.activo,onChange:e=>{E({...s,activo:e.target.value}),V(e.target.value)},required:!0,children:[t.jsx("option",{value:"Si",children:"Sí"}),t.jsx("option",{value:"No",children:"No"})]})]}),y.activo&&t.jsx("p",{className:"text-danger mt-2",children:y.activo}),t.jsxs(Je,{children:[t.jsx(x,{style:{backgroundColor:"#6c757d",color:"white",borderColor:"#6c757d"},onClick:()=>v(!1),children:"Cancelar"}),t.jsxs(x,{style:{backgroundColor:"#4B6251",color:"white",borderColor:"#4B6251"},type:"submit",children:[t.jsx(j,{icon:Qe})," ","Guardar"]})]})]})})]}),t.jsx("style",{jsx:!0,children:`
        .table-container {
          max-height: 400px;
          overflow-y: ${B.length>=5?"auto":"hidden"};
          overflow-x: hidden;
        }

        /* Personalización de la barra de desplazamiento */
        .table-container::-webkit-scrollbar {
          width: 10px;
        }

        .table-container::-webkit-scrollbar-thumb {
          background-color: #888;
          border-radius: 5px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
          background-color: #555;
        }
      `})]}):t.jsx(Te,{})};export{Rt as default};
