import{r as n,j as a}from"./index-SVRFFNc9.js";import{C as g}from"./index.esm-DWwMdKxH.js";import{S as W}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as ue}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as E,a as fe}from"./xlsx-lwdk4T0U.js";import{F as je}from"./FileSaver.min-DN8zk8MP.js";import{u as ye}from"./usePermission-BCWksQX7.js";import Ne from"./AccessDenied-yaDW3Jao.js";import{C as be}from"./CContainer-BdNP0s3v.js";import{C as O,a as k}from"./CRow-Bf67u6lu.js";import{a as i}from"./CButton-D9GPTbB6.js";import{c as Te}from"./cil-plus-D8mtC-W5.js";import{C as ve,a as we,b as Se,c as V}from"./CDropdownToggle-DlfIUTmX.js";import{C as G}from"./CInputGroup-D-McUFva.js";import{C as Pe}from"./CInputGroupText-Cfu0fzaY.js";import{c as ke}from"./cil-search-CDkY_4k-.js";import{C as d}from"./CFormInput-B_gylY64.js";import{c as Ie}from"./cil-brush-alt-CV61lKqC.js";import{C as _e}from"./CFormSelect-CzT7g5tb.js";import{C as De,a as Ee,b as $,c as u,d as Re,e as f}from"./CTable-98qqrSRH.js";import{c as Ue}from"./cil-pen-53d2I-C-.js";import{c as Le}from"./cil-trash-CBbKHhHb.js";import{C as Me}from"./CPagination-UopCEeNZ.js";import{C as R,a as U,b as L,c as M}from"./CModalHeader-Bhtr3bZe.js";import{C as F}from"./CModalTitle-M2mBvD_5.js";import{C as q}from"./CForm-CYRkMwLo.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const ga=()=>{const{canSelect:J,canUpdate:Y,canDelete:K,canInsert:Q}=ye("ListaNacionalidad"),[X,Z]=n.useState([]),[I,Fe]=n.useState({pais_nacionalidad:""}),[ee,j]=n.useState(!1),[ae,y]=n.useState(!1),[oe,N]=n.useState(!1),[C,b]=n.useState({pais_nacionalidad:"",pais:""}),[h,_]=n.useState({}),[A,Ae]=n.useState({}),[T,B]=n.useState(""),[m,v]=n.useState(1),[se,te]=n.useState(!1),[x,ne]=n.useState(10);n.useEffect(()=>{w()},[]);const w=async()=>{try{const o=await(await fetch("http://74.50.68.87:4000/api/nacionalidad/verNacionalidades")).json();console.log("Datos obtenidos:",o);const l=o.map((p,r)=>({...p,originalIndex:r+1}));Z(l)}catch(e){console.error("Error al obtener nacionalidades:",e)}},ie=async()=>{try{const e=await fetch("http://74.50.68.87:4000/api/nacionalidad/crearNacionalidades",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}),o=await e.json();e.ok?(w(),j(!1)):console.error("Error al crear nacionalidad:",o)}catch(e){console.error("Error en el servidor:",e)}},re=async()=>{try{const e=await fetch(`http://74.50.68.87:4000/api/nacionalidad/actualizarNacionalidades/${h.Cod_nacionalidad}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),o=await e.json();e.ok?(w(),y(!1)):console.error("Error al actualizar nacionalidad:",o)}catch(e){console.error("Error en el servidor:",e)}},le=async()=>{try{const e=await fetch(`http://74.50.68.87:4000/api/nacionalidad/eliminarNacionalidades/${A.Cod_nacionalidad}`,{method:"DELETE"}),o=await e.json();e.ok?(w(),N(!1)):console.error("Error al eliminar nacionalidad:",o)}catch(e){console.error("Error en el servidor:",e)}},c=e=>{setDescripcion(e.target.value.toUpperCase())},s=e=>{e.preventDefault(),W.fire({icon:"warning",title:"Acción bloqueada",text:"Copiar y pegar no está permitido."})},S=(e,o)=>{se?W.fire({title:"¿Estás seguro?",text:"Si cierras este formulario, perderás todos los datos ingresados.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"}).then(l=>{l.isConfirmed&&(e(!1),o(),te(!1))}):(e(!1),o())},de=e=>{setTipoRelacionToUpdate(e),setTipo_relacion(e.tipo_relacion),y(!0)},ce=e=>{setTipoRelacionToDelete(e),N(!0)},pe=e=>{B(e.target.value),v(1)},P=X.filter(e=>e.Id_nacionalidad&&e.Id_nacionalidad.toLowerCase().includes(T.toLowerCase())||e.pais_nacionalidad&&e.pais_nacionalidad.toLowerCase().includes(T.toLowerCase())||e.pais&&e.pais.toLowerCase().includes(T.toLowerCase())),z=m*x,he=z-x,me=P.slice(he,z),H=e=>{e>0&&e<=Math.ceil(P.length/x)&&v(e)},xe=()=>{const e=nacionalidad.map((t,D)=>({"#":D+1,"Código Nacionalidad":t.Cod_nacionalidad,"ID Nacionalidad":t.Id_nacionalidad,"País Nacionalidad":typeof t.pais_nacionalidad=="string"?t.pais_nacionalidad.toUpperCase():t.pais_nacionalidad,País:typeof t.pais=="string"?t.pais.toUpperCase():t.pais})),o=E.json_to_sheet(e),l=E.book_new();E.book_append_sheet(l,o,"Nacionalidad");const p=fe(l,{bookType:"xlsx",type:"array"}),r=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});je.saveAs(r,"reporte_nacionalidad.xlsx")},Ce=()=>{const e=new ue("l","mm","letter"),o=e.internal.pageSize.getWidth(),l=e.internal.pageSize.getHeight(),p=new Image;p.src=logo,p.onload=()=>{e.addImage(p,"PNG",10,10,20,20),e.setTextColor(22,160,133),e.setFontSize(14),e.text("SAINT PATRICK'S ACADEMY",35,15,{align:"left"}),e.setFontSize(10),e.text("Reporte de Nacionalidades",35,22,{align:"left"}),e.setFontSize(8),e.setTextColor(68,68,68),e.text("Casa Club del periodista, Colonia del Periodista",35,30,{align:"left"}),e.text("Teléfono: (504) 2234-8871",35,35,{align:"left"}),e.text("Correo: info@saintpatrickacademy.edu",35,40,{align:"left"}),e.autoTable({head:[["#","Código Nacionalidad","ID Nacionalidad","País Nacionalidad","País"]],body:nacionalidad.map((r,t)=>[t+1,r.Cod_nacionalidad,r.Id_nacionalidad,r.pais_nacionalidad.toUpperCase(),r.pais.toUpperCase()]),styles:{fontSize:6,textColor:[68,68,68],cellPadding:2},headStyles:{fillColor:[22,160,133],textColor:[255,255,255],fontSize:7,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:[240,248,255]},columnStyles:{0:{cellWidth:15},1:{cellWidth:20},2:{cellWidth:25},3:{cellWidth:40},4:{cellWidth:40}},margin:{top:10,right:10,bottom:10,left:5},didDrawPage:function(r){e.setFontSize(7),e.setTextColor(100);const t=new Date,D=t.toLocaleDateString("es-HN",{year:"numeric",month:"long",day:"numeric"}),ge=t.toLocaleTimeString("es-HN",{hour:"2-digit",minute:"2-digit",second:"2-digit"});e.text(`Fecha y hora de generación: ${D}, ${ge}`,10,l-10),e.text(`Página ${r.pageNumber}`,o-10,l-10,{align:"right"})}}),e.save("Reporte_nacionalidades.pdf")}};return J?a.jsxs(be,{children:[a.jsxs(O,{className:"align-items-center mb-5",children:[a.jsx(k,{xs:"8",md:"9",children:a.jsx("h1",{className:"mb-0",children:"Mantenimiento de Nacionalidades"})}),a.jsxs(k,{xs:"4",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[Q&&a.jsxs(i,{style:{backgroundColor:"#4B6251",color:"white"},className:"mb-3 mb-md-0 me-md-3",onClick:()=>j(!0),children:[a.jsx(g,{icon:Te})," Nuevo"]}),a.jsxs(ve,{children:[a.jsx(we,{style:{backgroundColor:"#6C8E58",color:"white"},children:"Reportes"}),a.jsxs(Se,{children:[a.jsx(V,{onClick:xe,children:"Descargar en Excel"}),a.jsx(V,{onClick:Ce,children:"Descargar en PDF"})]})]})]})]}),a.jsxs(O,{className:"align-items-center mt-4 mb-2",children:[a.jsx(k,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:a.jsxs(G,{className:"me-3",style:{width:"400px"},children:[a.jsx(Pe,{children:a.jsx(g,{icon:ke})}),a.jsx(d,{placeholder:"Buscar nacionalidad...",onChange:pe,value:T}),a.jsxs(i,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{B(""),v(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[a.jsx(g,{icon:Ie})," Limpiar"]})]})}),a.jsx(k,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:a.jsx(G,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:a.jsxs("div",{className:"d-inline-flex align-items-center",children:[a.jsx("span",{children:"Mostrar "}),a.jsxs(_e,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const o=Number(e.target.value);ne(o),v(1)},value:x,children:[a.jsx("option",{value:"5",children:"5"}),a.jsx("option",{value:"10",children:"10"}),a.jsx("option",{value:"20",children:"20"})]}),a.jsx("span",{children:" registros"})]})})})]}),a.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #ccc",padding:"10px",marginBottom:"30px"},children:a.jsxs(De,{striped:!0,children:[a.jsx(Ee,{children:a.jsxs($,{children:[a.jsx(u,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:" #"}),a.jsx(u,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:"Codigo Nacionalidad"}),a.jsx(u,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:"Nacionalidad"}),a.jsx(u,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:"Pais"}),a.jsx(u,{className:"text-center",children:"Acciones"})]})}),a.jsx(Re,{children:me.map(e=>a.jsxs($,{children:[a.jsx(f,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:e.originalIndex}),a.jsx(f,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:e.Id_nacionalidad.toUpperCase()}),a.jsx(f,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:e.pais_nacionalidad.toUpperCase()}),a.jsx(f,{style:{borderRight:"1px solid #ddd"},className:"text-center",children:e.pais.toUpperCase()}),a.jsx(f,{className:"text-center",children:a.jsxs("div",{className:"d-flex justify-content-center",children:[Y&&a.jsx(i,{color:"warning",onClick:()=>de(e),style:{marginRight:"10px"},children:a.jsx(g,{icon:Ue})}),K&&a.jsx(i,{color:"danger",onClick:()=>ce(e),children:a.jsx(g,{icon:Le})})]})})]},e.Id_nacionalidad))})]})}),a.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[a.jsxs(Me,{"aria-label":"Page navigation",children:[a.jsx(i,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:m===1,onClick:()=>H(m-1),children:"Anterior"}),a.jsx(i,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:m===Math.ceil(P.length/x),onClick:()=>H(m+1),children:"Siguiente"})]}),a.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",m," de ",Math.ceil(P.length/x)]})]}),a.jsxs(R,{visible:ee,onClose:()=>S(j,resetNuevaNacionalidad),backdrop:"static",children:[a.jsx(U,{children:a.jsx(F,{children:"Ingresar Nueva Nacionalidad"})}),a.jsx(L,{children:a.jsxs(q,{children:[a.jsx(d,{label:"Código Nacionalidad",value:C.Cod_nacionalidad,maxLength:50,onPaste:s,onCopy:s,onChange:e=>handleCodNacionalidadInputChange(e,b,c,setNacionalidadError),onBlur:isDuplicateNacionalidad,style:{textTransform:"uppercase"}}),a.jsx(d,{label:"ID Nacionalidad",value:C.Id_nacionalidad,maxLength:50,onPaste:s,onCopy:s,onChange:e=>handleIdNacionalidadInputChange(e,b,c),style:{textTransform:"uppercase"}}),a.jsx(d,{label:"País Nacionalidad",value:C.pais_nacionalidad,maxLength:50,onPaste:s,onCopy:s,onChange:e=>handlePaisNacionalidadInputChange(e,b,c),style:{textTransform:"uppercase"}}),a.jsx(d,{label:"País",value:C.pais,maxLength:50,onPaste:s,onCopy:s,onChange:e=>handlePaisInputChange(e,b,c),style:{textTransform:"uppercase"}}),nacionalidadError&&a.jsx("p",{style:{color:"red",fontSize:"0.9em"},children:nacionalidadError})]})}),a.jsxs(M,{children:[a.jsx(i,{color:"secondary",onClick:()=>S(j,resetNuevaNacionalidad),children:"Cerrar"}),a.jsx(i,{color:"primary",onClick:ie,disabled:!!nacionalidadError,children:"Guardar"})]})]}),a.jsxs(R,{visible:ae,onClose:()=>S(y,resetNacionalidadToUpdate),backdrop:"static",children:[a.jsx(U,{children:a.jsx(F,{children:"Actualizar Nacionalidad"})}),a.jsxs(q,{children:[a.jsxs(L,{children:[a.jsx(d,{label:"Código Nacionalidad",value:h.Cod_nacionalidad,readOnly:!0}),a.jsx(d,{label:"ID Nacionalidad",value:h.Id_nacionalidad,onPaste:s,onCopy:s,onChange:e=>handleIdNacionalidadInputChange(e,_,c),style:{textTransform:"uppercase"}}),a.jsx(d,{label:"País Nacionalidad",value:h.pais_nacionalidad,onPaste:s,onCopy:s,onChange:e=>handlePaisNacionalidadInputChange(e,_,c),style:{textTransform:"uppercase"}}),a.jsx(d,{label:"País",value:h.pais,onPaste:s,onCopy:s,onChange:e=>handlePaisInputChange(e,_,c),style:{textTransform:"uppercase"}}),I.nacionalidad&&a.jsx("p",{style:{color:"red"},children:I.nacionalidad})]}),a.jsxs(M,{children:[a.jsx(i,{color:"secondary",onClick:()=>S(y,resetNacionalidadToUpdate),children:"Cerrar"}),a.jsx(i,{color:"primary",onClick:re,disabled:I.nacionalidad,children:"Guardar"})]})]})]}),a.jsxs(R,{visible:oe,onClose:()=>N(!1),backdrop:"static",children:[a.jsx(U,{children:a.jsx(F,{children:"Eliminar Nacionalidad"})}),a.jsxs(L,{children:['¿Estás seguro de que deseas eliminar la nacionalidad "',A.pais_nacionalidad,'"?']}),a.jsxs(M,{children:[a.jsx(i,{color:"secondary",onClick:()=>N(!1),children:"Cancelar"}),a.jsx(i,{color:"danger",onClick:le,children:"Eliminar"})]})]})]}):a.jsx(Ne,{})};export{ga as default};
