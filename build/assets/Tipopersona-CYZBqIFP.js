import{r as s,j as o}from"./index-SVRFFNc9.js";import{C as c}from"./index.esm-DWwMdKxH.js";import{S as a}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as oe}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as j,w as te}from"./xlsx-lwdk4T0U.js";import{l as re}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as se}from"./usePermission-BCWksQX7.js";import{C as ae}from"./CContainer-BdNP0s3v.js";import{C as N,a as C}from"./CRow-Bf67u6lu.js";import{a as n}from"./CButton-D9GPTbB6.js";import{c as ie}from"./cil-plus-D8mtC-W5.js";import{C as ne,a as le,b as ce,c as z}from"./CDropdownToggle-DlfIUTmX.js";import{c as de}from"./cil-file-CeQgYs_D.js";import{C as v}from"./CInputGroup-D-McUFva.js";import{C as F}from"./CInputGroupText-Cfu0fzaY.js";import{c as pe}from"./cil-search-CDkY_4k-.js";import{C as M}from"./CFormInput-B_gylY64.js";import{c as me}from"./cil-brush-alt-CV61lKqC.js";import{C as he}from"./CFormSelect-CzT7g5tb.js";import{C as xe,a as ue,b as D,c as T,d as Ce,e as w}from"./CTable-98qqrSRH.js";import{c as fe}from"./cil-pen-53d2I-C-.js";import{c as ge}from"./cil-trash-CBbKHhHb.js";import{C as je}from"./CPagination-UopCEeNZ.js";import{C as Te,a as we,b as Se,c as be}from"./CModalHeader-Bhtr3bZe.js";import{C as ye}from"./CModalTitle-M2mBvD_5.js";import{C as Ee}from"./CForm-CYRkMwLo.js";import{c as Pe}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const no=()=>{se("tipopersona");const[m,_]=s.useState([]),[Be,I]=s.useState(!0),[ke,A]=s.useState(""),[R,S]=s.useState(""),[b,y]=s.useState([]),[d,h]=s.useState(0),[x,L]=s.useState(5),[O,p]=s.useState(!1),[f,E]=s.useState(!1),[l,g]=s.useState({Tipo:""});s.useEffect(()=>{u()},[]);const u=async()=>{try{const e=await fetch("http://74.50.68.87:4000/api/tipopersona/tipo-persona"),t=await e.json();if(e.ok)_(t),y(t);else throw new Error(t.message||"Error al obtener los tipos de persona")}catch(e){A(e.message),a.fire({title:"Error",text:e.message,icon:"error",confirmButtonColor:"#4B6251"})}finally{I(!1)}},G=e=>{const r=e.replace(/[^A-Za-z\s]/g,"").toUpperCase().slice(0,30);return/(.)\1{2,}/.test(r)?l.Tipo:r},U=e=>{const t=G(e.target.value);g({...l,Tipo:t})},V=async e=>{try{const t=await fetch("http://74.50.68.87:4000/api/tipopersona/tipo-persona",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tipo:e})});if(t.ok)a.fire({title:"Éxito",text:"Tipo de persona creado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),u();else{const r=await t.json();throw new Error(r.Mensaje||"Error al crear el tipo de persona")}}catch(t){a.fire({title:"Error",text:t.message,icon:"error",confirmButtonColor:"#4B6251"})}},Y=async(e,t)=>{try{const r=await fetch(`http://74.50.68.87:4000/api/tipopersona/tipo-persona/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tipo:t})});if(r.ok)a.fire({title:"Éxito",text:"Tipo de persona actualizado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),u();else{const i=await r.json();throw new Error(i.Mensaje||"Error al actualizar el tipo de persona")}}catch(r){a.fire({title:"Error",text:r.message,icon:"error",confirmButtonColor:"#4B6251"})}},H=async e=>{try{const t=await fetch(`http://74.50.68.87:4000/api/tipopersona/tipo-persona/${e}`,{method:"DELETE"});if(t.ok)a.fire({title:"Éxito",text:"Tipo de persona eliminado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),u();else{const r=await t.json();throw new Error(r.Mensaje||"Error al eliminar el tipo de persona")}}catch(t){a.fire({title:"Error",text:t.message,icon:"error",confirmButtonColor:"#4B6251"})}},$=()=>{E(!1),g({Tipo:""}),p(!0)},J=e=>{E(!0),g(e),p(!0)},q=async e=>{if(e.preventDefault(),!l.Tipo){a.fire({title:"Error",text:"El nombre del tipo no puede estar vacío ni contener caracteres especiales o tres letras iguales seguidas.",icon:"error",confirmButtonColor:"#4B6251"});return}f?await Y(l.Cod_tipo_persona,l.Tipo):await V(l.Tipo),p(!1)},K=e=>{a.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#4B6251",cancelButtonColor:"#6c757d",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&H(e)})},W=e=>{const t=e.target.value.toLowerCase();S(t);const r=m.filter(i=>i.Tipo.toLowerCase().includes(t));y(r),h(0)},Z=()=>{const e=new oe;if(m.length===0){console.warn("No hay datos de tipos de persona para exportar.");return}const t=new Image;t.src=re,t.onload=()=>{e.addImage(t,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14),e.text("Reporte de Tipos de Persona",e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55),e.setFontSize(12),e.setTextColor(0),e.text("Tipos de Persona:",10,65),e.autoTable({startY:70,head:[["#","Tipo de Persona"]],body:m.map((i,ee)=>[ee+1,i.Tipo.toUpperCase()]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]}}),e.setFontSize(10),e.setTextColor(100);const r=new Date().toLocaleDateString();e.text(`Fecha de generación: ${r}`,10,e.internal.pageSize.height-10),e.save("Reporte_Tipos_Persona.pdf")},t.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo.")}},Q=()=>{const e=j.json_to_sheet(m.map((r,i)=>({"#":i+1,"Tipo de Persona":r.Tipo.toUpperCase()}))),t=j.book_new();j.book_append_sheet(t,e,"Tipos de Persona"),te(t,"Reporte_Tipos_Persona.xlsx")},P=(d+1)*x,B=P-x,X=b.slice(B,P),k=Math.ceil(b.length/x);return o.jsxs(ae,{children:[o.jsxs(N,{className:"justify-content-between align-items-center mb-4",children:[o.jsx(C,{xs:12,md:8,children:o.jsx("h3",{children:"Mantenimientos Tipos de Persona"})}),o.jsxs(C,{xs:12,md:4,className:"text-end",children:[o.jsxs(n,{style:{backgroundColor:"#4B6251",color:"white",width:"auto",height:"38px"},onClick:$,children:[o.jsx(c,{icon:ie})," Nuevo"]}),o.jsxs(ne,{className:"d-inline ms-2",children:[o.jsxs(le,{style:{backgroundColor:"#6C8E58",color:"white",width:"auto",height:"38px"},children:[o.jsx(c,{icon:de})," Reporte"]}),o.jsxs(ce,{children:[o.jsx(z,{onClick:Z,children:"Exportar a PDF"}),o.jsx(z,{onClick:Q,children:"Exportar a Excel"})]})]})]})]}),o.jsxs(N,{className:"align-items-center mb-3",children:[o.jsx(C,{md:6,children:o.jsxs(v,{size:"sm",children:[o.jsx(F,{children:o.jsx(c,{icon:pe})}),o.jsx(M,{placeholder:"Buscar tipo de persona",value:R,onChange:W,style:{fontSize:"0.9rem"}}),o.jsxs(n,{style:{border:"1px solid #ccc",backgroundColor:"#F3F4F7",color:"#343a40",fontSize:"0.9rem"},onClick:()=>S(""),children:[o.jsx(c,{icon:me})," Limpiar"]})]})}),o.jsx(C,{md:6,className:"text-end",children:o.jsxs("div",{className:"d-flex align-items-center justify-content-end",children:[o.jsx("span",{className:"me-2",children:"Mostrar "}),o.jsxs(he,{size:"sm",style:{width:"80px"},value:x,onChange:e=>{L(Number(e.target.value)),h(0)},children:[o.jsx("option",{value:"5",children:"5"}),o.jsx("option",{value:"10",children:"10"}),o.jsx("option",{value:"20",children:"20"})]}),o.jsx("span",{children:" registros"})]})})]}),o.jsxs(xe,{striped:!0,bordered:!0,hover:!0,children:[o.jsx(ue,{children:o.jsxs(D,{children:[o.jsx(T,{children:"#"}),o.jsx(T,{children:"TIPO DE PERSONA"}),o.jsx(T,{children:"Acciones"})]})}),o.jsx(Ce,{children:X.map((e,t)=>o.jsxs(D,{children:[o.jsx(w,{children:B+t+1}),o.jsx(w,{children:e.Tipo.toUpperCase()}),o.jsxs(w,{children:[o.jsx(n,{color:"warning",size:"sm",onClick:()=>J(e),children:o.jsx(c,{icon:fe})})," ",o.jsx(n,{color:"danger",size:"sm",onClick:()=>K(e.Cod_tipo_persona),children:o.jsx(c,{icon:ge})})]})]},e.Cod_tipo_persona))})]}),o.jsxs("nav",{className:"d-flex justify-content-center align-items-center mt-4",children:[o.jsxs(je,{className:"mb-0",style:{gap:"0.3cm"},children:[o.jsx(n,{style:{backgroundColor:"gray",color:"white",marginRight:"0.3cm"},disabled:d===0,onClick:()=>h(d-1),children:"Anterior"}),o.jsx(n,{style:{backgroundColor:"gray",color:"white"},disabled:d===k-1,onClick:()=>h(d+1),children:"Siguiente"})]}),o.jsxs("span",{className:"mx-2",children:["Página ",d+1," de ",k]})]}),o.jsxs(Te,{visible:O,onClose:()=>p(!1),backdrop:"static",children:[o.jsx(we,{closeButton:!0,children:o.jsx(ye,{children:f?"Editar Tipo de Persona":"Agregar Tipo de Persona"})}),o.jsx(Se,{children:o.jsxs(Ee,{onSubmit:q,children:[o.jsxs(v,{className:"mb-3",children:[o.jsx(F,{children:"Nombre del Tipo"}),o.jsx(M,{type:"text",placeholder:"Nombre del tipo",value:l.Tipo||"",onChange:U,required:!0})]}),o.jsxs(be,{children:[o.jsx(n,{style:{backgroundColor:"#6c757d",color:"white",borderColor:"#6c757d"},onClick:()=>p(!1),children:"Cancelar"}),o.jsxs(n,{style:{backgroundColor:"#4B6251",color:"white",borderColor:"#4B6251"},type:"submit",children:[o.jsx(c,{icon:Pe})," ","Guardar"]})]})]})})]})]})};export{no as default};
