import{r as a,j as t}from"./index-SVRFFNc9.js";import{C as l}from"./index.esm-DWwMdKxH.js";import{S as s}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as re}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as ae}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as b,w as se}from"./xlsx-lwdk4T0U.js";import{C as ie}from"./CContainer-BdNP0s3v.js";import{C as z,a as C}from"./CRow-Bf67u6lu.js";import{a as n}from"./CButton-D9GPTbB6.js";import{c as ne}from"./cil-plus-D8mtC-W5.js";import{C as le,a as ce,b as de,c as P}from"./CDropdownToggle-DlfIUTmX.js";import{c as me}from"./cil-file-CeQgYs_D.js";import{C as F}from"./CInputGroup-D-McUFva.js";import{C as _}from"./CInputGroupText-Cfu0fzaY.js";import{c as ue}from"./cil-search-CDkY_4k-.js";import{C as D}from"./CFormInput-B_gylY64.js";import{c as pe}from"./cil-brush-alt-CV61lKqC.js";import{C as he}from"./CFormSelect-CzT7g5tb.js";import{C as xe,a as Ce,b as I,c as w,d as fe,e as S}from"./CTable-98qqrSRH.js";import{c as ge}from"./cil-pen-53d2I-C-.js";import{c as je}from"./cil-trash-CBbKHhHb.js";import{C as Ee}from"./CPagination-UopCEeNZ.js";import{C as be,a as we,b as Se,c as ye}from"./CModalHeader-Bhtr3bZe.js";import{C as Te}from"./CModalTitle-M2mBvD_5.js";import{C as Be}from"./CForm-CYRkMwLo.js";import{c as ke}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const nt=()=>{const[f,A]=a.useState([]),[ve,R]=a.useState(!0),[Me,L]=a.useState(""),[O,y]=a.useState(""),[T,B]=a.useState([]),[c,p]=a.useState(0),[h,G]=a.useState(5),[$,u]=a.useState(!1),[g,k]=a.useState(!1),[d,j]=a.useState({codEstado:"",tipo:""});a.useEffect(()=>{x()},[]);const x=async()=>{try{const e=await fetch("http://74.50.68.87:4000/api/estadomatricula/estado-matricula"),o=await e.json();if(e.ok)A(o),B(o);else throw new Error(o.message||"Error al obtener los estados")}catch(e){L(e.message),s.fire({title:"Error",text:e.message,icon:"error",confirmButtonColor:"#4B6251"})}finally{R(!1)}},H=e=>{const o=e.toUpperCase().slice(0,30),r=/(.)\1{2,}/,i=/[^A-Z\s]/;return r.test(o)||i.test(o)?!1:o},U=e=>{const o=H(e.target.value);o!==!1&&j({...d,tipo:o})},V=async e=>{try{const o=await fetch("http://74.50.68.87:4000/api/estadomatricula/estado-matricula",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({p_tipo:e})});if(o.ok)s.fire({title:"Éxito",text:"Estado de matrícula creado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x();else{const r=await o.json();throw new Error(r.Mensaje||"Error al crear el estado")}}catch(o){s.fire({title:"Error",text:o.message,icon:"error",confirmButtonColor:"#4B6251"})}},Y=async e=>{try{const o=await fetch(`http://74.50.68.87:4000/api/estadomatricula/estado-matricula/${e}`,{method:"DELETE"});if(o.ok)s.fire({title:"Éxito",text:"Estado de matrícula eliminado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x();else{const r=await o.json();throw new Error(r.Mensaje||"Error al eliminar el estado")}}catch(o){s.fire({title:"Error",text:o.message,icon:"error",confirmButtonColor:"#4B6251"})}},J=async(e,o)=>{try{const r=await fetch(`http://74.50.68.87:4000/api/estadomatricula/estado-matricula/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({p_cod_estado_matricula:e,p_tipo:o})}),i=await r.json();r.ok?(s.fire({title:"Éxito",text:"Estado de matrícula actualizado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x()):s.fire({title:"Error",text:i.Mensaje||"Error al actualizar el estado",icon:"error",confirmButtonColor:"#4B6251"})}catch(r){s.fire({title:"Error",text:r.message,icon:"error",confirmButtonColor:"#4B6251"})}},q=e=>{j({codEstado:e.Cod_estado_matricula,tipo:e.Tipo}),k(!0),u(!0)},K=()=>{j({codEstado:"",tipo:""}),k(!1),u(!0)},W=e=>{const o=e.target.value.toLowerCase();y(o);const r=f.filter(i=>i.Tipo.toLowerCase().includes(o));B(r),p(0)},Z=e=>{if(e.preventDefault(),!d.tipo){s.fire({title:"Error",text:"El nombre del estado no puede estar vacío ni contener caracteres especiales o tres letras iguales seguidas.",icon:"error",confirmButtonColor:"#4B6251"});return}g?J(d.codEstado,d.tipo):V(d.tipo),u(!1)},Q=e=>{s.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#4B6251",cancelButtonColor:"#6c757d",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&Y(e)})},X=()=>{const e=new re("landscape"),o=new Image;o.src=ae,o.onload=()=>{e.addImage(o,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14),e.text("Reporte de Estados de Matrícula",e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55),e.setFontSize(12),e.setTextColor(0,51,102),e.text("Detalles de los Estados de Matrícula",e.internal.pageSize.width/2,65,{align:"center"}),e.autoTable({startY:75,head:[["#","Tipo de Estado"]],body:f.map((m,E)=>[E+1,m.Tipo||"Sin definir"]),styles:{fontSize:10,textColor:[34,34,34],cellPadding:4,valign:"middle",overflow:"linebreak"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:10,right:10}});const r=e.internal.getNumberOfPages();for(let m=1;m<=r;m++){e.setPage(m);const E=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y Hora de Generación: ${E}`,10,e.internal.pageSize.height-10),e.text(`Página ${m} de ${r}`,e.internal.pageSize.width-30,e.internal.pageSize.height-10,{align:"right"})}const i=e.output("blob"),oe=URL.createObjectURL(i);window.open(oe)},o.onerror=()=>{Swal.fire("Error","No se pudo cargar el logo.","error")}},ee=()=>{const e=b.json_to_sheet(f.map((r,i)=>({"#":i+1,"Tipo de Estado":r.Tipo}))),o=b.book_new();b.book_append_sheet(o,e,"Estados de Matrícula"),se(o,"Reporte_Estados_Matricula.xlsx")},v=(c+1)*h,M=v-h,te=T.slice(M,v),N=Math.ceil(T.length/h);return t.jsxs(ie,{children:[t.jsxs(z,{className:"justify-content-between align-items-center mb-4",children:[t.jsx(C,{xs:12,md:8,children:t.jsx("h3",{children:"Mantenimiento Estado de Matrícula"})}),t.jsxs(C,{xs:12,md:4,className:"text-end",children:[t.jsxs(n,{style:{backgroundColor:"#0F463A",color:"white",borderColor:"#4B6251"},onClick:K,className:"me-2",children:[t.jsx(l,{icon:ne})," Nuevo"]}),t.jsxs(le,{className:"d-inline ms-2",children:[t.jsxs(ce,{style:{backgroundColor:"#6C8E58",color:"white",borderColor:"#617341",width:"auto",height:"38px"},children:[t.jsx(l,{icon:me})," Reporte"]}),t.jsxs(de,{children:[t.jsx(P,{onClick:X,children:"Exportar a PDF"}),t.jsx(P,{onClick:ee,children:"Exportar a Excel"})]})]})]})]}),t.jsxs(z,{className:"align-items-center my-3 justify-content-between",children:[t.jsx(C,{md:6,children:t.jsxs(F,{children:[t.jsx(_,{children:t.jsx(l,{icon:ue})}),t.jsx(D,{placeholder:"Buscar estado",value:O,onChange:W}),t.jsxs(n,{style:{border:"1px solid #ccc",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>y(""),children:[t.jsx(l,{icon:pe})," Limpiar"]})]})}),t.jsx(C,{md:3,className:"text-end",children:t.jsxs("div",{className:"d-flex justify-content-end",children:[t.jsx("span",{className:"me-2",children:"Mostrar "}),t.jsxs(he,{style:{width:"80px"},value:h,onChange:e=>{G(Number(e.target.value)),p(0)},children:[t.jsx("option",{value:"5",children:"5"}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"20",children:"20"})]}),t.jsx("span",{children:" registros"})]})})]}),t.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",borderRadius:"8px",display:"block"},children:t.jsxs(xe,{striped:!0,bordered:!0,hover:!0,children:[t.jsx(Ce,{children:t.jsxs(I,{children:[t.jsx(w,{children:"#"}),t.jsx(w,{children:"Tipo de Estado"}),t.jsx(w,{children:"Acciones"})]})}),t.jsx(fe,{children:te.map((e,o)=>t.jsxs(I,{children:[t.jsx(S,{children:o+1+M}),t.jsx(S,{style:{textTransform:"uppercase"},children:e.Tipo}),t.jsxs(S,{children:[t.jsx(n,{color:"warning",size:"sm",onClick:()=>q(e),children:t.jsx(l,{icon:ge})})," ",t.jsx(n,{color:"danger",size:"sm",onClick:()=>Q(e.Cod_estado_matricula),children:t.jsx(l,{icon:je})})]})]},e.Cod_estado_matricula))})]})}),t.jsxs("nav",{className:"d-flex justify-content-center align-items-center mt-4",children:[t.jsxs(Ee,{className:"mb-0",style:{gap:"0.3cm"},children:[t.jsx(n,{style:{backgroundColor:"gray",color:"white",marginRight:"0.3cm"},disabled:c===0,onClick:()=>p(c-1),children:"Anterior"}),t.jsx(n,{style:{backgroundColor:"gray",color:"white"},disabled:c===N-1,onClick:()=>p(c+1),children:"Siguiente"})]}),t.jsxs("span",{className:"mx-2",children:["Página ",c+1," de ",N]})]}),t.jsxs(be,{visible:$,onClose:()=>u(!1),backdrop:"static",children:[t.jsx(we,{closeButton:!0,children:t.jsx(Te,{children:g?"Editar Estado de Matrícula":"Agregar Estado de Matrícula"})}),t.jsx(Se,{children:t.jsxs(Be,{onSubmit:Z,children:[t.jsxs(F,{className:"mb-3",children:[t.jsx(_,{children:"Nombre del Estado"}),t.jsx(D,{type:"text",placeholder:"Nombre del estado",value:d.tipo,onChange:U,required:!0})]}),t.jsxs(ye,{children:[t.jsx(n,{style:{backgroundColor:"#6c757d",color:"white",borderColor:"#6c757d"},onClick:()=>u(!1),children:"Cancelar"}),t.jsxs(n,{style:{backgroundColor:"#4B6251",color:"white",borderColor:"#4B6251"},type:"submit",children:[t.jsx(l,{icon:ke})," ","Guardar"]})]})]})})]})]})};export{nt as default};
