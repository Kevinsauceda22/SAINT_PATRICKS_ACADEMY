import{r as n,A as we,o as ye,j as e,C as Fe}from"./index-SVRFFNc9.js";import{S as m}from"./sweetalert2.esm.all-D3pEHXw3.js";import{C as x}from"./index.esm-DWwMdKxH.js";import{F as Ee,i as Ie,a as Ne,b as ke,l as Te}from"./es-CNjOA_h5.js";import{E as W}from"./jspdf.plugin.autotable-gke1D7B3.js";import{u as z,w as Pe}from"./xlsx-lwdk4T0U.js";import{l as Y}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as ve}from"./usePermission-BCWksQX7.js";import Ae from"./AccessDenied-yaDW3Jao.js";import{C as Be}from"./CContainer-BdNP0s3v.js";import{C as g,a as d}from"./CRow-Bf67u6lu.js";import{C as Re}from"./CInputGroup-D-McUFva.js";import{C as De}from"./CInputGroupText-Cfu0fzaY.js";import{c as ze}from"./cil-search-CDkY_4k-.js";import{C as f}from"./CFormInput-B_gylY64.js";import{a as j}from"./CButton-D9GPTbB6.js";import{c as qe}from"./cil-plus-D8mtC-W5.js";import{C as He,a as _e,b as Oe,c as Z}from"./CDropdownToggle-DlfIUTmX.js";import{c as J}from"./cil-file-CeQgYs_D.js";import{C as Le}from"./CAlert-B4fM1kpi.js";import{C as q,a as H,b as _,c as Ue}from"./CModalHeader-Bhtr3bZe.js";import{C as O}from"./CModalTitle-M2mBvD_5.js";import{C as K,a as Me}from"./CCardBody-BwCgYaTs.js";import{C as $e}from"./CCardHeader-C_B6DycW.js";import{C as Ge}from"./CBadge-DJ5RQlFd.js";import{c as Ve}from"./cil-pen-53d2I-C-.js";import{C as We}from"./CForm-CYRkMwLo.js";import{C as b}from"./CFormLabel-szm2Dda9.js";import{c as Ye}from"./cil-save-CHBg7z_U.js";import{C as Ze,a as Je,b as X,c as S,d as Ke,e as w}from"./CTable-98qqrSRH.js";import{c as Q}from"./cil-warning-C7g3f07Q.js";import{c as ee}from"./cil-check-circle-BlU9eaow.js";import{c as Xe}from"./cil-x-circle-Bi9E-sdv.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CBackdrop-BbuVwMMD.js";const _o=()=>{const{canSelect:oe,canDelete:Qe,canInsert:re,canUpdate:eo}=ve("Solicitudes_Padre"),{auth:te}=n.useContext(we),[u,ae]=n.useState([]),[ie,L]=n.useState(!0),[U,M]=n.useState(""),[se,N]=n.useState(!1),[a,$]=n.useState(null),[ne,E]=n.useState(!1),[le,ce]=n.useState(!1),[de,G]=n.useState(""),[k,T]=n.useState([]),[l,y]=n.useState({title:"",description:"",personaRequerida:"",fecha:"",horaInicio:"",horaFin:"",cod_persona:""}),[P,V]=n.useState(!1);ye(),n.useEffect(()=>{v();const o=setInterval(v,15e3);return()=>clearInterval(o)},[]);const v=async()=>{L(!0),M("");try{const o=localStorage.getItem("token");if(!o)throw new Error("Usuario no autenticado. Por favor, inicia sesión.");const r=await fetch("http://localhost:4000/api/solicitud/solicitudes",{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!r.ok)throw new Error("Error al obtener las solicitudes.");const i=(await r.json()).map(s=>({id:s.Cod_solicitud||"",title:s.Nombre_solicitud||"SIN TÍTULO",start:s.Fecha_solicitud||"",description:s.Asunto||"SIN ASUNTO",personaRequerida:s.Persona_requerida||"DESCONOCIDO",horaInicio:s.Hora_Inicio||"00:00",horaFin:s.Hora_Fin||null,estado:s.Estado||"Pendiente",Cod_persona:s.Cod_persona||""}));ae(i),T(i)}catch(o){console.error("Error al obtener las solicitudes:",o.message),M(o.message),m.fire({icon:"error",title:"Error",text:o.message,timer:2e3,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1})}finally{L(!1)}},he=o=>{switch(o){case"Pendiente":return"rgba(255, 204, 102, 0.8)";case"Finalizada":return"rgba(102, 187, 106, 0.8)";case"Cancelada":return"rgba(239, 83, 80, 0.8)";case"Activo":return"rgba(41, 121, 255, 0.9)";default:return"rgba(158, 158, 158, 0.8)"}},ue=o=>{switch(o){case"Pendiente":return Q;case"Finalizada":return ee;case"Cancelada":return Xe;case"Activo":return ee;default:return Q}},pe=async o=>{if(!o){console.warn("No hay cita seleccionada para exportar.");return}const r=new W("landscape"),t=new Image;t.src=Y,t.onload=()=>{r.addImage(t,"PNG",10,10,30,30),r.setFontSize(18),r.setTextColor(0,102,51),r.text("SAINT PATRICK'S ACADEMY",r.internal.pageSize.width/2,20,{align:"center"}),r.setFontSize(14),r.text("Detalles de la Cita",r.internal.pageSize.width/2,30,{align:"center"}),r.setFontSize(10),r.setTextColor(100),r.text("Casa Club del periodista, Colonia del Periodista",r.internal.pageSize.width/2,40,{align:"center"}),r.text("Teléfono: (504) 2234-8871",r.internal.pageSize.width/2,45,{align:"center"}),r.text("Correo: info@saintpatrickacademy.edu",r.internal.pageSize.width/2,50,{align:"center"}),r.setLineWidth(.5),r.setDrawColor(0,102,51),r.line(10,55,r.internal.pageSize.width-10,55),r.autoTable({startY:60,head:[["Campo","Valor"]],body:[["Título",o.title||"Título no disponible"],["Asunto",o.description||"Sin descripción"],["Persona Requerida",o.personaRequerida||"No especificada"],["Fecha",o.start||"Fecha no disponible"],["Hora Inicio",o.horaInicio||"Hora no disponible"],["Hora Fin",o.horaFin||"Hora no disponible"],["Estado",o.estado||"Estado no disponible"]],headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]}});const i=new Date,s=i.toLocaleDateString(),h=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});r.setFontSize(10),r.setTextColor(100),r.text(`Fecha y hora de generación: ${s} ${h}`,10,r.internal.pageSize.height-10);const p=r.output("blob"),c=URL.createObjectURL(p);window.open(c,"_blank")},t.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo.")}},A=o=>{const{name:r,value:t}=o.target;y(i=>({...i,[r]:t}))},Ce=o=>{const r=o.target.value.toLowerCase();G(r);const t=u.filter(i=>i.title.toLowerCase().includes(r)||i.start.includes(r));T(t)},me=()=>{G(""),T(u)},xe=o=>{const r=u.find(t=>t.id===parseInt(o.event.id,10));r&&($(r),N(!0))},ge=()=>{y({title:"",description:"",personaRequerida:"",fecha:"",horaInicio:"",horaFin:"",Cod_persona:""}),$(null),E(!0)},fe=()=>{if(a.estado==="Finalizada"){m.fire({icon:"warning",title:"Advertencia",text:"No puedes editar esta cita si ya está finalizada.",confirmButtonColor:"#6C8E58",timer:2e3,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1});return}y({title:a.title,description:a.description,personaRequerida:a.personaRequerida,fecha:a.start,horaInicio:a.horaInicio,horaFin:a.horaFin,estado:a.estado}),N(!1),E(!0)},je=async o=>{o.preventDefault();const{title:r,description:t,personaRequerida:i,fecha:s,horaInicio:h,horaFin:p,estado:c}=l;if(!r||!t||!i||!s||!h){m.fire({icon:"warning",title:"Advertencia",text:"Todos los campos son obligatorios, excepto Hora_Fin.",confirmButtonColor:"#6C8E58"});return}if(p){const[C,R]=h.split(":").map(Number),[F,D]=p.split(":").map(Number);if(F<C||F===C&&D<=R){m.fire({icon:"warning",title:"Advertencia",text:"La hora de fin debe ser mayor que la hora de inicio.",confirmButtonColor:"#6C8E58",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1});return}}V(!0);try{const C=localStorage.getItem("token");if(!C)throw new Error("Usuario no autenticado. Por favor, inicia sesión.");const R={Cod_persona:te.cod_persona,Nombre_solicitud:r||"SIN TÍTULO",Fecha_solicitud:s,Hora_Inicio:h,Hora_Fin:p||null,Asunto:t||"SIN ASUNTO",Persona_requerida:i||"DESCONOCIDO",estado:c},F=await fetch(a?`http://localhost:4000/api/solicitud/solicitudes/${a.id}`:"http://localhost:4000/api/solicitud/solicitudes",{method:a?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify(R)});if(!F.ok){const D=await F.json();throw new Error(D.message||"Error al procesar la solicitud.")}m.fire({icon:"success",title:a?"Actualizado":"Creado",text:a?"La cita fue actualizada correctamente.":"La cita fue creada correctamente.",confirmButtonColor:"#4B6251",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1}),E(!1),await v()}catch(C){m.fire({icon:"error",title:"Error",text:C.message,confirmButtonColor:"#6C8E58"})}finally{V(!1)}},I=()=>{P||(E(!1),ce(!1))},be=()=>{const o=new W("landscape");if(u.length===0){console.warn("No hay datos de citas para exportar.");return}const r=new Image;r.src=Y,r.onload=()=>{o.addImage(r,"PNG",10,10,30,30),o.setFontSize(18),o.setTextColor(0,102,51),o.text("SAINT PATRICK'S ACADEMY",o.internal.pageSize.width/2,20,{align:"center"}),o.setFontSize(14),o.text("Reporte Detallado de Citas",o.internal.pageSize.width/2,30,{align:"center"}),o.setFontSize(10),o.setTextColor(100),o.text("Casa Club del periodista, Colonia del Periodista",o.internal.pageSize.width/2,40,{align:"center"}),o.text("Teléfono: (504) 2234-8871",o.internal.pageSize.width/2,45,{align:"center"}),o.text("Correo: info@saintpatrickacademy.edu",o.internal.pageSize.width/2,50,{align:"center"}),o.setLineWidth(.5),o.setDrawColor(0,102,51),o.line(10,55,o.internal.pageSize.width-10,55),o.autoTable({startY:60,head:[["Título","Asunto","Persona Requerida","Fecha","Hora Inicio","Hora Fin","Estado"]],body:u.map(c=>[c.title||"Título no disponible",c.description||"Sin descripción",c.personaRequerida||"No especificada",c.start||"Fecha no disponible",c.horaInicio||"Hora no disponible",c.horaFin||"Hora no disponible",c.estado||"Estado no disponible"]),headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]}});const t=new Date,i=t.toLocaleDateString(),s=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});o.setFontSize(10),o.setTextColor(100),o.text(`Fecha y hora de generación: ${i} ${s}`,10,o.internal.pageSize.height-10);const h=o.output("blob"),p=URL.createObjectURL(h);window.open(p,"_blank")},r.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo.")}},Se=()=>{const o=z.json_to_sheet(u.map((t,i)=>({"#":i+1,Título:t.title.toUpperCase(),Asunto:t.description.toUpperCase(),"Persona Requerida":t.personaRequerida.toUpperCase(),Fecha:t.start,"Hora Inicio":t.horaInicio,"Hora Fin":t.horaFin,Estado:t.estado}))),r=z.book_new();z.book_append_sheet(r,o,"Reporte de Citas"),Pe(r,"Reporte_Citas.xlsx")},B=o=>{const{name:r,value:t}=o.target,i={title:50,description:200,personaRequerida:100},s=t.replace(/[0-9]/g,"").replace(/[^A-Z\s]/gi,"").toUpperCase().replace(/([A-Z])\1{2,}/g,"$1$1");if(s.length>i[r]){m.fire({icon:"warning",title:"Advertencia",text:`El campo ${r} no puede exceder los ${i[r]} caracteres.`,confirmButtonColor:"#6C8E58"});return}y(h=>({...h,[r]:s}))};return oe?e.jsxs(Be,{fluid:!0,style:{backgroundColor:"#F8F9FA",padding:"20px"},children:[e.jsx(g,{className:"mb-4",children:e.jsx(d,{className:"text-center",children:e.jsx("h1",{style:{color:"#6C757D",fontWeight:"bold",fontSize:"2.5rem"},children:"Gestión de Citas para Padres"})})}),e.jsxs(g,{className:"mb-3 align-items-center",children:[e.jsx(d,{md:6,children:e.jsxs(Re,{children:[e.jsx(De,{style:{backgroundColor:"#4B6251",color:"white"},children:e.jsx(x,{icon:ze})}),e.jsx(f,{placeholder:"Buscar por título o fecha",value:de,onChange:Ce,style:{borderColor:"#4B6251"}}),e.jsx(j,{color:"secondary",onClick:me,style:{backgroundColor:"#6C8E58",color:"white",borderColor:"#6C8E58"},children:"Limpiar"})]})}),e.jsx(d,{md:3,children:e.jsx("span",{style:{color:"#6C757D"},children:`Citas encontradas: ${k.length}`})}),e.jsxs(d,{md:3,className:"text-end",children:[re&&e.jsxs(j,{color:"success",onClick:ge,style:{backgroundColor:"#4B6251",color:"white",borderColor:"#4B6251"},children:[e.jsx(x,{icon:qe})," Nueva Cita"]}),e.jsxs(He,{className:"d-inline ms-2",children:[e.jsxs(_e,{style:{backgroundColor:"#6C8E58",color:"white"},children:[e.jsx(x,{icon:J})," Reporte"]}),e.jsxs(Oe,{children:[e.jsx(Z,{onClick:be,children:"Exportar a PDF"}),e.jsx(Z,{onClick:Se,children:"Exportar a Excel"})]})]})]})]}),ie?e.jsx(Fe,{color:"secondary"}):U?e.jsx(Le,{color:"danger",children:U}):e.jsx("div",{className:"calendar-container",style:{maxWidth:"1500px",margin:"0 auto",boxShadow:"0 8px 16px rgba(0,0,0,0.2)",borderRadius:"8px",backgroundColor:"#FFFFFF",padding:"15px"},children:e.jsx(Ee,{plugins:[Ie,Ne,ke],initialView:"dayGridMonth",locale:Te,headerToolbar:{left:"prev today next",center:"title",right:"dayGridMonth,timeGridDay"},events:k.length>0?k.map(o=>({...o,id:o.id.toString(),backgroundColor:he(o.estado),borderColor:"#4B6251",textColor:"#000000"})):[{title:"No hay citas programadas",start:new Date().toISOString().split("T")[0],backgroundColor:"rgba(158, 158, 158, 0.8)",borderColor:"#4B6251",textColor:"#000000"}],eventContent:o=>o.view.type==="timeGridDay"?e.jsxs("span",{children:[e.jsx("strong",{children:o.event.title}),e.jsx("br",{}),o.event.extendedProps.horaInicio||""," -"," ",o.event.extendedProps.horaFin||""]}):e.jsx("span",{children:o.event.title}),eventClick:xe,editable:!0,height:"auto",contentHeight:"auto",titleFormat:{year:"numeric",month:"long"},dayHeaderClassNames:"fc-day-header",dayHeaderContent:o=>e.jsx("span",{style:{color:"#4B6251",fontWeight:"bold"},children:o.text})})}),e.jsxs(q,{visible:se,onClose:()=>N(!1),backdrop:"static",children:[e.jsx(H,{closeButton:!0,style:{backgroundColor:"#6C8E58",color:"white"},children:e.jsx(O,{children:"Detalles de la Cita"})}),e.jsx(_,{children:a&&e.jsxs(K,{children:[e.jsxs($e,{children:[e.jsx("strong",{children:a.title}),a.important&&e.jsx(Ge,{color:"danger",className:"ms-2",children:"Importante"})]}),e.jsxs(Me,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Asunto:"})," ",a.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Persona Requerida:"})," ",a.personaRequerida]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.start]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hora de Inicio:"})," ",a.horaInicio]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hora de Fin:"})," ",a.horaFin," "]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",a.estado]}),e.jsxs(j,{color:"warning",onClick:fe,style:{backgroundColor:"#6C8E58",color:"white"},children:[e.jsx(x,{icon:Ve})," Editar"]}),e.jsxs(j,{color:"secondary",className:"ms-2",onClick:()=>pe(a),style:{backgroundColor:"#6C8E58",color:"white",borderColor:"#6C8E58"},children:[e.jsx(x,{icon:J})," Exportar PDF"]})]})]})})]}),e.jsxs(q,{visible:ne,onClose:I,backdrop:"static",children:[e.jsx(H,{closeButton:!0,style:{backgroundColor:"#4B6251",color:"white"},children:e.jsx(O,{children:a?"Editar Cita":"Crear Nueva Cita"})}),e.jsx(_,{children:e.jsx(We,{onSubmit:je,children:e.jsxs(K,{className:"p-3",style:{border:"1px solid #4B6251"},children:[e.jsx(g,{className:"mb-3",children:e.jsxs(d,{md:12,children:[e.jsx(b,{children:"Nombre de la Cita"}),e.jsx(f,{type:"text",name:"title",value:l.title,onChange:B,placeholder:"Ejemplo: REUNIÓN DE PROYECTO",required:!0,style:{borderColor:"#6C8E58"}})]})}),e.jsx(g,{className:"mb-3",children:e.jsxs(d,{md:12,children:[e.jsx(b,{children:"Asunto"}),e.jsx(f,{type:"text",name:"description",value:l.description,onChange:B,placeholder:"Ejemplo: DISCUTIR AVANCES DEL PROYECTO",required:!0,style:{borderColor:"#6C8E58"}})]})}),e.jsx(g,{className:"mb-3",children:e.jsxs(d,{md:12,children:[e.jsx(b,{children:"Persona Requerida"}),e.jsx(f,{type:"text",name:"personaRequerida",value:l.personaRequerida,onChange:B,placeholder:"Ejemplo: JUAN PÉREZ",required:!0,style:{borderColor:"#6C8E58"}})]})}),e.jsxs(g,{className:"mb-3",children:[e.jsxs(d,{md:4,children:[e.jsx(b,{children:"Fecha"}),e.jsx(f,{type:"date",name:"fecha",value:l.fecha,onChange:A,required:!0,style:{borderColor:"#6C8E58"}})]}),e.jsxs(d,{md:4,children:[e.jsx(b,{children:"Hora de Inicio"}),e.jsx(f,{type:"time",name:"horaInicio",value:l.horaInicio,onChange:A,required:!0,style:{borderColor:"#6C8E58"}})]}),e.jsxs(d,{md:4,children:[e.jsx(b,{children:"Hora de Fin"}),e.jsx(f,{type:"time",name:"horaFin",value:l.horaFin,onChange:A,required:!0,style:{borderColor:"#6C8E58"}})]})]}),a&&e.jsx(g,{className:"mb-3",children:e.jsxs(d,{md:12,children:[e.jsx(b,{children:"Estado"}),e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"estadoSwitch",checked:l.estado==="Cancelada",onChange:()=>y(o=>({...o,estado:o.estado==="Cancelada"?"Pendiente":"Cancelada"})),style:{width:"3rem",height:"1.5rem",backgroundColor:l.estado==="Cancelada"?"red":"",border:l.estado==="Cancelada"?"1px solid red":""}}),e.jsx("label",{className:"form-check-label",htmlFor:"estadoSwitch",style:{fontSize:"1.25rem",color:l.estado==="Cancelada"?"red":"green",fontWeight:"bold"},children:l.estado==="Cancelada"?"Cancelada":"Activo"})]})]})}),e.jsxs(Ue,{children:[e.jsxs(j,{type:"submit",color:"success",style:{backgroundColor:"#4B6251",color:"white"},disabled:P,children:[e.jsx(x,{icon:Ye})," ",P?"Guardando...":"Guardar"]}),e.jsx(j,{color:"secondary",onClick:I,children:"Cancelar"})]})]})})})]}),e.jsxs(q,{size:"lg",visible:le,onClose:I,backdrop:"static",children:[e.jsx(H,{closeButton:!0,style:{backgroundColor:"#4B6251",color:"white"},children:e.jsx(O,{children:"Todas las Citas"})}),e.jsxs(_,{children:[e.jsxs(Ze,{hover:!0,responsive:!0,children:[e.jsx(Je,{children:e.jsxs(X,{children:[e.jsx(S,{children:"Título"}),e.jsx(S,{children:"Asunto"}),e.jsx(S,{children:"Persona Requerida"}),e.jsx(S,{children:"Fecha"}),e.jsx(S,{children:"Hora Inicio"}),e.jsx(S,{children:"Hora Fin"}),e.jsx(S,{children:"Estado"})]})}),e.jsx(Ke,{children:u.map(o=>e.jsxs(X,{children:[e.jsx(w,{children:o.title}),e.jsx(w,{children:o.description}),e.jsx(w,{children:o.personaRequerida}),e.jsx(w,{children:o.start}),e.jsx(w,{children:o.horaInicio}),e.jsx(w,{children:o.horaFin}),e.jsxs(w,{children:[e.jsx(x,{icon:ue(o.estado),className:"me-2"}),o.estado]})]},o.id))})]}),e.jsx(j,{color:"secondary",className:"mt-3",onClick:I,children:"Cerrar"})]})]})]}):e.jsx(Ae,{})};export{_o as default};
