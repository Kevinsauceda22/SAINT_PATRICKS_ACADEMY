import{r as i,j as t}from"./index-SVRFFNc9.js";import{C as c}from"./index.esm-DWwMdKxH.js";import{S as a}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as re}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as ie}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as w,w as ae}from"./xlsx-lwdk4T0U.js";import{C as se}from"./CContainer-BdNP0s3v.js";import{C as P,a as C}from"./CRow-Bf67u6lu.js";import{a as n}from"./CButton-D9GPTbB6.js";import{c as ne}from"./cil-plus-D8mtC-W5.js";import{C as le,a as ce,b as de,c as v}from"./CDropdownToggle-DlfIUTmX.js";import{c as pe}from"./cil-file-CeQgYs_D.js";import{C as F}from"./CInputGroup-D-McUFva.js";import{C as A}from"./CInputGroupText-Cfu0fzaY.js";import{c as me}from"./cil-search-CDkY_4k-.js";import{C as D}from"./CFormInput-B_gylY64.js";import{c as ue}from"./cil-brush-alt-CV61lKqC.js";import{C as he}from"./CFormSelect-CzT7g5tb.js";import{C as xe,a as Ce,b as I,c as b,d as ge,e as S}from"./CTable-98qqrSRH.js";import{c as fe}from"./cil-pen-53d2I-C-.js";import{c as je}from"./cil-trash-CBbKHhHb.js";import{C as Te}from"./CPagination-UopCEeNZ.js";import{C as we,a as be,b as Se,c as ye}from"./CModalHeader-Bhtr3bZe.js";import{C as Ee}from"./CModalTitle-M2mBvD_5.js";import{C as Be}from"./CForm-CYRkMwLo.js";import{c as ke}from"./cil-save-CHBg7z_U.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const nt=()=>{const[g,L]=i.useState([]),[Me,R]=i.useState(!0),[ze,_]=i.useState(""),[U,y]=i.useState(""),[E,B]=i.useState([]),[d,u]=i.useState(0),[h,O]=i.useState(5),[G,m]=i.useState(!1),[f,k]=i.useState(!1),[l,j]=i.useState({Tipo:""});i.useEffect(()=>{x()},[]);const x=async()=>{try{const e=await fetch("http://74.50.68.87:4000/api/tipomatricula/tipo-matricula"),o=await e.json();if(e.ok)L(o),B(o);else throw new Error(o.message||"Error al obtener los tipos de matrícula")}catch(e){_(e.message),a.fire({title:"Error",text:e.message,icon:"error",confirmButtonColor:"#4B6251"})}finally{R(!1)}},$=e=>{const r=e.replace(/[^A-Za-z\s]/g,"").toUpperCase().slice(0,30);return/(.)\1{2,}/.test(r)?l.Tipo:r},H=e=>{const o=$(e.target.value);j({...l,Tipo:o})},V=async e=>{try{const o=await fetch("http://74.50.68.87:4000/api/tipomatricula/tipo-matricula",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tipo:e})});if(o.ok)a.fire({title:"Éxito",text:"Tipo de matrícula creado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x();else{const r=await o.json();throw new Error(r.Mensaje||"Error al crear el tipo de matrícula")}}catch(o){a.fire({title:"Error",text:o.message,icon:"error",confirmButtonColor:"#4B6251"})}},Y=async(e,o)=>{try{const r=await fetch(`http://74.50.68.87:4000/api/tipomatricula/tipo-matricula/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tipo:o})});if(r.ok)a.fire({title:"Éxito",text:"Tipo de matrícula actualizado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x();else{const s=await r.json();throw new Error(s.Mensaje||"Error al actualizar el tipo de matrícula")}}catch(r){a.fire({title:"Error",text:r.message,icon:"error",confirmButtonColor:"#4B6251"})}},J=async e=>{try{const o=await fetch(`http://74.50.68.87:4000/api/tipomatricula/tipo-matricula/${e}`,{method:"DELETE"});if(o.ok)a.fire({title:"Éxito",text:"Tipo de matrícula eliminado correctamente.",icon:"success",confirmButtonColor:"#4B6251"}),x();else{const r=await o.json();throw new Error(r.Mensaje||"Error al eliminar el tipo de matrícula")}}catch(o){a.fire({title:"Error",text:o.message,icon:"error",confirmButtonColor:"#4B6251"})}},q=()=>{k(!1),j({Tipo:""}),m(!0)},K=e=>{k(!0),j(e),m(!0)},W=async e=>{if(e.preventDefault(),!l.Tipo){a.fire({title:"Error",text:"El nombre del tipo no puede estar vacío ni contener caracteres especiales o tres letras iguales seguidas.",icon:"error",confirmButtonColor:"#4B6251"});return}f?await Y(l.Cod_tipo_matricula,l.Tipo):await V(l.Tipo),m(!1)},Z=e=>{a.fire({title:"¿Estás seguro?",text:"No podrás revertir esta acción",icon:"warning",showCancelButton:!0,confirmButtonColor:"#4B6251",cancelButtonColor:"#6c757d",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&J(e)})},Q=e=>{const o=e.target.value.toLowerCase();y(o);const r=g.filter(s=>s.Tipo.toLowerCase().includes(o));B(r),u(0)},X=()=>{const e=new re,o=new Image;o.src=ie,o.onload=()=>{e.addImage(o,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,20,{align:"center"}),e.setFontSize(14),e.text("Reporte de Tipos de Matrícula",e.internal.pageSize.width/2,30,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,40,{align:"center"}),e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,45,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,e.internal.pageSize.width-10,55),e.setFontSize(12),e.setTextColor(0,51,102),e.text("Detalles de los Tipos de Matrícula",e.internal.pageSize.width/2,65,{align:"center"}),e.autoTable({startY:75,head:[["#","TIPO DE MATRÍCULA"]],body:g.map((p,T)=>[T+1,p.Tipo.toUpperCase()||"N/A"]),styles:{fontSize:10,textColor:[34,34,34],cellPadding:4,valign:"middle",overflow:"linebreak"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:10,right:10}});const r=e.internal.getNumberOfPages();for(let p=1;p<=r;p++){e.setPage(p);const T=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y Hora de Generación: ${T}`,10,e.internal.pageSize.height-10),e.text(`Página ${p} de ${r}`,e.internal.pageSize.width-30,e.internal.pageSize.height-10,{align:"right"})}const s=e.output("blob"),oe=URL.createObjectURL(s);window.open(oe)},o.onerror=()=>{Swal.fire("Error","No se pudo cargar el logo.","error")}},ee=()=>{const e=w.json_to_sheet(g.map((r,s)=>({"#":s+1,"Tipo de Matrícula":r.Tipo.toUpperCase()}))),o=w.book_new();w.book_append_sheet(o,e,"Tipos de Matrícula"),ae(o,"Reporte_Tipos_Matricula.xlsx")},M=(d+1)*h,z=M-h,te=E.slice(z,M),N=Math.ceil(E.length/h);return t.jsxs(se,{children:[t.jsxs(P,{className:"justify-content-between align-items-center mb-4",children:[t.jsx(C,{xs:12,md:8,children:t.jsx("h3",{children:"Mantenimientos Tipos de Matrícula"})}),t.jsxs(C,{xs:12,md:4,className:"text-end",children:[t.jsxs(n,{style:{backgroundColor:"#4B6251",color:"white",width:"auto",height:"38px"},onClick:q,children:[t.jsx(c,{icon:ne})," Nuevo"]}),t.jsxs(le,{className:"d-inline ms-2",children:[t.jsxs(ce,{style:{backgroundColor:"#6C8E58",color:"white",width:"auto",height:"38px"},children:[t.jsx(c,{icon:pe})," Reporte"]}),t.jsxs(de,{children:[t.jsx(v,{onClick:X,children:"Exportar a PDF"}),t.jsx(v,{onClick:ee,children:"Exportar a Excel"})]})]})]})]}),t.jsxs(P,{className:"align-items-center mb-3",children:[t.jsx(C,{md:6,children:t.jsxs(F,{size:"sm",children:[t.jsx(A,{children:t.jsx(c,{icon:me})}),t.jsx(D,{placeholder:"Buscar tipo de matrícula",value:U,onChange:Q,style:{fontSize:"0.9rem"}}),t.jsxs(n,{style:{border:"1px solid #ccc",backgroundColor:"#F3F4F7",color:"#343a40",fontSize:"0.9rem"},onClick:()=>y(""),children:[t.jsx(c,{icon:ue})," Limpiar"]})]})}),t.jsx(C,{md:6,className:"text-end",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-end",children:[t.jsx("span",{className:"me-2",children:"Mostrar "}),t.jsxs(he,{size:"sm",style:{width:"80px"},value:h,onChange:e=>{O(Number(e.target.value)),u(0)},children:[t.jsx("option",{value:"5",children:"5"}),t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"20",children:"20"})]}),t.jsx("span",{children:" registros"})]})})]}),t.jsxs(xe,{striped:!0,bordered:!0,hover:!0,children:[t.jsx(Ce,{children:t.jsxs(I,{children:[t.jsx(b,{children:"#"}),t.jsx(b,{children:"TIPO DE MATRÍCULA"}),t.jsx(b,{children:"Acciones"})]})}),t.jsx(ge,{children:te.map((e,o)=>t.jsxs(I,{children:[t.jsx(S,{children:z+o+1}),t.jsx(S,{children:e.Tipo.toUpperCase()}),t.jsxs(S,{children:[t.jsx(n,{color:"warning",size:"sm",onClick:()=>K(e),children:t.jsx(c,{icon:fe})})," ",t.jsx(n,{color:"danger",size:"sm",onClick:()=>Z(e.Cod_tipo_matricula),children:t.jsx(c,{icon:je})})]})]},e.Cod_tipo_matricula))})]}),t.jsxs("nav",{className:"d-flex justify-content-center align-items-center mt-4",children:[t.jsxs(Te,{className:"mb-0",style:{gap:"0.3cm"},children:[t.jsx(n,{style:{backgroundColor:"gray",color:"white",marginRight:"0.3cm"},disabled:d===0,onClick:()=>u(d-1),children:"Anterior"}),t.jsx(n,{style:{backgroundColor:"gray",color:"white"},disabled:d===N-1,onClick:()=>u(d+1),children:"Siguiente"})]}),t.jsxs("span",{className:"mx-2",children:["Página ",d+1," de ",N]})]}),t.jsxs(we,{visible:G,onClose:()=>m(!1),backdrop:"static",children:[t.jsx(be,{closeButton:!0,children:t.jsx(Ee,{children:f?"Editar Tipo de Matrícula":"Agregar Tipo de Matrícula"})}),t.jsx(Se,{children:t.jsxs(Be,{onSubmit:W,children:[t.jsxs(F,{className:"mb-3",children:[t.jsx(A,{children:"Nombre del Tipo"}),t.jsx(D,{type:"text",placeholder:"Nombre del tipo",value:l.Tipo||"",onChange:H,required:!0})]}),t.jsxs(ye,{children:[t.jsx(n,{style:{backgroundColor:"#6c757d",color:"white",borderColor:"#6c757d"},onClick:()=>m(!1),children:"Cancelar"}),t.jsxs(n,{style:{backgroundColor:"#4B6251",color:"white",borderColor:"#4B6251"},type:"submit",children:[t.jsx(c,{icon:ke})," ","Guardar"]})]})]})})]})]})};export{nt as default};
