import{r as l,i as x,j as e}from"./index-SVRFFNc9.js";import{S as _}from"./sweetalert2.esm.all-D3pEHXw3.js";import{w as Ee}from"./sweetalert2-react-content.es-QMl1rtTe.js";import{C as g}from"./index.esm-DWwMdKxH.js";import{E as oe}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as re}from"./logo_saint_patrick-xw7Wl8f3.js";import{C as Pe}from"./CContainer-BdNP0s3v.js";import{C as Y,a as z}from"./CRow-Bf67u6lu.js";import{a as b}from"./CButton-D9GPTbB6.js";import{c as Ae}from"./cil-plus-D8mtC-W5.js";import{c as te}from"./cil-file-CeQgYs_D.js";import{C as D}from"./CFormInput-B_gylY64.js";import{C as M}from"./CFormSelect-CzT7g5tb.js";import{C as Fe,a as Te,b as ae,c as y,d as ze,e as E}from"./CTable-98qqrSRH.js";import{c as J,a as ne}from"./cil-wallet-DpZYkYGX.js";import{C as se,a as ce,b as ie,c as le}from"./CModalHeader-Bhtr3bZe.js";import{C as de}from"./CForm-CYRkMwLo.js";import{C}from"./CInputGroup-D-McUFva.js";import{C as j}from"./CInputGroupText-Cfu0fzaY.js";import{c as pe}from"./cil-description-MUzg6O3n.js";import{c as ue}from"./cil-dollar-_O5uWVEr.js";import{C as Me}from"./CModalTitle-M2mBvD_5.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";import"./CConditionalPortal-DwBsYzTA.js";const Re=N=>{try{const L=N.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),v=decodeURIComponent(atob(L).split("").map(H=>`%${`00${H.charCodeAt(0).toString(16)}`.slice(-2)}`).join(""));return JSON.parse(v)}catch(P){return console.error("Error al decodificar el token JWT:",P),null}},d=Ee(_),lo=()=>{const[N,P]=l.useState([]),[L,v]=l.useState(!1),[H,R]=l.useState(!1),[A,me]=l.useState(null),[k,ge]=l.useState([]),[w,he]=l.useState(""),[n,f]=l.useState({cod_caja:"",monto:"",descripcion:"",cod_concepto:"",aplicar_descuento:!1,valor_descuento:"",descripcion_descuento:""}),[s,F]=l.useState({descripcion:"",monto:"",cod_concepto:"",dni_padre:""}),[fe,xe]=l.useState([]),[B,be]=l.useState(""),[h,V]=l.useState(1),[$,Ce]=l.useState(5),[je,U]=l.useState(""),[m,q]=l.useState({}),[_e,G]=l.useState(0),O=()=>{f({cod_caja:"",monto:"",descripcion:"",cod_concepto:"",aplicar_descuento:!1,valor_descuento:"",descripcion_descuento:""}),U(""),G(0)},W=()=>{F({descripcion:"",monto:"",cod_concepto:"",dni_padre:""})};l.useEffect(()=>{I(),Ne()},[]);const I=async()=>{try{const o=await x.get("http://74.50.68.87:4000/api/caja/todas-pendientes");o.status===200?P(o.data.data.sort((r,a)=>new Date(a.Fecha_pago)-new Date(r.Fecha_pago))):d.fire({icon:"warning",title:"Atención",text:o.data.message||"No se encontraron cajas pendientes."})}catch(o){console.error("Error al obtener las cajas pendientes:",o),d.fire({icon:"error",title:"Error",text:"Hubo un problema al conectar con el servidor."})}},Ne=async()=>{try{const o=await x.get("http://74.50.68.87:4000/api/caja/conceptos");xe(o.data.data||[])}catch(o){console.error("Error al obtener conceptos:",o)}},K=async(o,r="")=>{try{const a=localStorage.getItem("token"),t=Re(a);if(!t){_.fire("Error","Token inválido o expirado. Por favor, inicie sesión nuevamente.","error");return}const c=t.cod_usuario,p=t.nombre_usuario;if(!c||!p){_.fire("Error","El token no contiene información válida del usuario.","error");return}const i=`El usuario: ${p} realizó la acción: ${o}. ${r}`;console.log("Datos para bitácora:",{cod_usuario:c,cod_objeto:106,accion:o,descripcion:i}),await x.post("http://74.50.68.87:4000/api/bitacora/registro",{cod_usuario:c,cod_objeto:106,accion:o,descripcion:i},{headers:{Authorization:`Bearer ${a}`}}),console.log("Registro en bitácora exitoso")}catch(a){console.error("Error al registrar en bitácora:",a.message),_.fire("Error","Hubo un problema al registrar en la bitácora.","error")}},Q=async o=>{o.preventDefault();try{const r=n.descripcion||w;if(!r||!r.trim()){d.fire({icon:"warning",title:"Campo obligatorio",text:"La descripción no puede estar vacía.",confirmButtonText:"Entendido"});return}const a=parseFloat(n.monto||A||0);if(!a||isNaN(a)||a<=0){d.fire({icon:"warning",title:"Monto inválido",text:"El monto debe ser un número mayor a 0.",confirmButtonText:"Entendido"});return}if(!n.cod_concepto)try{const u=await x.get("http://74.50.68.87:4000/api/caja/concepto/matricula");if(u.status===200&&u.data.cod_concepto)n.cod_concepto=u.data.cod_concepto;else{d.fire({icon:"error",title:"Error al obtener concepto",text:'No se pudo obtener el código del concepto "Matricula".',confirmButtonText:"Revisar"});return}}catch(u){console.error('Error al obtener el concepto "Matricula":',u),d.fire({icon:"error",title:"Error inesperado",text:"Hubo un problema al obtener el código del concepto.",confirmButtonText:"Entendido"});return}if(n.descripcion.length>25){d.fire({icon:"warning",title:"Descripción inválida",text:"La descripción no puede exceder los 25 caracteres.",confirmButtonText:"Entendido"});return}if(/[^A-Z0-9 ]/.test(n.descripcion)){d.fire({icon:"warning",title:"Descripción inválida",text:"La descripción solo puede contener letras, números y espacios.",confirmButtonText:"Entendido"});return}let t=0;if(n.aplicar_descuento&&n.cod_descuento){const u=parseFloat(n.valor_descuento);if(isNaN(u)||u<=0||u>100){d.fire({icon:"warning",title:"Descuento inválido",text:"El descuento debe ser un porcentaje válido entre 0% y 100%.",confirmButtonText:"Entendido"});return}t=a*u/100}const c=a-t;if(c<0){d.fire({icon:"warning",title:"Monto inválido",text:"El monto final no puede ser negativo.",confirmButtonText:"Entendido"});return}const p={cod_caja:n.cod_caja,monto:c,descripcion:r,cod_concepto:n.cod_concepto,cod_descuento:n.aplicar_descuento?n.cod_descuento:null};console.log("Datos enviados al servidor:",p);const i=await x.post("http://74.50.68.87:4000/api/caja/pago",p);if(i.status===201||i.status===200){d.fire({icon:"success",title:"Éxito",text:"El pago se ha registrado correctamente.",confirmButtonText:"Aceptar"}),await K("INSERT",`Registró un pago de ${c.toFixed(2)} con concepto "${n.descripcion}" en la caja ${n.cod_caja}.`);const u={Cod_caja:n.cod_caja,Nombre_Padre:"Nombre del Padre",Apellido_Padre:"Apellido del Padre",Descripcion:n.descripcion,Monto:c,Estado_pago:"Pagado",Fecha_pago:new Date,Hora_registro:new Date};d.fire({title:"¿Deseas descargar el recibo?",text:"El recibo se generará como un archivo PDF.",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, generar",cancelButtonText:"No"}).then(S=>{S.isConfirmed&&Z(u,je,_e)}),v(!1),O(),I()}}catch(r){console.error("Error al registrar el pago:",r),r.response&&r.response.data&&r.response.data.message?d.fire({icon:"error",title:"Error al registrar el pago",text:r.response.data.message,confirmButtonText:"Revisar"}):d.fire({icon:"error",title:"Error inesperado",text:"Hubo un problema al procesar la solicitud. Por favor, intenta nuevamente más tarde.",confirmButtonText:"Entendido"})}};l.useEffect(()=>{(async()=>{try{const r=await x.get("http://74.50.68.87:4000/api/caja/concepto/matricula");r.status===200&&f(a=>({...a,cod_concepto:r.data.cod_concepto}))}catch(r){console.error('Error al obtener el concepto "Pago de matricula":',r)}})()},[]),l.useEffect(()=>{(async()=>{try{const r=await x.get("http://74.50.68.87:4000/api/caja/descuentos");r.status===200&&r.data.data?(ge(r.data.data),console.log("Descuentos obtenidos:",r.data.data)):console.error("La respuesta no contiene datos de descuentos:",r.data)}catch(r){console.error("Error al obtener los descuentos:",r.message)}})()},[]);const X=async()=>{if(console.log("Datos de la nueva caja:",s),!s.descripcion||!s.monto||!s.cod_concepto||!s.dni_padre){await d.fire({icon:"error",title:"Error",text:"Todos los campos son obligatorios."});return}if(!/^[0-9]{13}$/.test(s.dni_padre)){await d.fire({icon:"error",title:"Error en el DNI",text:"El DNI debe tener 13 dígitos y contener solo números."});return}if(s.descripcion.length>25){await d.fire({icon:"error",title:"Error en la descripción",text:"La descripción no puede exceder los 25 caracteres."});return}if(/([A-Z])\1\1/.test(s.descripcion)){await d.fire({icon:"error",title:"Error en la descripción",text:"La descripción no puede contener tres letras iguales consecutivas."});return}if(/[^a-zA-Z0-9 ]/.test(s.descripcion)){await d.fire({icon:"error",title:"Error en la descripción",text:"La descripción no puede contener símbolos o caracteres especiales."});return}let r=0;if(s.aplicar_descuento&&s.valor_descuento){const t=parseFloat(s.valor_descuento);if(isNaN(t)||t<=0||t>100){await d.fire({icon:"error",title:"Error en el descuento",text:"El descuento debe ser un porcentaje válido entre 0% y 100%."});return}r=s.monto*t/100}const a=s.monto-r;if(a<0){await d.fire({icon:"error",title:"Error en el monto",text:"El monto final no puede ser negativo."});return}try{const t={descripcion:s.descripcion,monto:a,cod_concepto:s.cod_concepto,dni_padre:s.dni_padre,estado_pago:"Pendiente",aplicar_descuento:s.aplicar_descuento||!1,cod_descuento:s.aplicar_descuento?s.cod_descuento:null};console.log("Datos enviados al servidor:",t);const c=await x.post("http://74.50.68.87:4000/api/caja/oficial",t);if(c.status===201||c.status===200){console.log("Caja creada exitosamente"),await K("INSERT",`Caja creada. Descripción: "${s.descripcion}", Monto: ${a.toFixed(2)}, DNI del Padre: ${s.dni_padre}.`);const p={Cod_caja:c.data.cod_caja||"No disponible",Nombre_Padre:s.Nombre_Padre||"No disponible",Apellido_Padre:s.Apellido_Padre||"No disponible",Descripcion:s.descripcion,Monto:a,Descuento:r>0?`L ${r.toFixed(2)}`:"No aplica",Estado_pago:"Pendiente",Fecha_pago:new Date,Hora_registro:new Date};await d.fire({icon:"success",title:"Éxito",text:"La nueva caja se ha creado exitosamente."}),(await d.fire({title:"¿Desea imprimir el recibo?",icon:"question",showCancelButton:!0,confirmButtonText:"Sí, generar",cancelButtonText:"No"})).isConfirmed&&Z(p,s.monto,r),W(),R(!1),I()}else console.log("Error en el servidor:",c),await d.fire({icon:"warning",title:"Atención",text:"No se pudo crear la caja. Intente de nuevo."})}catch(t){console.error("Error al crear la caja:",t),await d.fire({icon:"error",title:"Error",text:"Ocurrió un error al conectar con el servidor."})}};l.useEffect(()=>{(async()=>{try{if(!n.cod_caja){console.warn("No se proporcionó el código de la caja.");return}const r=await x.get(`http://74.50.68.87:4000/api/caja/nombre-alumno?cod_caja=${n.cod_caja}`);r.status===200?we(r.data.nombre):console.error("Error al cargar el nombre del alumno:",r.data.message)}catch(r){console.error("Error al cargar el nombre del alumno:",r)}})()},[n.cod_caja]);const[ee,we]=l.useState(""),ve=N.filter(o=>{const r=B.toLowerCase();return`${o.Nombre_Padre} ${o.Apellido_Padre}`.toLowerCase().includes(r)||o.DNI_Padre&&o.DNI_Padre.toString().includes(B)}).slice((h-1)*$,h*$);l.useEffect(()=>{console.log("Datos de pagos pendientes:",N)},[N]);const Se=async o=>{try{if(!o||o.trim()==="")throw new Error("El campo DNI está vacío. Por favor, ingrese un DNI válido.");const r=`http://74.50.68.87:4000/api/caja/buscar-por-dni?dni=${o}`,a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok){const c=await a.json();throw new Error(c.message||"Error al buscar cajas por DNI.")}const t=await a.json();return!t||t.length===0?(alert("No se encontraron resultados para el DNI ingresado."),null):(console.log("Resultados de la búsqueda:",t),t)}catch(r){return console.error("Error al realizar la búsqueda:",r.message),null}},T=Math.ceil(N.length/$),De=o=>{if(!Array.isArray(o)||o.length===0){_.fire("Error","No hay datos para generar el reporte.","error");return}const r=new oe,a=new Image;a.src=re,a.onload=()=>{r.addImage(a,"PNG",10,10,30,30),r.setFontSize(18),r.setTextColor(0,102,51),r.text("SAINT PATRICK'S ACADEMY",r.internal.pageSize.width/2,20,{align:"center"}),r.setFontSize(14),r.text("Reporte General de Cajas (Todos los registros)",r.internal.pageSize.width/2,30,{align:"center"}),r.setFontSize(10),r.setTextColor(100),r.text("Casa Club del periodista, Colonia del Periodista",r.internal.pageSize.width/2,40,{align:"center"}),r.text("Teléfono: (504) 2234-8871",r.internal.pageSize.width/2,45,{align:"center"}),r.text("Correo: info@saintpatrickacademy.edu",r.internal.pageSize.width/2,50,{align:"center"}),r.setLineWidth(.5),r.setDrawColor(0,102,51),r.line(10,55,r.internal.pageSize.width-10,55),r.setFontSize(12),r.setTextColor(0,51,102),r.text("Detalles de Cajas (Todos los Registros)",r.internal.pageSize.width/2,65,{align:"center"}),r.autoTable({startY:75,head:[["#","Nombre Padre","Descripción","Monto","Estado","Fecha de Registro"]],body:o.map((i,u)=>[u+1,`${i.Nombre_Padre||"N/A"} ${i.Apellido_Padre||"N/A"}`,i.Descripcion||"N/A",`L ${parseFloat(i.Monto||0).toFixed(2)}`,i.Estado_pago||"Pendiente",i.Fecha_pago?new Date(i.Fecha_pago).toLocaleDateString():"N/A"]),styles:{fontSize:10,textColor:[34,34,34],cellPadding:4,valign:"middle",overflow:"linebreak"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:10,right:10}});const t=r.internal.getNumberOfPages();for(let i=1;i<=t;i++){r.setPage(i);const u=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});r.setFontSize(10),r.setTextColor(100),r.text(`Fecha y Hora de Generación: ${u}`,10,r.internal.pageSize.height-10),r.text(`Página ${i} de ${t}`,r.internal.pageSize.width-30,r.internal.pageSize.height-10,{align:"right"})}const c=r.output("blob"),p=URL.createObjectURL(c);window.open(p)},a.onerror=()=>{_.fire("Error","No se pudo cargar el logo.","error")}},Z=(o,r,a)=>{const t=new oe,c=new Image;c.src=re,c.onload=()=>{try{t.addImage(c,"PNG",10,10,30,30),t.setFontSize(18),t.setTextColor(0,102,51),t.text("SAINT PATRICK'S ACADEMY",t.internal.pageSize.width/2,20,{align:"center"}),t.setFontSize(14),t.text("Recibo de Caja",t.internal.pageSize.width/2,30,{align:"center"}),t.setFontSize(10),t.setTextColor(100),t.text("Casa Club del periodista, Colonia del Periodista",t.internal.pageSize.width/2,40,{align:"center"}),t.text("Teléfono: (504) 2234-8871",t.internal.pageSize.width/2,45,{align:"center"}),t.text("Correo: info@saintpatrickacademy.edu",t.internal.pageSize.width/2,50,{align:"center"}),t.setLineWidth(.5),t.setDrawColor(0,102,51),t.line(10,55,t.internal.pageSize.width-10,55),t.setFontSize(12),t.setTextColor(0,51,102),t.text("Detalles del Recibo",t.internal.pageSize.width/2,65,{align:"center"}),t.autoTable({startY:75,head:[["Campo","Valor"]],body:[["Nombre del Padre",`${o.Nombre_Padre||"N/A"} ${o.Apellido_Padre||"N/A"}`],["Descripción",o.Descripcion||"N/A"],["Monto",`L ${parseFloat(o.Monto||0).toFixed(2)}`],["Estado de Pago",o.Estado_pago||"Pendiente"],["Fecha de Registro",o.Fecha_pago?new Date(o.Fecha_pago).toLocaleDateString():"N/A"],["Hora de Registro",o.Hora_registro?new Date(o.Hora_registro).toLocaleTimeString():"N/A"]],styles:{fontSize:10,textColor:[34,34,34],cellPadding:4,valign:"middle",overflow:"linebreak"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10},alternateRowStyles:{fillColor:[240,248,255]},margin:{left:10,right:10}});const p=t.internal.getNumberOfPages();for(let S=1;S<=p;S++){t.setPage(S);const ye=new Date().toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});t.setFontSize(10),t.setTextColor(100),t.text(`Fecha y Hora de Generación: ${ye}`,10,t.internal.pageSize.height-10),t.text(`Página ${S} de ${p}`,t.internal.pageSize.width-30,t.internal.pageSize.height-10,{align:"right"})}const i=t.output("blob"),u=URL.createObjectURL(i);window.open(u)}catch(p){console.error("Error al generar el PDF:",p),_.fire("Error","Hubo un problema al generar el PDF.","error")}},c.onerror=()=>{_.fire("Error","No se pudo cargar el logo. Verifique la ruta o formato.","error")}};return l.useEffect(()=>{(async()=>{try{const r=n.cod_caja;if(!r){console.warn("No se proporcionó el código de la caja.");return}const a=await x.get(`http://74.50.68.87:4000/api/caja/parametro/Matricula?cod_caja=${r}`);if(a.status===200){const{valor:t,parametro:c}=a.data;me(t),he(c)}else console.error("Error al cargar el valor de matrícula:",a.data.message)}catch(r){console.error("Error al cargar el valor de matrícula por caja:",r)}})()},[n.cod_caja]),l.useEffect(()=>{w&&f(o=>({...o,descripcion:w}))},[w]),l.useEffect(()=>{w&&f(o=>({...o,descripcion:"Pago de matrícula"}))},[w]),l.useEffect(()=>{A&&f(o=>({...o,monto:A}))},[A]),e.jsxs(Pe,{children:[e.jsx("div",{className:"text-center mb-4",children:e.jsx("h4",{style:{color:"#4A4A4A",fontWeight:"bold"},children:"Cajas "})}),e.jsxs(Y,{className:"justify-content-end mb-3",children:[e.jsx(z,{xs:"auto",children:e.jsxs(b,{onClick:()=>R(!0),style:{backgroundColor:"#4B6251",color:"white",border:"none",borderRadius:"5px",padding:"0.5rem 1rem",fontSize:"0.9rem",fontWeight:"bold"},children:[e.jsx(g,{icon:Ae,className:"me-1"}),"Nueva"]})}),e.jsx(z,{xs:"auto",children:e.jsxs(b,{onClick:()=>{const o=N.filter(r=>`${r.Nombre_Padre} ${r.Apellido_Padre}`.toLowerCase().includes(B.toLowerCase()));De(o)},style:{backgroundColor:"#6C8E58",color:"white",border:"none",borderRadius:"5px",padding:"0.5rem 1rem",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer"},title:"Exportar reporte filtrado según la búsqueda actual",children:[e.jsx(g,{icon:te,className:"me-1"}),"Exportar PDF"]})})]}),e.jsxs(Y,{className:"justify-content-between align-items-center mb-3",children:[e.jsx(z,{xs:4,md:3,children:e.jsx(D,{placeholder:"Buscar por nombre o DNI del padre",value:B,onChange:async o=>{const r=o.target.value;if(be(r),r.trim()!==""){const a=await Se(r);a&&P(a.data||[])}else I()},style:{border:"1px solid #ccc",borderRadius:"5px",fontSize:"0.9rem"}})}),e.jsx(z,{xs:"auto",children:e.jsxs(M,{value:$,onChange:o=>{Ce(parseInt(o.target.value)),V(1)},style:{border:"1px solid #ccc",borderRadius:"5px",fontSize:"0.9rem",color:"#4A4A4A"},children:[e.jsx("option",{value:5,children:"Mostrar 5 registros"}),e.jsx("option",{value:10,children:"Mostrar 10 registros"}),e.jsx("option",{value:20,children:"Mostrar 20 registros"})]})})]}),e.jsxs(Fe,{hover:!0,bordered:!0,className:"shadow-sm",style:{borderRadius:"10px"},children:[e.jsx(Te,{style:{backgroundColor:"#0056b3",color:"white"},children:e.jsxs(ae,{children:[e.jsx(y,{children:"Nombre del Padre"}),e.jsx(y,{children:"Monto"}),e.jsx(y,{children:"Descripción"}),e.jsx(y,{children:"Hora"}),e.jsx(y,{children:"Fecha"}),e.jsx(y,{children:"Acciones"})]})}),e.jsx(ze,{children:ve.map(o=>{var r,a;return e.jsxs(ae,{children:[e.jsx(E,{children:`${((r=o.Nombre_Padre)==null?void 0:r.toUpperCase())||""} ${((a=o.Apellido_Padre)==null?void 0:a.toUpperCase())||""}`}),e.jsx(E,{children:o.Monto?`L ${parseFloat(o.Monto).toFixed(2)}`:"PENDIENTE"}),e.jsx(E,{children:o.Descripcion?o.Descripcion.toUpperCase():"SIN DESCRIPCIÓN"}),e.jsx(E,{children:o.Hora_registro?new Date(o.Hora_registro).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"SIN HORA"}),e.jsx(E,{children:o.Fecha_pago?new Date(o.Fecha_pago).toLocaleDateString().toUpperCase():"SIN FECHA"}),e.jsxs(E,{children:[o.Monto===null&&e.jsx(b,{onClick:()=>{f({cod_caja:o.Cod_caja,monto:"",descripcion:"",cod_concepto:"",aplicar_descuento:!1,valor_descuento:"",descripcion_descuento:""}),v(!0)},style:{backgroundColor:"#4B6251",color:"white",border:"none",borderRadius:"5px",padding:"0.3rem 0.6rem",fontSize:"0.8rem"},children:e.jsx(g,{icon:J,className:"me-1"})}),e.jsx(b,{onClick:()=>Z(o),style:{backgroundColor:"#008080",color:"white",border:"none",borderRadius:"5px",padding:"0.3rem 0.6rem",fontSize:"0.8rem",marginLeft:"5px"},children:e.jsx(g,{icon:te,className:"me-1"})})]})]},o.Cod_caja)})})]}),e.jsx(Y,{className:"justify-content-center align-items-center mt-3",children:e.jsxs(z,{xs:"auto",children:[e.jsx(b,{disabled:h===1,onClick:()=>V(o=>o-1),style:{backgroundColor:h===1?"#d6d6d6":"#7a7a7a",color:h===1?"#a0a0a0":"#ffffff",border:"none",cursor:h===1?"not-allowed":"pointer",padding:"0.5rem 1.5rem"},children:"Anterior"}),e.jsx(b,{disabled:h===T,onClick:()=>V(o=>o+1),className:"ms-2",style:{backgroundColor:h===T?"#d6d6d6":"#7a7a7a",color:h===T?"#a0a0a0":"#ffffff",border:"none",cursor:h===T?"not-allowed":"pointer",padding:"0.5rem 1.5rem"},children:"Siguiente"}),e.jsxs("span",{className:"ms-2",style:{color:"#7a7a7a",fontSize:"1rem"},children:["Página ",h," de ",T]})]})}),e.jsxs(se,{visible:L,onClose:()=>{O(),v(!1)},backdrop:"static",className:"modal-md border-0 rounded shadow",children:[e.jsxs(ce,{className:"bg-light border-bottom py-3 px-4",style:{display:"flex",flexDirection:"column",gap:"5px"},children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-start",style:{gap:"10px",width:"100%"},children:[e.jsx(g,{icon:J,style:{fontSize:"2rem",color:"#4B6251"}}),e.jsx("h4",{className:"fw-bold mb-0",style:{color:"#4B6251",fontSize:"1.7rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Pago de Matricula"})]}),ee&&e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"500",color:"#6C757D",marginLeft:"2.5rem"},children:["Matrícula del Alumno"," ",e.jsx("strong",{style:{color:"#4B6251",textTransform:"uppercase"},children:ee})]})]}),e.jsx(ie,{className:"p-4",children:e.jsxs(de,{onSubmit:Q,children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:pe,className:"text-muted"})}),e.jsx(D,{type:"text",name:"descripcion",placeholder:"Descripción",value:w||n.descripcion||"",readOnly:!0,className:"form-control border-0 shadow-sm"})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:ue,className:"text-muted"})}),e.jsx(D,{type:"number",name:"monto",placeholder:"Monto (Lempiras)",value:n.monto||A||"",readOnly:!0,className:"form-control border-0 shadow-sm",required:!0})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:ne,className:"text-muted"})}),e.jsx(M,{name:"cod_concepto",value:n.cod_concepto||"",disabled:!0,className:"form-select border-0 shadow-sm",required:!0,children:e.jsx("option",{value:n.cod_concepto,children:"Pago de matricula"})})]}),e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{type:"checkbox",className:"form-check-input shadow-sm",id:"aplicarDescuento",checked:n.aplicar_descuento,onChange:o=>f({...n,aplicar_descuento:o.target.checked})}),e.jsx("label",{className:"form-check-label text-muted",htmlFor:"aplicarDescuento",children:"Aplicar Descuento"})]}),n.aplicar_descuento&&e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:"%"}),e.jsxs(M,{name:"cod_descuento",value:n.cod_descuento||"",onChange:o=>{const r=o.target.value,a=k.find(t=>t.Cod_descuento.toString()===r);if(a){const t=parseFloat(a.Valor)*100,c=parseFloat(n.monto||0),p=c*(t/100),i=c-p;f({...n,cod_descuento:a.Cod_descuento,valor_descuento:a.Valor,monto_final:i>0?i:0})}},className:"form-select border-0 shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar descuento"}),k.map(o=>e.jsxs("option",{value:o.Cod_descuento,children:[o.Valor*100,"% - ",o.Nombre_descuento]},o.Cod_descuento))]})]})]})}),e.jsxs(le,{className:"d-flex justify-content-end border-0",children:[e.jsx(b,{color:"secondary",className:"btn-light shadow-sm me-2",style:{color:"#4B6251"},onClick:()=>{O(),v(!1)},children:"Cancelar"}),e.jsx(b,{className:"shadow-sm",style:{backgroundColor:m.descripcion||m.monto||m.valor_descuento||m.descripcion_descuento?"#cccccc":"#4B6251",borderColor:"#4B6251",color:m.descripcion||m.monto||m.valor_descuento||m.descripcion_descuento?"#666666":"white"},onClick:Q,disabled:m.descripcion||m.monto||m.valor_descuento||m.descripcion_descuento,children:"Guardar"})]})]}),e.jsxs(se,{visible:H,onClose:()=>{W(),U(0),G(0),R(!1)},backdrop:"static",className:"modal-md border-0 rounded shadow",children:[e.jsx(ce,{closeButton:!0,className:"bg-light border-0",children:e.jsxs(Me,{className:"fw-bold",style:{color:"#4B6251"},children:[e.jsx(g,{icon:J,className:"me-2"})," Crear Nueva Caja"]})}),e.jsx(ie,{className:"p-4",children:e.jsxs(de,{onSubmit:X,children:[e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:"DNI"}),e.jsx(D,{type:"text",name:"dni_padre",placeholder:"DNI del padre",value:s.dni_padre,maxLength:13,onChange:o=>{const r=o.target.value.replace(/\D/g,"");F({...s,dni_padre:r})},onPaste:o=>o.preventDefault(),onCopy:o=>o.preventDefault(),className:`form-control border-0 shadow-sm ${s.dni_padre.length!==13?"is-invalid":""}`,required:!0})]}),s.dni_padre.length!==13&&e.jsx("small",{className:"text-danger",children:"El DNI debe tener exactamente 13 dígitos."}),e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:pe,className:"text-muted"})}),e.jsx(D,{type:"text",name:"descripcion",placeholder:"Descripción",value:s.descripcion,maxLength:25,onChange:o=>{const r=o.target.value.toUpperCase();/[^A-Z0-9 ]/.test(r)?q({descripcion:"No se permiten símbolos."}):/([A-Z])\1\1/.test(r)?q({descripcion:"No se permiten tres letras iguales consecutivas."}):(q({descripcion:""}),F({...s,descripcion:r}))},onPaste:o=>o.preventDefault(),onCopy:o=>o.preventDefault(),className:`form-control border-0 shadow-sm ${m.descripcion?"is-invalid":""}`,required:!0})]}),m.descripcion&&e.jsx("small",{className:"text-danger",children:m.descripcion}),e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:ue,className:"text-muted"})}),e.jsx(D,{type:"number",name:"monto",placeholder:"Monto (Lempiras)",value:s.monto,onChange:o=>{const r=o.target.value.slice(0,25);F({...s,monto:parseFloat(r)||0})},className:"form-control border-0 shadow-sm",required:!0})]}),e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:e.jsx(g,{icon:ne,className:"text-muted"})}),e.jsxs(M,{name:"cod_concepto",value:s.cod_concepto,onChange:o=>F({...s,cod_concepto:o.target.value.toUpperCase()}),className:"form-select border-0 shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione un concepto"}),fe.map(o=>e.jsx("option",{value:o.Cod_concepto,children:o.Concepto.toUpperCase()},o.Cod_concepto))]})]}),e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{type:"checkbox",className:"form-check-input shadow-sm",id:"aplicarDescuento",checked:n.aplicar_descuento,onChange:o=>f({...n,aplicar_descuento:o.target.checked})}),e.jsx("label",{className:"form-check-label text-muted",htmlFor:"aplicarDescuento",children:"Aplicar Descuento"})]}),n.aplicar_descuento&&e.jsxs(C,{className:"mb-3",children:[e.jsx(j,{className:"bg-white border-0",children:"%"}),e.jsxs(M,{name:"cod_descuento",value:n.cod_descuento||"",onChange:o=>{const r=o.target.value,a=k.find(t=>t.Cod_descuento.toString()===r);if(a){const t=parseFloat(a.Valor),c=parseFloat(n.monto||0),p=c*t,i=c-p;f({...n,cod_descuento:a.Cod_descuento,valor_descuento:a.Valor,monto_final:i>0?i:0})}},className:"form-select border-0 shadow-sm",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar descuento"}),k.map(o=>e.jsx("option",{value:o.Cod_descuento,children:`${parseFloat(o.Valor)*100}% - ${o.Nombre_descuento}`},o.Cod_descuento))]})]})]})}),e.jsxs(le,{className:"d-flex justify-content-end border-0",children:[e.jsx(b,{color:"secondary",className:"btn-light shadow-sm me-2",style:{color:"#4B6251"},onClick:()=>{W(),U(0),G(0),R(!1)},children:"Cancelar"}),e.jsx(b,{className:"shadow-sm",style:{backgroundColor:"#4B6251",borderColor:"#4B6251",color:"white"},onClick:X,children:"Guardar"})]})]})]})};export{Re as decodeJWT,lo as default};
