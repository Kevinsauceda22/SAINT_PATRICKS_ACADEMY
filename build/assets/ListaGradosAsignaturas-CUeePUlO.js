import{r as s,j as a,C as Ye}from"./index-SVRFFNc9.js";import{C as c}from"./index.esm-DWwMdKxH.js";import{E as ne}from"./jspdf.plugin.autotable-gke1D7B3.js";import{S as d}from"./sweetalert2.esm.all-D3pEHXw3.js";import{l as ie}from"./logo_saint_patrick-xw7Wl8f3.js";import{u as R,w as Je}from"./xlsx-lwdk4T0U.js";import{u as Ke}from"./usePermission-BCWksQX7.js";import qe from"./AccessDenied-yaDW3Jao.js";import{C as Xe}from"./CContainer-BdNP0s3v.js";import{C as le,a as L}from"./CRow-Bf67u6lu.js";import{C as ce}from"./CInputGroup-D-McUFva.js";import{C as Ze}from"./CInputGroupText-Cfu0fzaY.js";import{c as Qe}from"./cil-search-CDkY_4k-.js";import{C as ea}from"./CFormInput-B_gylY64.js";import{a as i}from"./CButton-D9GPTbB6.js";import{c as aa}from"./cil-brush-alt-CV61lKqC.js";import{C as de}from"./CFormSelect-CzT7g5tb.js";import{C as ta,a as ra}from"./CCardBody-BwCgYaTs.js";import{C as oa}from"./CCardHeader-C_B6DycW.js";import{c as ge}from"./cil-description-MUzg6O3n.js";import{C as ue,a as pe,b as _,c as j,d as he,e as S}from"./CTable-98qqrSRH.js";import{c as sa}from"./cil-plus-D8mtC-W5.js";import{c as na}from"./cil-info-CmGCY32x.js";import{C as ia}from"./CPagination-UopCEeNZ.js";import{C as O,a as B,b as $,c as H}from"./CModalHeader-Bhtr3bZe.js";import{C as U}from"./CModalTitle-M2mBvD_5.js";import{C as la,a as ca,b as da,c as xe}from"./CDropdownToggle-DlfIUTmX.js";import{c as ga}from"./cil-file-CeQgYs_D.js";import{c as ua}from"./cil-spreadsheet-CJUvf_vM.js";import{c as V}from"./cil-trash-CBbKHhHb.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";import"./CConditionalPortal-DwBsYzTA.js";const Za=()=>{const{canSelect:me,canInsert:pa,canUpdate:ha}=Ke("ListaGradosAsignaturas"),[y,k]=s.useState([]),[m,Ce]=s.useState([]),[D,fe]=s.useState([]),[be,je]=s.useState([]),[F,v]=s.useState(""),[W,Se]=s.useState(""),[xa,ye]=s.useState(""),[G,Y]=s.useState({}),[C,we]=s.useState(5),[f,w]=s.useState(1),[J,K]=s.useState(""),[b,Ae]=s.useState(null),[Ne,q]=s.useState(!1),[Ee,z]=s.useState(!1),[Te,A]=s.useState(!1),[_e,N]=s.useState(!1),[X,ma]=s.useState(null),[Z,ke]=s.useState({}),[De,Q]=s.useState(!1),P=()=>v({Nombre_asignatura:""});s.useEffect(()=>{Fe(),ee()},[]);const Fe=async()=>{try{const r=(await(await fetch("http://localhost:4000/api/grados/verGrados")).json()).map((n,g)=>({...n,originalIndex:g+1}));fe(r)}catch(e){console.error("Error al obtener los grados:",e)}},ve=e=>{Ae(e),z(!0)},Ge=async()=>{try{return await(await fetch("http://localhost:4000/api/gradoAsignatura/obtenerGradosAsignaturasOrden")).json()}catch(e){return console.error("Error al obtener los grados y asignaturas:",e),[]}},ee=async()=>{try{const r=(await(await fetch("http://localhost:4000/api/asignaturas/verAsignaturas")).json()).map((n,g)=>({...n,originalIndex:g+1}));Ce(r)}catch(e){console.error("Error al obtener las Asignaturas:",e)}},I=e=>{if(!D.length)return"Grados no disponibles";const t=D.find(r=>r.Cod_grado===e);return t?t.Nombre_grado:"Grado no encontrado"},ze=async e=>{q(!0);try{const r=await(await fetch(`http://localhost:4000/api/gradoAsignatura/verGradosAsignaturas/${e}`)).json();k(r),z(!0)}catch(t){console.error("Error al obtener los datos:",t)}finally{q(!1)}},ae=e=>{if(!m.length)return"Asignaturas no disponibles";const t=m.find(r=>r.Cod_asignatura===e);return t?t.Nombre_asignatura:"Asignatura no encontrada"},Pe=e=>{if(!m.length)return"Asignaturas no disponibles";const t=m.find(r=>r.Cod_asignatura===e);return t?t.Descripcion_asignatura:"Asignatura no encontrada"},E=()=>{z(!1),k([])},Ie=e=>{ye(e),e&&ze(e)},Me=e=>{Se(e),A(!0)},te=e=>{Y(e),N(!0)},Re=async()=>{try{const e=await Ge();if(!e.length){d.fire({icon:"info",title:"Sin datos",text:"No hay información disponible para generar el reporte.",confirmButtonText:"Entendido"});return}const t=e.reduce((r,n)=>(r[n.Nombre_grado]||(r[n.Nombre_grado]=[]),r[n.Nombre_grado].push(n),r),{});Le(t)}catch(e){console.error("Error al generar el reporte:",e)}},Le=e=>{const t=new ne,r=new Image;r.src=ie;let n=t.internal.pageSize.height;r.onload=()=>{Object.entries(e).forEach(([l,u],p)=>{p>0&&t.addPage(),t.addImage(r,"PNG",10,10,30,30);let o=20;t.setFontSize(18),t.setTextColor(0,102,51),t.text("SAINT PATRICK'S ACADEMY",t.internal.pageSize.width/2,o,{align:"center"}),o+=12,t.setFontSize(16),t.text(`Grado: ${l}`,t.internal.pageSize.width/2,o,{align:"center"}),o+=10,t.setFontSize(10),t.text("Casa Club del periodista, Colonia del Periodista",t.internal.pageSize.width/2,o,{align:"center"}),o+=4,t.text("Teléfono: (504) 2234-8871",t.internal.pageSize.width/2,o,{align:"center"}),o+=4,t.text("Correo: info@saintpatrickacademy.edu",t.internal.pageSize.width/2,o,{align:"center"}),o+=6,t.setLineWidth(.5),t.setDrawColor(0,102,51),t.line(10,o,t.internal.pageSize.width-10,o);const h=u.map((x,M)=>[M+1,x.Nombre_grado||"",x.Nombre_asignatura||"",x.Descripcion_asignatura||""]);t.autoTable({startY:o+4,head:[["#","Grado","Asignatura","Descripción"]],body:h,styles:{fontSize:10,cellPadding:3,halign:"center"},headStyles:{fillColor:[0,102,51],textColor:[255,255,255]},alternateRowStyles:{fillColor:[240,248,255]}})});const g=t.internal.getNumberOfPages();for(let l=1;l<=g;l++){t.setPage(l);const u=new Date,p=`${u.toLocaleDateString()} ${u.toLocaleTimeString()}`;t.setFontSize(10),t.setTextColor(100),t.text(`Fecha y hora de generación: ${p}`,10,n-10),t.text(`Página ${l} de ${g}`,t.internal.pageSize.width-30,n-10)}window.open(t.output("bloburl"),"_blank")},r.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo."),window.open(t.output("bloburl"),"_blank")}},Oe=()=>{const e=new ne,t=new Image;t.src=ie;let r=20,n=e.internal.pageSize.height;t.onload=()=>{e.addImage(t,"PNG",10,10,30,30),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",e.internal.pageSize.width/2,r,{align:"center"}),r+=12,e.setFontSize(16),e.setTextColor(0,102,51);const g=I(b==null?void 0:b.Cod_grado);e.text(`Reporte de Asignaturas ${g}`,e.internal.pageSize.width/2,r,{align:"center"}),r+=10,e.setFontSize(10),e.text("Casa Club del periodista, Colonia del Periodista",e.internal.pageSize.width/2,r,{align:"center"}),r+=4,e.text("Teléfono: (504) 2234-8871",e.internal.pageSize.width/2,r,{align:"center"}),r+=4,e.text("Correo: info@saintpatrickacademy.edu",e.internal.pageSize.width/2,r,{align:"center"}),r+=6,e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,r,e.internal.pageSize.width-10,r),r+=6;const l=[];y.forEach((o,h)=>{const x=[h+1,ae(o.Cod_asignatura),Pe(o.Cod_asignatura)];l.push(x)}),e.autoTable({startY:r,head:[["#","Nombre de la Asignatura","Descripción"]],body:l,headStyles:{fillColor:[0,102,51],textColor:[255,255,255]},styles:{fontSize:10,halign:"center"},alternateRowStyles:{fillColor:[240,248,255]},didDrawPage:o=>{const h=new Date,x=`${h.toLocaleDateString()} ${h.toLocaleTimeString()}`,M=e.internal.pageSize.height;e.setFontSize(10),e.setTextColor(100),e.text(`Fecha y hora de generación: ${x}`,10,M-10)}});const u=e.internal.getNumberOfPages(),p=e.internal.pageSize.width;for(let o=1;o<=u;o++){e.setPage(o),e.setTextColor(100);const h=`Página ${o} de ${u}`;e.text(h,p-30,n-10)}window.open(e.output("bloburl"),"_blank")},t.onerror=()=>{console.warn("No se pudo cargar el logo. El PDF se generará sin el logo."),window.open(e.output("bloburl"),"_blank")}},Be=()=>{const e=[["Saint Patrick Academy"],["Listado de Asignaturas del Grados:"],[`Fecha de generación: ${new Date().toLocaleDateString()}`],[],["#","Asignatura","Grado"]],t=y.map((p,o)=>[o+1,p.Nombre_asignatura,p.Nombre_grado]),r=[...e,...t],n=R.aoa_to_sheet(r),g=[{wpx:50},{wpx:250},{wpx:300}];n["!cols"]=g;const l=R.book_new();R.book_append_sheet(l,n,"Reporte Asignaturas por Grado");const u=`reporte_asignaturas_en_grado${new Date().toLocaleDateString()}.xlsx`;Je(l,u)},re=(e,t)=>{De?d.fire({title:"¿Estás seguro?",text:"Si cierras este formulario, perderás todos los datos ingresados.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&(e(!1),t(),Q(!1))}):(e(!1),t(),Q(!1))},$e=async()=>{if(be.some(t=>t.Cod_asignatura===F)){d.fire({icon:"warning",title:"Asignatura duplicada",text:"La asignatura seleccionada ya está asignada a este grado. Por favor, elige otra.",confirmButtonText:"Entendido"});return}try{const t=await fetch("http://localhost:4000/api/gradoAsignatura/crearGradoAsignatura",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Cod_asignatura:F,Cod_grado:W})});if(t.ok){d.fire({icon:"success",title:"Asignación exitosa",text:"La asignatura fue asignada correctamente al grado."});const r=await t.json();je(n=>[...n,r]),P(),v(""),A(!1)}else if(t.status===400){const r=await t.json();d.fire({icon:"info",title:"Asignatura duplicada",text:r.Mensaje||"La asignatura seleccionada ya está asignada a este grado.",confirmButtonText:"Entendido"})}else d.fire({icon:"error",title:"Error",text:"No se pudo asignar la asignatura. Inténtalo de nuevo."})}catch(t){console.error("Error al asignar la asignatura:",t),d.fire({icon:"error",title:"Error",text:"Hubo un problema al procesar la solicitud."})}},He=async()=>{try{(await fetch("http://localhost:4000/api/gradoAsignatura/eliminarGradoAsignaturas",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({Cod_grados_asignaturas:G.Cod_grados_asignaturas})})).ok?(ee(),N(!1),Y({}),E(!1),d.fire("¡Éxito!","La asignatura se ha eliminado correctamente","success")):d.fire("Error","Hubo un problema al eliminar la asignatura","error")}catch{d.fire("Error","Hubo un problema al eliminar la asignatura","error")}},Ue=e=>{const t=e.target.value.toUpperCase();if(!/^[A-ZÑ\s]*$/.test(t)){d.fire({icon:"warning",title:"Caracteres no permitidos",text:"Solo se permiten letras y espacios."});return}K(t),w(1)},T=D.filter(e=>e.Nombre_grado.toLowerCase().includes(J.toLowerCase())),oe=f*C,Ve=oe-C,We=T.slice(Ve,oe),se=e=>{e>0&&e<=Math.ceil(T.length/C)&&w(e)};return me?a.jsx(Xe,{children:a.jsxs("div",{className:"container mt-4",children:[a.jsx(le,{className:"align-items-center mb-5",children:a.jsx(L,{xs:"11",className:"d-flex align-items-center",children:a.jsx("h2",{className:"mb-0",children:"Proceso de Asignación: Asignaturas a cada Grado"})})}),a.jsxs(le,{className:"align-items-center mt-4 mb-2",children:[a.jsx(L,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:a.jsxs(ce,{className:"me-3",style:{width:"400px"},children:[a.jsx(Ze,{children:a.jsx(c,{icon:Qe})}),a.jsx(ea,{placeholder:"Buscar Grado...",onChange:Ue,value:J}),a.jsxs(i,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{K(""),w(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[a.jsx(c,{icon:aa})," Limpiar"]})]})}),a.jsx(L,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:a.jsx(ce,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:a.jsxs("div",{className:"d-inline-flex align-items-center",children:[a.jsx("span",{children:"Mostrar "}),a.jsxs(de,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const t=Number(e.target.value);we(t),w(1)},value:C,children:[a.jsx("option",{value:"5",children:"5"}),a.jsx("option",{value:"10",children:"10"})]}),a.jsx("span",{children:" registros"})]})})})]}),a.jsxs(ta,{children:[a.jsxs(oa,{children:[a.jsxs("div",{className:"table-container",style:{maxHeight:"400px",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("strong",{children:"INFORMACION DE LOS GRADOS"})," ",a.jsxs(i,{style:{backgroundColor:"#6C8E58",color:"white"},onClick:()=>Re(),children:[a.jsx(c,{icon:ge})," Reporte"]})]}),a.jsx("div",{className:"mt-4",children:a.jsxs(ue,{striped:!0,bordered:!0,hover:!0,children:[a.jsx(pe,{children:a.jsxs(_,{children:[a.jsx(j,{children:"#"}),a.jsx(j,{children:"NOMBRE DE LOS GRADOS"}),a.jsx(j,{style:{textAlign:"center",width:"40%"},children:"ACCIONES"})]})}),a.jsx(he,{children:We.map((e,t)=>a.jsxs(_,{children:[a.jsx(S,{children:t+1}),a.jsx(S,{children:e.Nombre_grado}),a.jsx(S,{children:a.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[a.jsxs(i,{style:{backgroundColor:"#4B6251",color:"#FFFFFF",padding:"5px 10px",fontSize:"0.9rem",marginRight:"8px"},onClick:()=>Me(e.Cod_grado),onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#3C4B43",r.currentTarget.style.color="#FFFFFF",r.currentTarget.style.boxShadow="0px 4px 10px rgba(60, 75, 67, 0.6)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#4B6251",r.currentTarget.style.color="#FFFFFF",r.currentTarget.style.boxShadow="none"},children:[a.jsx(c,{icon:sa,className:"me-2",style:{color:"#FFFFFF",fontSize:"1rem"}}),"Asignar"]}),a.jsx(i,{onMouseEnter:r=>{r.currentTarget.style.boxShadow="0px 4px 10px rgba(93, 138, 168, 0.6)",r.currentTarget.style.color="#000000"},onMouseLeave:r=>{r.currentTarget.style.boxShadow="none",r.currentTarget.style.color="#5C4044"},style:{backgroundColor:"#5D8AA8",marginRight:"10px",color:"#5C4044",border:"none",transition:"all 0.2s ease",padding:"5px 10px",height:"38px",width:"45px"},onClick:()=>Ie(e.Cod_grado,ve(e)),children:a.jsx(c,{icon:na})})]})})]},e.Cod_grado))})]})}),a.jsxs("div",{className:"pagination-container",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[a.jsxs(ia,{"aria-label":"Page navigation",children:[a.jsx(i,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:f===1,onClick:()=>se(f-1),children:"Anterior"}),a.jsx(i,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:f===Math.ceil(T.length/C),onClick:()=>se(f+1),children:"Siguiente"})]}),a.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",f," de ",Math.ceil(T.length/C)]})]})]}),a.jsx(ra,{children:Ne&&a.jsx("div",{className:"text-center",children:a.jsx(Ye,{color:"primary"})})})]}),a.jsxs(O,{size:"lg",visible:Ee,onClose:E,backdrop:"static",children:[a.jsxs(B,{onClose:E,children:[a.jsx(U,{children:a.jsxs("strong",{children:["ASIGNATURAS EXISTENTES EN ",I(b==null?void 0:b.Cod_grado)]})}),a.jsxs(la,{children:[a.jsxs(ca,{style:{backgroundColor:"#6C8E58",color:"white",marginLeft:"370px",fontSize:"0.85rem",cursor:"pointer"},children:[a.jsx(c,{icon:ge})," Reporte"]}),a.jsxs(da,{children:[a.jsxs(xe,{onClick:Oe,style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",borderBottom:"1px solid #eaeaea",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[a.jsx(c,{icon:ga,size:"sm"})," Abrir en PDF"]}),a.jsxs(xe,{onClick:Be,style:{cursor:"pointer",outline:"none",backgroundColor:"transparent",padding:"0.5rem 1rem",fontSize:"0.85rem",color:"#333",transition:"background-color 0.3s"},onMouseOver:e=>e.target.style.backgroundColor="#f5f5f5",onMouseOut:e=>e.target.style.backgroundColor="transparent",children:[a.jsx(c,{icon:ua,size:"sm"})," Descargar Excel"]})]})]})]}),a.jsx($,{children:y.length>0?a.jsxs(ue,{striped:!0,bordered:!0,hover:!0,children:[a.jsx(pe,{children:a.jsxs(_,{children:[a.jsx(j,{children:"#"}),a.jsx(j,{children:"NOMBRE DE LA ASIGNATURA"}),a.jsx(j,{style:{textAlign:"center",width:"15%"},children:"ACCIONES"})]})}),a.jsx(he,{children:y.map((e,t)=>a.jsxs(_,{children:[a.jsx(S,{children:t+1}),a.jsx(S,{children:X===t?a.jsx("select",{style:{width:"100%",padding:"4px",fontSize:"0.9rem"},value:Z.Cod_asignatura||e.Cod_asignatura,onChange:r=>ke({...Z,Cod_asignatura:r.target.value}),children:m.map(r=>a.jsxs("option",{value:r.Cod_asignatura,children:[r.Nombre_asignatura," "]},r.Cod_asignatura))}):ae(e.Cod_asignatura)}),a.jsx(S,{children:X===t?a.jsxs("div",{style:{display:"flex",gap:"8px"},children:[" ",a.jsx(i,{style:{backgroundColor:"#E74C3C",color:"#FFFFFF",padding:"5px 10px",fontSize:"0.9rem",marginRight:"8px"},onClick:()=>te(e),children:a.jsx(c,{icon:V})})]}):a.jsx(i,{style:{padding:"4px 8px",backgroundColor:"#E57368",color:"white",margin:"0 41px"},onClick:()=>te(e),children:a.jsx(c,{icon:V})})})]},e.Cod_grados_asignaturas))})]}):a.jsx("p",{children:"No hay asignaturas disponibles para este grado."})}),a.jsx(H,{children:a.jsx(i,{size:"small",color:"secondary",onClick:E,children:"Cerrar"})})]}),a.jsxs(O,{visible:_e,onClose:()=>N(!1),backdrop:"static",children:[a.jsx(B,{children:a.jsx(U,{children:"Confirmar Eliminación"})}),a.jsx($,{children:a.jsxs("p",{children:["¿Estás seguro de que deseas eliminar la asignatura '",a.jsx("strong",{children:G.Nombre_asignatura}),"' correspondiente a '",a.jsx("strong",{children:G.Nombre_grado}),"?"]})}),a.jsxs(H,{children:[a.jsx(i,{color:"secondary",onClick:()=>N(!1),children:"Cancelar"}),a.jsxs(i,{style:{backgroundColor:"#E57368",color:"white"},onClick:He,children:[a.jsx(c,{icon:V,style:{marginRight:"5px"}})," Eliminar"]})]})]}),a.jsxs(O,{visible:Te,backdrop:"static",children:[a.jsxs(B,{closeButton:!1,children:[a.jsxs(U,{children:["ASIGNAR ASIGNATURA A ",I(W)]})," ",a.jsx(i,{className:"btn-close","aria-label":"Close",onClick:()=>{k([]),re(A,P)}})]}),a.jsx($,{children:a.jsxs(de,{value:F,onChange:e=>v(e.target.value),children:[a.jsx("option",{value:"",children:"SELECCIONE UNA ASIGNATURA"}),m.map(e=>a.jsx("option",{value:e.Cod_asignatura,children:e.Nombre_asignatura},e.Cod_asignatura))]})}),a.jsxs(H,{children:[a.jsx(i,{style:{backgroundColor:"#4B6251",color:"white"},onClick:$e,children:"Guardar"}),a.jsx(i,{color:"secondary",onClick:()=>re(A,P),children:"Cancelar"})]})]})]})}):a.jsx(qe,{})};export{Za as default};
