import{r as n,j as r}from"./index-SVRFFNc9.js";import{C as h}from"./index.esm-DWwMdKxH.js";import{S as a}from"./sweetalert2.esm.all-D3pEHXw3.js";import{E as ge}from"./jspdf.plugin.autotable-gke1D7B3.js";import{l as Ce}from"./logo_saint_patrick-xw7Wl8f3.js";import{C as je}from"./CContainer-BdNP0s3v.js";import{C as K,a as k}from"./CRow-Bf67u6lu.js";import{a as o}from"./CButton-D9GPTbB6.js";import{c as be}from"./cil-plus-D8mtC-W5.js";import{C as ye,a as De,b as Ne,c as we}from"./CDropdownToggle-DlfIUTmX.js";import{c as Te}from"./cil-description-MUzg6O3n.js";import{C as u}from"./CInputGroup-D-McUFva.js";import{C}from"./CInputGroupText-Cfu0fzaY.js";import{c as Se}from"./cil-search-CDkY_4k-.js";import{C as j}from"./CFormInput-B_gylY64.js";import{c as Ee}from"./cil-brush-alt-CV61lKqC.js";import{C as ve}from"./CFormSelect-CzT7g5tb.js";import{C as ke,a as Pe,b as Z,c as P,d as _e,e as _}from"./CTable-98qqrSRH.js";import{c as Me}from"./cil-pen-53d2I-C-.js";import{c as Fe}from"./cil-trash-CBbKHhHb.js";import{C as Le}from"./CPagination-UopCEeNZ.js";import{C as R,a as z,b as I,c as A}from"./CModalHeader-Bhtr3bZe.js";import{C as U}from"./CModalTitle-M2mBvD_5.js";import{C as Re}from"./CForm-CYRkMwLo.js";import"./CConditionalPortal-DwBsYzTA.js";import"./CFormControlWrapper-OEJgTi6e.js";import"./CFormControlValidation-CtDkyDfm.js";import"./CFormLabel-szm2Dda9.js";import"./CBackdrop-BbuVwMMD.js";const xr=()=>{const[Q,X]=n.useState([{dias:"",prefijo_dia:""}]),[ee,b]=n.useState(!1),[re,M]=n.useState(!1),[te,y]=n.useState(!1),[m,D]=n.useState({p_dias:"",p_prefijo_dia:""}),[ze,c]=n.useState(""),[f,N]=n.useState({}),[B,V]=n.useState({}),[H,$]=n.useState(""),[p,w]=n.useState(1),[x,ae]=n.useState(10);n.useEffect(()=>{T()},[]);const T=async()=>{try{const s=(await(await fetch("http://localhost:4000/api/dia/dias")).json()).map((l,g)=>({...l,originalIndex:g+1}));X(s)}catch(e){console.error("Error al obtener los dias:",e)}},se=async()=>{console.log("Valor a enviar:",m.dias),console.log("Valor a enviar:",m.prefijo_dia);try{const e=await fetch("http://localhost:4000/api/dia/crear_dia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({p_dias:m.dias,p_prefijo_dia:m.prefijo_dia})});if(e.ok)T(),b(!1),D({dias:"",prefijo_dia:""}),O(),a.fire("Éxito","Día creado correctamente.","success");else{const t=await e.json();c(t.mensaje||"Error al crear el día."),console.error("Error al crear el día:",e.statusText,t),a.fire("Error",t.mensaje||"No se pudo crear la sección.","error")}}catch(e){console.error("Error al crear el día:",e),c("Error al crear el día.")}},S=()=>{a.fire({title:"¿Estás seguro?",text:"Tienes cambios sin guardar. ¿Deseas cerrar el modal?",icon:"warning",showCancelButton:!0,confirmButtonText:"Cerrar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&(b(!1),O(),M(!1),y(!1))})},O=()=>{D({dias:"",prefijo_dia:""}),c("")},oe=async()=>{try{const e=await fetch("http://localhost:4000/api/dia/actualizar_dia",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({p_Cod_dias:f.Cod_dias,p_Nuevo_dia:f.dias,p_Nuevo_prefijo:f.prefijo_dia})});if(e.ok)T(),M(!1),N({}),c(""),a.fire({icon:"success",title:"Actualización exitosa",text:"El día ha sido actualizado correctamente."});else{const t=await e.json();c(`Error: ${t.Mensaje||"No se pudo actualizar el día, ya existe"}`),a.fire("Error",t.mensaje||"No se pudo crear la sección.","error")}}catch(e){console.error("Error al actualizar el día:",e),c("Error en la conexión. Intente nuevamente.")}},ne=async()=>{try{const e=await fetch(`http://localhost:4000/api/dia/${B.Cod_dias}`,{method:"DELETE"});if(e.ok)T(),y(!1),V({}),a.fire({icon:"success",title:"Eliminación exitosa",text:"El día se ha eliminado correctamente."});else{a.fire({icon:"error",title:"Error",text:result.Mensaje||"Hubo un error al eliminar el día."});const t=await e.json();console.error("Error al eliminar el día:",t)}}catch(e){console.error("Error al eliminar el día:",e)}},E=(e,t)=>{const{name:s,value:l}=e.target;ie(l)&&t(v=>({...v,[s]:l}))},ie=e=>/^[a-zA-Z\s]*$/.test(e)?/(.)\1{3,}/.test(e)?(a.fire({icon:"error",title:"Error",text:"No se permiten 4 letras consecutivas."}),!1):/\d/.test(e)?(a.fire({icon:"error",title:"Error",text:"No se permiten números."}),!1):/( {3,})/.test(e)?(a.fire({icon:"error",title:"Error",text:"No se permiten más de 3 espacios consecutivos."}),!1):/( {2,})/.test(e)?(a.fire({icon:"error",title:"Error",text:"No se permiten más de 2 espacios consecutivos."}),!1):!0:(a.fire({icon:"error",title:"Error",text:"Solo se permiten letras y espacios."}),!1),i=e=>{e.preventDefault(),a.fire({icon:"warning",title:"Acción bloqueada",text:"Copiar y pegar no está permitido."})},le=()=>{const e=new ge({orientation:"landscape",unit:"mm",format:"a4"});if(!d||d.length===0){alert("No hay datos para exportar.");return}const t=new Image;t.src=Ce,t.onload=()=>{const s=e.internal.pageSize.width,l=e.internal.pageSize.height;e.addImage(t,"PNG",10,10,45,45),e.setFontSize(18),e.setTextColor(0,102,51),e.text("SAINT PATRICK'S ACADEMY",s/2,24,{align:"center"}),e.setFontSize(10),e.setTextColor(100),e.text("Casa Club del periodista, Colonia del Periodista",s/2,32,{align:"center"}),e.text("Teléfono: (504) 2234-8871",s/2,37,{align:"center"}),e.text("Correo: info@saintpatrickacademy.edu",s/2,42,{align:"center"}),e.setFontSize(14),e.setTextColor(0,102,51),e.text("Reporte General de Días",s/2,50,{align:"center"}),e.setLineWidth(.5),e.setDrawColor(0,102,51),e.line(10,55,s-10,55),e.setFontSize(12),e.setTextColor(0),e.text("Listado de Días",s/2,65,{align:"center"});const g=["#","Nombre del Día","Prefijo del Día"],v=d.map((F,L)=>[{content:(L+1).toString(),styles:{halign:"center"}},{content:F.dias.toUpperCase(),styles:{halign:"left"}},{content:F.prefijo_dia.toUpperCase(),styles:{halign:"center"}}]);e.autoTable({startY:75,head:[g],body:v,headStyles:{fillColor:[0,102,51],textColor:[255,255,255],fontSize:10,halign:"center"},styles:{fontSize:10,cellPadding:3},alternateRowStyles:{fillColor:[240,248,255]},margin:{top:10,bottom:30},didDrawPage:function(F){const L=e.internal.getNumberOfPages(),he=e.internal.getCurrentPageInfo().pageNumber;e.setFontSize(10),e.setTextColor(0,102,51),e.text(`Página ${he} de ${L}`,s-10,l-10,{align:"right"});const J=new Date,ue=J.toLocaleDateString("es-HN",{year:"numeric",month:"long",day:"numeric"}),fe=J.toLocaleTimeString("es-HN",{hour:"2-digit",minute:"2-digit",second:"2-digit"});e.text(`Fecha de generación: ${ue} Hora: ${fe}`,10,l-10)}});const xe=e.output("blob"),q=URL.createObjectURL(xe);window.open("","_blank").document.write(`
      <html>
        <head><title>Reporte de Días</title></head>
        <body style="margin:0;">
          <iframe width="100%" height="100%" src="${q}" frameborder="0"></iframe>
          <div style="position:fixed;top:10px;right:200px;">
            <button style="background-color: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;" 
              onclick="const a = document.createElement('a'); a.href='${q}'; a.download='Reporte_de_Dias.pdf'; a.click();">
              Descargar PDF
            </button>
          </div>
        </body>
      </html>`)},t.onerror=()=>{a.fire("Error","No se pudo cargar el logo.","error")}},ce=e=>{N(e),M(!0),c("")},de=e=>{V(e),y(!0)},me=e=>{const t=e.target.value.toUpperCase();$(t),w(1)},d=Q.filter(e=>e.dias.toLowerCase().includes(H.toLowerCase())),W=p*x,G=W-x,pe=d.slice(G,W),Y=e=>{e>0&&e<=Math.ceil(d.length/x)&&w(e)};return r.jsxs(je,{children:[r.jsxs(K,{className:"align-items-center mb-5",children:[r.jsx(k,{xs:"8",md:"9",children:r.jsx("h1",{className:"mb-0",children:"Mantenimiento Días"})}),r.jsxs(k,{xs:"4",md:"3",className:"text-end d-flex flex-column flex-md-row justify-content-md-end align-items-md-center",children:[r.jsxs(o,{style:{backgroundColor:"#4B6251",color:"white"},className:"mb-3 mb-md-0 me-md-3",onClick:()=>{b(!0)},children:[r.jsx(h,{icon:be})," Nuevo"]}),r.jsxs(ye,{children:[r.jsxs(De,{style:{backgroundColor:"#6C8E58",color:"white"},children:[r.jsx(h,{icon:Te})," Reporte"]}),r.jsx(Ne,{children:r.jsx(we,{onClick:()=>le(),style:{color:"#6C8E58",fontWeight:"bold"},children:"Ver Reporte en PDF"})})]})]})]}),r.jsxs(K,{className:"align-items-center mt-4 mb-2",children:[r.jsx(k,{xs:"12",md:"8",className:"d-flex flex-wrap align-items-center",children:r.jsxs(u,{className:"me-3",style:{width:"400px"},children:[r.jsx(C,{children:r.jsx(h,{icon:Se})}),r.jsx(j,{placeholder:"Buscar día..",onChange:me,value:H}),r.jsxs(o,{style:{border:"1px solid #ccc",transition:"all 0.1s ease-in-out",backgroundColor:"#F3F4F7",color:"#343a40"},onClick:()=>{$(""),w(1)},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#E0E0E0",e.currentTarget.style.color="black"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#F3F4F7",e.currentTarget.style.color="#343a40"},children:[r.jsx(h,{icon:Ee})," Limpiar"]})]})}),r.jsx(k,{xs:"12",md:"4",className:"text-md-end mt-2 mt-md-0",children:r.jsx(u,{className:"mt-2 mt-md-0",style:{width:"auto",display:"inline-block"},children:r.jsxs("div",{className:"d-inline-flex align-items-center",children:[r.jsx("span",{children:"Mostrar "}),r.jsxs(ve,{style:{width:"80px",display:"inline-block",textAlign:"center"},onChange:e=>{const t=Number(e.target.value);ae(t),w(1)},value:x,children:[r.jsx("option",{value:"5",children:"5"}),r.jsx("option",{value:"10",children:"10"}),r.jsx("option",{value:"20",children:"20"})]}),r.jsx("span",{children:" registros"})]})})})]}),r.jsx("div",{className:"table-container",style:{maxHeight:"520px",overflowY:"scroll",marginBottom:"20px"},children:r.jsxs(ke,{striped:!0,bordered:!0,hover:!0,children:[r.jsx(Pe,{children:r.jsxs(Z,{children:[r.jsx(P,{className:"text-center",children:"#"}),r.jsx(P,{className:"text-center",children:"Nombre del día"}),r.jsx(P,{className:"text-center",children:"Prefijo del día"}),r.jsx(P,{className:"text-center",children:"Acciones"})]})}),r.jsx(_e,{children:pe.map((e,t)=>r.jsxs(Z,{children:[r.jsx(_,{className:"text-center",children:G+t+1}),r.jsx(_,{style:{textTransform:"uppercase"},children:e.dias}),r.jsx(_,{style:{textTransform:"uppercase"},children:e.prefijo_dia}),r.jsx(_,{className:"text-center",children:r.jsxs("div",{className:"d-flex justify-content-center",children:[r.jsx(o,{color:"warning",onClick:()=>ce(e),style:{marginRight:"10px"},children:r.jsx(h,{icon:Me})}),r.jsx(o,{color:"danger",onClick:()=>de(e),style:{marginRight:"10px"},children:r.jsx(h,{icon:Fe})})]})})]},e.Cod_dias||t))})]})}),r.jsxs("div",{className:"pagination mb-0",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[r.jsxs(Le,{"ia-label":"Page navigation",children:[r.jsx(o,{style:{backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:p===1,onClick:()=>Y(p-1),children:"Anterior"}),r.jsx(o,{style:{marginLeft:"10px",backgroundColor:"#6f8173",color:"#D9EAD3"},disabled:p===Math.ceil(d.length/x),onClick:()=>Y(p+1),children:"Siguiente"})]}),r.jsxs("span",{style:{marginLeft:"10px"},children:["Página ",p," de ",Math.ceil(d.length/x)]})]}),r.jsxs(R,{visible:ee,backdrop:"static",children:[r.jsxs(z,{closeButton:!1,children:[r.jsx(U,{children:"Ingresar Día"}),r.jsx(o,{className:"btn-close","aria-label":"Close",onClick:S})]}),r.jsxs(I,{children:[r.jsxs(u,{className:"mb-3",children:[r.jsx(C,{children:"Nombre del día"}),r.jsx(j,{type:"text",name:"dias",value:m.dias||"",onPaste:i,onCopy:i,style:{textTransform:"uppercase"},onChange:e=>E(e,D)})]}),r.jsxs(u,{className:"mb-3",children:[r.jsx(C,{children:"Prefijo del día"}),r.jsx(j,{type:"text",value:m.prefijo_dia||"",onPaste:i,onCopy:i,style:{textTransform:"uppercase"},onChange:e=>E(e,D)})]})]}),r.jsxs(A,{children:[r.jsx(o,{color:"secondary",onClick:S,children:"Cancelar"}),r.jsx(o,{color:"success",onClick:se,children:"Guardar"})]})]}),r.jsxs(R,{visible:re,onClose:()=>b(!1),backdrop:"static",children:[r.jsx(z,{children:r.jsx(U,{children:"Actualizar Día"})}),r.jsx(I,{children:r.jsx(Re,{children:r.jsxs("div",{className:"mb-3",children:[r.jsxs(u,{className:"mb-3",children:[r.jsx(C,{children:"Nombre del día"}),r.jsx(j,{value:f.dias||"",maxLength:50,name:"dias",onPaste:i,onCopy:i,style:{textTransform:"uppercase"},onChange:e=>E(e,N)})]}),r.jsxs(u,{className:"mb-3",children:[r.jsx(C,{children:"Prefijo del día"}),r.jsx(j,{value:f.prefijo_dia||"",maxLength:50,name:"prefijo_dia",onPaste:i,onCopy:i,style:{textTransform:"uppercase"},onChange:e=>E(e,N)})]})]})})}),r.jsxs(A,{children:[r.jsx(o,{color:"secondary",onClick:S,children:"Cancelar"}),r.jsx(o,{color:"success",onClick:oe,children:"Actualizar"})]})]}),r.jsxs(R,{visible:te,onClose:()=>y(!1),backdrop:"static",children:[r.jsx(z,{children:r.jsx(U,{children:"Eliminar Día"})}),r.jsxs(I,{children:["¿Estás seguro de que deseas eliminar el día: ",B.dias,"?"]}),r.jsxs(A,{children:[r.jsx(o,{color:"danger",onClick:ne,children:"Eliminar"}),r.jsx(o,{color:"secondary",onClick:S,children:"Cancelar"})]})]})]})};export{xr as default};
